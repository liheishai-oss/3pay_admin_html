import{d as fe,r as h,c as F,o as ve,a as c,e as a,b as w,w as t,a0 as ge,J as f,F as G,s as B,l as be,a1 as ke,A as he,a2 as we,U as xe,n as o,z as Ve,x as Ce,Q as Ee,i as Se,g as u,f as g,v as De,R as Te,S as ze,j as Ue,q as Me,H as Be,k as Ie,p as s,I as Re,a5 as A,K as L,a3 as Ye,B as $e,t as d,h as Fe,aw as He,ax as Pe,E as I,aH as Ne,_ as je}from"./index-Djz3hU2T.js";/* empty css                          *//* empty css                   *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                          */import{u as Ge}from"./table.plugin-CUKLko4C.js";const Ae={class:"table-com-search"},Le={class:"search-buttons"},Oe={class:"table-header ba-scroll-style"},qe={class:"table-search"},Je={style:{width:"100%","overflow-x":"auto"},class:"table-content"},Ke={key:0},Qe={key:1},We={key:2},Xe={key:0},Ze={key:5},et=["title"],tt={key:1},at={class:"table-footer"},lt={class:"table-pagination"},ot={key:0},nt={key:1},rt={key:3},st={key:0},ut={key:5},dt={key:0,style:{color:"#f56c6c"}},_t={key:1},it=fe({__name:"order",setup(yt){const{loadData:O,data:x,refreshData:C,handleSizeChange:q,handleCurrentChange:J,searchParams:R,isVisible:K,toggleVisibility:Q}=Ge("/api/v1/admin/single-royalty/order-list"),W=()=>{const n=new Date,e=n.getFullYear(),z=String(n.getMonth()+1).padStart(2,"0"),b=String(n.getDate()).padStart(2,"0");return`${e}-${z}-${b}`},E=()=>{const n=W();return[`${n} 00:00:00`,`${n} 23:59:59`]},Y=h(E()),_=h({platform_order_no:"",merchant_order_no:"",merchant_id:"",pay_status:"",royalty_status:"",royalty_type:"",start_time:E()[0],end_time:E()[1]}),X=n=>{n&&n.length===2?(_.value.start_time=n[0],_.value.end_time=n[1]):(_.value.start_time="",_.value.end_time="")},H=h([]),$=h(!1),r=h(null),S=h({}),D=F(()=>{var n;return((n=S.value)==null?void 0:n.is_agent)===!0}),Z=F(()=>{var n;return((n=S.value)==null?void 0:n.user_group_id)===1}),T=F(()=>{var e;const n=(e=S.value)==null?void 0:e.user_group_id;return Number(n)===4}),ee=async()=>{try{const n=await B({url:"/api/v1/admin/user/info",method:"GET"});n.status&&(S.value=n.data)}catch(n){console.error("获取用户信息失败:",n)}},te=async()=>{if(!(T.value||D.value))try{const n=await B({url:"/api/v1/admin/order/merchant-list",method:"GET"});n.status&&(H.value=n.data)}catch(n){console.error("获取商户列表失败:",n)}},ae=async()=>{R.value={..._.value},await C()},le=()=>{const n=E();Y.value=n,_.value={platform_order_no:"",merchant_order_no:"",merchant_id:"",pay_status:"",royalty_status:"",royalty_type:"",start_time:n[0],end_time:n[1]},R.value={..._.value},C()},oe=h([]),ne=n=>{oe.value=n},re=async n=>{try{const e=await B({url:`/api/v1/admin/single-royalty/order-detail/${n.id}`,method:"GET"});e.status&&(r.value=e.data,$.value=!0)}catch(e){console.error("获取详情失败:",e),I.error("获取详情失败")}},se=async n=>{try{await Ne.confirm(`确定要对订单进行手动分账吗？
订单号：${n.platform_order_no||n.order_no}`,"手动分账",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await B({url:"/api/v1/admin/single-royalty/order-manual-royalty",method:"POST",data:{order_id:n.id}});e.status?(I.success(e.msg||"分账成功"),await C()):I.error(e.msg||"分账失败")}catch(e){e!=="cancel"&&(console.error("分账失败:",e),I.error(e.message||"分账失败"))}};return ve(async()=>{await ee(),await te(),R.value={..._.value},O()}),(n,e)=>{const z=ze,b=Te,k=De,m=Be,U=Ue,P=Se,ue=Ie,N=Re,V=be,de=Ee,_e=Ce,ie=ke,v=$e,i=Fe,ye=he,pe=we,y=Pe,me=He,ce=xe;return o(),c(G,null,[a(ge,{name:"fade"},{default:t(()=>[Ve(w("div",Ae,[a(_e,{class:"search-card",shadow:"never"},{default:t(()=>[a(de,{model:_.value,"label-width":"100px",class:"search-form"},{default:t(()=>[a(P,{gutter:20},{default:t(()=>[a(k,{span:6},{default:t(()=>[a(b,{label:"平台订单号"},{default:t(()=>[a(z,{modelValue:_.value.platform_order_no,"onUpdate:modelValue":e[0]||(e[0]=l=>_.value.platform_order_no=l),placeholder:"请输入平台订单号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),a(k,{span:6},{default:t(()=>[a(b,{label:"商户订单号"},{default:t(()=>[a(z,{modelValue:_.value.merchant_order_no,"onUpdate:modelValue":e[1]||(e[1]=l=>_.value.merchant_order_no=l),placeholder:"请输入商户订单号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),!T.value&&!D.value?(o(),u(k,{key:0,span:6},{default:t(()=>[a(b,{label:"商户"},{default:t(()=>[a(U,{modelValue:_.value.merchant_id,"onUpdate:modelValue":e[2]||(e[2]=l=>_.value.merchant_id=l),placeholder:"请选择商户",clearable:"",filterable:"",style:{width:"100%"}},{default:t(()=>[(o(!0),c(G,null,Me(H.value,l=>(o(),u(m,{key:l.id,label:l.merchant_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):g("",!0),a(k,{span:6},{default:t(()=>[a(b,{label:"支付状态"},{default:t(()=>[a(U,{modelValue:_.value.pay_status,"onUpdate:modelValue":e[3]||(e[3]=l=>_.value.pay_status=l),placeholder:"请选择订单状态",clearable:"",style:{width:"100%"}},{default:t(()=>[a(m,{label:"全部",value:""}),a(m,{label:"已创建",value:0}),a(m,{label:"已打开",value:4}),a(m,{label:"已支付",value:1}),a(m,{label:"已关闭",value:2}),a(m,{label:"已退款",value:3})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(P,{gutter:20},{default:t(()=>[a(k,{span:6},{default:t(()=>[a(b,{label:"分账状态"},{default:t(()=>[a(U,{modelValue:_.value.royalty_status,"onUpdate:modelValue":e[4]||(e[4]=l=>_.value.royalty_status=l),placeholder:"请选择分账状态",clearable:"",style:{width:"100%"}},{default:t(()=>[a(m,{label:"全部",value:""}),a(m,{label:"待分账",value:0}),a(m,{label:"分账中",value:1}),a(m,{label:"分账成功",value:2}),a(m,{label:"分账失败",value:3})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(k,{span:6},{default:t(()=>[a(b,{label:"分账类型"},{default:t(()=>[a(U,{modelValue:_.value.royalty_type,"onUpdate:modelValue":e[5]||(e[5]=l=>_.value.royalty_type=l),placeholder:"请选择分账类型",clearable:"",style:{width:"100%"}},{default:t(()=>[a(m,{label:"全部",value:""}),a(m,{label:"不分账",value:"none"}),a(m,{label:"单笔分账",value:"single"}),a(m,{label:"商家分账",value:"merchant"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(k,{span:6},{default:t(()=>[a(b,{label:"时间范围"},{default:t(()=>[a(ue,{modelValue:Y.value,"onUpdate:modelValue":e[6]||(e[6]=l=>Y.value=l),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"},onChange:X,clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(k,{span:6},{default:t(()=>[a(b,null,{default:t(()=>[w("div",Le,[a(V,{type:"primary",onClick:ae},{default:t(()=>[a(N,null,{default:t(()=>[a(f(A))]),_:1}),e[10]||(e[10]=s("搜索 ",-1))]),_:1}),a(V,{onClick:le},{default:t(()=>[a(N,null,{default:t(()=>[a(f(L))]),_:1}),e[11]||(e[11]=s("重置 ",-1))]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[Ye,f(K)]])]),_:1}),w("div",Oe,[a(V,{icon:f(L),onClick:f(C),color:"#40485b"},null,8,["icon","onClick"]),w("div",qe,[a(ie,{class:"ml-4"},{default:t(()=>[a(V,{icon:f(A),onClick:f(Q)},null,8,["icon","onClick"])]),_:1})])]),w("div",Je,[a(ye,{data:f(x).data,border:"",stripe:"","max-height":"600",style:{width:"100%"},onSelectionChange:ne},{default:t(()=>[a(v,{type:"selection",width:"40"}),a(v,{label:"分账主体",align:"center","min-width":"150"},{default:t(({row:l})=>[s(d(l.royalty_subject_name||"-"),1)]),_:1}),a(v,{prop:"order_no",label:"订单号",align:"center","min-width":"200"},{default:t(({row:l})=>[s(d(l.order_no||l.platform_order_no||"-"),1)]),_:1}),a(v,{label:"收款账号",align:"center","min-width":"180"},{default:t(({row:l})=>[s(d(l.payee_account||"-"),1)]),_:1}),a(v,{label:"订单金额",align:"center",width:"100"},{default:t(({row:l})=>[s(" ¥"+d(l.order_amount||"0.00"),1)]),_:1}),a(v,{label:"分账金额",align:"center",width:"100"},{default:t(({row:l})=>[l.royalty_amount>0?(o(),c("span",Ke,"¥"+d(l.royalty_amount),1)):(o(),c("span",Qe,"-"))]),_:1}),a(v,{label:"分账方式",align:"center",width:"100"},{default:t(({row:l})=>[l.royalty_method==="manual"?(o(),u(i,{key:0,type:"warning"},{default:t(()=>[...e[12]||(e[12]=[s("手动",-1)])]),_:1})):l.royalty_method==="auto"?(o(),u(i,{key:1,type:"success"},{default:t(()=>[...e[13]||(e[13]=[s("自动",-1)])]),_:1})):(o(),c("span",We,"-"))]),_:1}),a(v,{label:"分账状态",align:"center","min-width":"120"},{default:t(({row:l})=>[!l.royalty_status_text||l.royalty_status_text==="-"?(o(),c("span",Xe,"-")):l.royalty_status_text==="待分账"?(o(),u(i,{key:1,type:"info"},{default:t(()=>[...e[14]||(e[14]=[s("待分账",-1)])]),_:1})):l.royalty_status_text==="分账中"?(o(),u(i,{key:2,type:"warning"},{default:t(()=>[...e[15]||(e[15]=[s("分账中",-1)])]),_:1})):l.royalty_status_text==="分账成功"?(o(),u(i,{key:3,type:"success"},{default:t(()=>[...e[16]||(e[16]=[s("分账成功",-1)])]),_:1})):l.royalty_status_text==="分账失败"?(o(),u(i,{key:4,type:"danger"},{default:t(()=>[...e[17]||(e[17]=[s("分账失败",-1)])]),_:1})):(o(),c("span",Ze,d(l.royalty_status_text),1))]),_:1}),a(v,{label:"分账时间",align:"center","min-width":"160"},{default:t(({row:l})=>[s(d(l.royalty_time||"-"),1)]),_:1}),a(v,{label:"备注",align:"center","min-width":"150"},{default:t(({row:l})=>[l.royalty_status===3&&l.royalty_error?(o(),c("span",{key:0,style:{color:"#f56c6c"},title:l.royalty_error},d(l.order_remark||"-"),9,et)):(o(),c("span",tt,d(l.order_remark||"-"),1))]),_:1}),a(v,{label:"操作",align:"center",fixed:"right","min-width":"150"},{default:t(l=>[a(V,{size:"small",type:"primary",onClick:M=>re(l.row)},{default:t(()=>[...e[18]||(e[18]=[s("详情",-1)])]),_:1},8,["onClick"]),l.row.can_manual_royalty?(o(),u(V,{key:0,size:"small",type:"warning",onClick:M=>se(l.row)},{default:t(()=>[...e[19]||(e[19]=[s(" 分账 ",-1)])]),_:1},8,["onClick"])):g("",!0)]),_:1})]),_:1},8,["data"])]),w("div",at,[w("div",lt,[a(pe,{"current-page":f(x).current_page,"onUpdate:currentPage":e[7]||(e[7]=l=>f(x).current_page=l),"page-size":f(x).page_size,"onUpdate:pageSize":e[8]||(e[8]=l=>f(x).page_size=l),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:f(x).page_total,onSizeChange:f(q),onCurrentChange:f(J)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),a(ce,{modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=l=>$.value=l),title:"分账订单详情",width:"800px"},{default:t(()=>[r.value?(o(),u(me,{key:0,column:2,border:""},{default:t(()=>{var l,M;return[a(y,{label:"平台订单号"},{default:t(()=>[s(d(r.value.platform_order_no),1)]),_:1}),a(y,{label:"商户订单号"},{default:t(()=>[s(d(r.value.merchant_order_no),1)]),_:1}),a(y,{label:"订单金额"},{default:t(()=>[s("¥"+d(r.value.order_amount),1)]),_:1}),a(y,{label:"分账金额"},{default:t(()=>[r.value.royalty_amount>0?(o(),c("span",ot,"¥"+d(r.value.royalty_amount),1)):(o(),c("span",nt,"-"))]),_:1}),Z.value?(o(),u(y,{key:0,label:"代理商"},{default:t(()=>{var p;return[s(d(((p=r.value.agent)==null?void 0:p.agent_name)||"-"),1)]}),_:1})):g("",!0),!T.value&&!D.value?(o(),u(y,{key:1,label:"商户"},{default:t(()=>{var p;return[s(d(((p=r.value.merchant)==null?void 0:p.merchant_name)||"-"),1)]}),_:1})):g("",!0),a(y,{label:"产品"},{default:t(()=>{var p;return[s(d(((p=r.value.product)==null?void 0:p.product_name)||"-"),1)]}),_:1}),!T.value&&!D.value?(o(),u(y,{key:2,label:"主体"},{default:t(()=>{var p;return[s(d(((p=r.value.subject)==null?void 0:p.company_name)||"-"),1)]}),_:1})):g("",!0),a(y,{label:"分账类型"},{default:t(()=>[r.value.royalty_type==="none"?(o(),u(i,{key:0,type:"info"},{default:t(()=>[...e[20]||(e[20]=[s("不分账",-1)])]),_:1})):r.value.royalty_type==="single"?(o(),u(i,{key:1,type:"success"},{default:t(()=>[...e[21]||(e[21]=[s("单笔分账",-1)])]),_:1})):r.value.royalty_type==="merchant"?(o(),u(i,{key:2,type:"warning"},{default:t(()=>[...e[22]||(e[22]=[s("商家分账",-1)])]),_:1})):(o(),c("span",rt,"-"))]),_:1}),a(y,{label:"支付状态"},{default:t(()=>[r.value.pay_status===0?(o(),u(i,{key:0,type:"info"},{default:t(()=>[...e[23]||(e[23]=[s("已创建",-1)])]),_:1})):r.value.pay_status===4?(o(),u(i,{key:1,type:"warning"},{default:t(()=>[...e[24]||(e[24]=[s("已打开",-1)])]),_:1})):r.value.pay_status===1?(o(),u(i,{key:2,type:"success"},{default:t(()=>[...e[25]||(e[25]=[s("已支付",-1)])]),_:1})):r.value.pay_status===2?(o(),u(i,{key:3,type:"warning"},{default:t(()=>[...e[26]||(e[26]=[s("已关闭",-1)])]),_:1})):r.value.pay_status===3?(o(),u(i,{key:4,type:"danger"},{default:t(()=>[...e[27]||(e[27]=[s("已退款",-1)])]),_:1})):g("",!0)]),_:1}),a(y,{label:"分账状态"},{default:t(()=>[!r.value.royalty_status_text||r.value.royalty_status_text==="-"?(o(),c("span",st,"-")):r.value.royalty_status_text==="待分账"?(o(),u(i,{key:1,type:"info"},{default:t(()=>[...e[28]||(e[28]=[s("待分账",-1)])]),_:1})):r.value.royalty_status_text==="分账中"?(o(),u(i,{key:2,type:"warning"},{default:t(()=>[...e[29]||(e[29]=[s("分账中",-1)])]),_:1})):r.value.royalty_status_text==="分账成功"?(o(),u(i,{key:3,type:"success"},{default:t(()=>[...e[30]||(e[30]=[s("分账成功",-1)])]),_:1})):r.value.royalty_status_text==="分账失败"?(o(),u(i,{key:4,type:"danger"},{default:t(()=>[...e[31]||(e[31]=[s("分账失败",-1)])]),_:1})):(o(),c("span",ut,d(r.value.royalty_status_text),1))]),_:1}),r.value.royalty_record?(o(),u(y,{key:3,label:"收款人姓名"},{default:t(()=>{var p;return[s(d(((p=r.value.royalty_record)==null?void 0:p.payee_name)||"-"),1)]}),_:1})):g("",!0),r.value.royalty_record?(o(),u(y,{key:4,label:"收款人账号"},{default:t(()=>{var p,j;return[s(d(((p=r.value.royalty_record)==null?void 0:p.payee_account)||((j=r.value.royalty_record)==null?void 0:j.payee_user_id)||"-"),1)]}),_:1})):g("",!0),(l=r.value.royalty_record)!=null&&l.alipay_royalty_no?(o(),u(y,{key:5,label:"分账单号"},{default:t(()=>[s(d(r.value.royalty_record.alipay_royalty_no),1)]),_:1})):g("",!0),(M=r.value.royalty_record)!=null&&M.royalty_time?(o(),u(y,{key:6,label:"分账时间"},{default:t(()=>[s(d(r.value.royalty_record.royalty_time),1)]),_:1})):g("",!0),a(y,{label:"创建时间"},{default:t(()=>[s(d(r.value.created_at),1)]),_:1}),a(y,{label:"支付时间"},{default:t(()=>[s(d(r.value.pay_time||"-"),1)]),_:1}),a(y,{label:"备注",span:2},{default:t(()=>[r.value.royalty_status===3&&r.value.royalty_error?(o(),c("span",dt,d(r.value.order_remark||"-"),1)):(o(),c("span",_t,d(r.value.order_remark||"-"),1))]),_:1})]}),_:1})):g("",!0)]),_:1},8,["modelValue"])],64)}}}),ht=je(it,[["__scopeId","data-v-e2949755"]]);export{ht as default};
//# sourceMappingURL=order-B7j0cwg_.js.map
