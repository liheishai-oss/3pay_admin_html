import{s as A,d as F,r as c,L as B,o as U,a as H,b as d,e as a,w as t,E as Q,$ as W,x as $,i as G,n as q,Q as J,W as K,R as X,j as Y,H as Z,l as ee,p as u,v as ae,z as te,g as oe,A as se,B as le,C as re,aw as ne,ax as ie,t as h,_ as de}from"./index-BeGCk70a.js";/* empty css                *//* empty css                          *//* empty css                     *//* empty css                 *//* empty css               */function ue(_){return A({url:"/api/v1/admin/monitor/analysis/order-trend",method:"get",params:_})}function me(_){return A({url:"/api/v1/admin/monitor/analysis/conversion",method:"get",params:_})}function pe(_){return A({url:"/api/v1/admin/monitor/analysis/anomalies",method:"get",params:_})}function _e(_){return A({url:"/api/v1/admin/monitor/analysis/performance",method:"get",params:_})}const ce={class:"analysis-page"},fe={class:"chart-box"},ve={class:"chart-box"},ge=F({__name:"analysis",setup(_){const f=c("24h"),y=c("hour"),w=c(!1),x=c([]),v=c([]),p=B({top_error_nodes:[],frequent_error_messages:[],error_spikes:[]}),l=B({response_time:{count:0,avg:0,min:0,max:0,p95:0,p99:0},slow_calls:[],throughput:[]});async function I(){var m;w.value=!0;try{const[e,o,s,r]=await Promise.all([ue({time_range:f.value,granularity:y.value}),me({time_range:f.value,granularity:y.value}),pe({time_range:f.value}),_e({time_range:f.value})]);console.log("趋势数据响应:",e),console.log("转化率数据响应:",o),console.log("异常模式数据响应:",s),console.log("性能指标数据响应:",r),(e.code===0||e.code===200)&&((m=e.data)!=null&&m.trend)?x.value=e.data.trend:x.value=[],(o.code===0||o.code===200)&&Array.isArray(o.data)?v.value=o.data:v.value=[],(s.code===0||s.code===200)&&s.data?(p.top_error_nodes=s.data.top_error_nodes||[],p.frequent_error_messages=s.data.frequent_error_messages||[],p.error_spikes=s.data.error_spikes||[]):(p.top_error_nodes=[],p.frequent_error_messages=[],p.error_spikes=[]),(r.code===0||r.code===200)&&r.data?(l.response_time=r.data.response_time||l.response_time,l.slow_calls=r.data.slow_calls||[],l.throughput=r.data.throughput||[]):(l.response_time={count:0,avg:0,min:0,max:0,p95:0,p99:0},l.slow_calls=[],l.throughput=[])}catch(e){console.error("加载失败:",e),Q.error((e==null?void 0:e.message)||"加载失败")}finally{w.value=!1,await W(),await D(),L(),M()}}U(I);const E=c(!1);function D(){return new Promise(m=>{if(window.echarts)return E.value=!0,m();const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js",e.onload=()=>{E.value=!0,m()},document.head.appendChild(e)})}const k=c(null),R=c(null);let P=null,V=null;function L(){if(!E.value||!k.value)return;const m=window.echarts;P=P||m.init(k.value);const e=x.value.map(s=>s.time),o=x.value.map(s=>s.count);P.setOption({tooltip:{trigger:"axis"},grid:{left:40,right:20,top:30,bottom:40},xAxis:{type:"category",data:e,axisLabel:{rotate:45}},yAxis:{type:"value",name:"订单量"},series:[{name:"订单量",type:"line",smooth:!0,data:o,areaStyle:{}}]})}function M(){if(!E.value||!R.value)return;const m=window.echarts;V=V||m.init(R.value);const e=v.value.map(n=>n.time),o=v.value.map(n=>n.total??n.total_orders??n.total_count??0),s=v.value.map(n=>n.paid??n.paid_orders??0),r=v.value.map(n=>n.conversion_rate??0);V.setOption({tooltip:{trigger:"axis"},grid:{left:40,right:40,top:30,bottom:40},legend:{data:["总订单","已支付","转化率(%)"]},xAxis:{type:"category",data:e,axisLabel:{rotate:45}},yAxis:[{type:"value",name:"订单数"},{type:"value",name:"转化率(%)",min:0,max:100}],series:[{name:"总订单",type:"bar",data:o,yAxisIndex:0},{name:"已支付",type:"bar",data:s,yAxisIndex:0},{name:"转化率(%)",type:"line",data:r,yAxisIndex:1,smooth:!0}]})}return(m,e)=>{const o=Z,s=Y,r=X,n=ee,S=J,b=$,C=ae,z=G,i=le,T=se,g=ie,j=ne,N=re;return q(),H("div",ce,[e[12]||(e[12]=d("h2",{class:"page-title"},"历史数据分析",-1)),a(b,{class:"mb16",shadow:"never"},{default:t(()=>[a(S,{inline:!0,onSubmit:e[2]||(e[2]=K(()=>{},["prevent"]))},{default:t(()=>[a(r,{label:"时间范围"},{default:t(()=>[a(s,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=O=>f.value=O),style:{width:"140px"}},{default:t(()=>[a(o,{label:"1小时",value:"1h"}),a(o,{label:"6小时",value:"6h"}),a(o,{label:"24小时",value:"24h"}),a(o,{label:"7天",value:"7d"}),a(o,{label:"30天",value:"30d"})]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"粒度"},{default:t(()=>[a(s,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=O=>y.value=O),style:{width:"140px"}},{default:t(()=>[a(o,{label:"按小时",value:"hour"}),a(o,{label:"按天",value:"day"})]),_:1},8,["modelValue"])]),_:1}),a(n,{type:"primary",loading:w.value,onClick:I},{default:t(()=>[...e[3]||(e[3]=[u("刷新",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),a(z,{gutter:16},{default:t(()=>[a(C,{span:12},{default:t(()=>[a(b,{class:"mb16",shadow:"never"},{header:t(()=>[...e[4]||(e[4]=[u("订单趋势",-1)])]),default:t(()=>[d("div",fe,[d("div",{ref_key:"orderTrendChartRef",ref:k,class:"chart"},null,512)])]),_:1})]),_:1}),a(C,{span:12},{default:t(()=>[a(b,{class:"mb16",shadow:"never"},{header:t(()=>[...e[5]||(e[5]=[u("支付转化率",-1)])]),default:t(()=>[d("div",ve,[d("div",{ref_key:"conversionChartRef",ref:R,class:"chart"},null,512)])]),_:1})]),_:1})]),_:1}),a(z,{gutter:16},{default:t(()=>[a(C,{span:12},{default:t(()=>[a(b,{class:"mb16",shadow:"never"},{header:t(()=>[...e[6]||(e[6]=[u("异常模式识别",-1)])]),default:t(()=>[d("div",null,[e[7]||(e[7]=d("h4",{class:"sub"},"错误最多节点TOP10",-1)),te((q(),oe(T,{data:p.top_error_nodes,size:"small"},{default:t(()=>[a(i,{prop:"node",label:"节点","min-width":"220"}),a(i,{prop:"error_count",label:"错误数",width:"100"})]),_:1},8,["data"])),[[N,w.value]]),e[8]||(e[8]=d("h4",{class:"sub mt12"},"常见错误消息TOP20",-1)),a(T,{data:p.frequent_error_messages,size:"small"},{default:t(()=>[a(i,{prop:"message",label:"消息","min-width":"260"}),a(i,{prop:"count",label:"次数",width:"100"})]),_:1},8,["data"]),e[9]||(e[9]=d("h4",{class:"sub mt12"},"错误尖峰",-1)),a(T,{data:p.error_spikes,size:"small"},{default:t(()=>[a(i,{prop:"time",label:"时间",width:"180"}),a(i,{prop:"count",label:"错误数",width:"100"})]),_:1},8,["data"])])]),_:1})]),_:1}),a(C,{span:12},{default:t(()=>[a(b,{class:"mb16",shadow:"never"},{header:t(()=>[...e[10]||(e[10]=[u("性能指标分析",-1)])]),default:t(()=>[d("div",null,[a(j,{column:3,border:"",size:"small"},{default:t(()=>[a(g,{label:"样本数"},{default:t(()=>[u(h(l.response_time.count),1)]),_:1}),a(g,{label:"平均"},{default:t(()=>[u(h(l.response_time.avg)+" ms",1)]),_:1}),a(g,{label:"最小"},{default:t(()=>[u(h(l.response_time.min)+" ms",1)]),_:1}),a(g,{label:"最大"},{default:t(()=>[u(h(l.response_time.max)+" ms",1)]),_:1}),a(g,{label:"P95"},{default:t(()=>[u(h(l.response_time.p95)+" ms",1)]),_:1}),a(g,{label:"P99"},{default:t(()=>[u(h(l.response_time.p99)+" ms",1)]),_:1})]),_:1}),e[11]||(e[11]=d("h4",{class:"sub mt12"},"最慢调用TOP20",-1)),a(T,{data:l.slow_calls,size:"small"},{default:t(()=>[a(i,{prop:"created_at",label:"时间",width:"180"}),a(i,{prop:"node",label:"节点","min-width":"220"}),a(i,{prop:"trace_id",label:"TraceID","min-width":"180"}),a(i,{prop:"platform_order_no",label:"平台单号","min-width":"160"}),a(i,{prop:"duration",label:"耗时(ms)",width:"120"})]),_:1},8,["data"])])]),_:1})]),_:1})]),_:1})])}}}),Ce=de(ge,[["__scopeId","data-v-fd3ff4de"]]);export{Ce as default};
//# sourceMappingURL=analysis-BrJ6YF8T.js.map
