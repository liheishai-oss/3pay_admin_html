import{s as Y,d as Z,h as ee,g as y,a9 as le,c as v,e as s,a as e,i as E,j as g,n as r,w as l,k as ae,a1 as te,aw as oe,D as ne,o as c,u as m,ax as re,x as se,G as de,E as ue,b as ie,y as _e,z as ce,H as x,q as pe,V as me,S as fe,au as ve,av as ge,t as n,a8 as ye,ay as he,az as be,M as Ee,as as we,aA as Ce,aB as Ie,aC as Oe,aD as Pe,aE as ke,C as S,_ as Se}from"./index-Bd9DWvNd.js";/* empty css              *//* empty css                          */function Ve(N){return Y({url:"/api/v1/admin/order-log/search",method:"get",params:N})}const Re={class:"order-log-container"},xe={class:"page-header"},Ne={class:"card-header"},De={class:"amount"},Te={class:"card-header"},Ae={class:"timeline-container"},Fe={class:"log-header"},Le={class:"log-meta"},Be={class:"log-actions"},ze={class:"log-content"},Ue={class:"log-message"},We={key:0,class:"log-extra"},Je={key:0,class:"extra-item"},Ge={key:1,class:"extra-item"},Ke={key:0,class:"log-detail"},Me={class:"log-content-detail"},qe={key:0,class:"json-pre"},je=Z({__name:"order-log",setup(N){const d=ee({merchant_order_no:"",platform_order_no:"",trace_id:""}),U={merchant_order_no:[{validator:(a,t,p)=>{!t&&!d.platform_order_no&&!d.trace_id?p(new Error("请至少输入一个搜索条件")):p()},trigger:"blur"}]},w=y(!1),f=y([]),i=y(null),V=y(!1),C=y(!1),_=y(null),D=le(()=>{var t;const a=(t=_.value)==null?void 0:t.content;if(!a)return"";if(typeof a=="string")try{return JSON.stringify(JSON.parse(a),null,2)}catch{return a}try{return JSON.stringify(a,null,2)}catch{return String(a)}}),h=async()=>{if(!d.merchant_order_no&&!d.platform_order_no&&!d.trace_id){S.warning("请至少输入一个搜索条件");return}w.value=!0,V.value=!0;try{const a=await Ve(d);console.log("API响应:",a),a.code===0||a.code===200?(f.value=a.data.logs||[],i.value=a.data.order_info||null,console.log("日志数据:",f.value),console.log("订单信息:",i.value),S.success("搜索成功")):(console.error("API错误:",a),S.error(a.msg||a.message||"搜索失败"))}catch(a){console.error("请求错误:",a),S.error("搜索失败："+(a.message||"未知错误"))}finally{w.value=!1}},T=()=>{d.merchant_order_no="",d.platform_order_no="",d.trace_id="",f.value=[],i.value=null,V.value=!1},W=a=>{_.value=a,C.value=!0},J=()=>{C.value=!1,_.value=null},A=a=>({ERROR:"danger",WARN:"warning",INFO:"success",DEBUG:"info"})[a]||"info",G=a=>({ERROR:"danger",WARN:"warning",INFO:"primary",DEBUG:"info"})[a]||"primary",K=a=>({ERROR:"CircleClose",WARN:"Warning",INFO:"InfoFilled",DEBUG:"QuestionFilled"})[a]||"InfoFilled",F=a=>({"PaymentPageController::oauthCallback":"OAuth回调","PaymentPageController::paymentPage":"支付页面","PaymentPageController::createOrder":"创建订单","PaymentPageController::callPaymentApi":"调用支付接口","PaymentPageController::handlePaymentResult":"处理支付结果","PaymentPageController::closeOrder":"关闭订单","OrderLogService::log":"日志记录","AlipayService::createOrder":"支付宝创建订单","AlipayService::queryOrder":"支付宝查询订单","AlipayService::closeOrder":"支付宝关闭订单","WechatService::createOrder":"微信创建订单","WechatService::queryOrder":"微信查询订单","WechatService::closeOrder":"微信关闭订单"})[a]||a,M=a=>{try{const t=JSON.parse(a);return t.message||t.msg||a}catch{return a}},q=a=>({0:"warning",1:"success",2:"info",3:"danger"})[a]||"info",j=a=>({0:"待支付",1:"已支付",2:"已关闭",3:"已退款"})[a]||"未知";return(a,t)=>{const p=ae,R=ce,I=_e,O=ie,L=ue,P=pe,H=se,k=te,u=ge,b=ye,B=ve,Q=Ce,$=be,z=oe,X=ne;return c(),v("div",Re,[s("div",xe,[s("h2",null,[e(p,null,{default:l(()=>[e(m(re))]),_:1}),t[4]||(t[4]=r(" 订单日志查询 ",-1))]),t[5]||(t[5]=s("p",{class:"page-description"},"支持按商户订单号、平台订单号、TraceId查询订单日志",-1))]),e(k,{class:"search-card",shadow:"never"},{default:l(()=>[e(H,{ref:"searchFormRef",model:d,rules:U,"label-width":"120px",onSubmit:de(h,["prevent"])},{default:l(()=>[e(L,{gutter:20},{default:l(()=>[e(O,{span:8},{default:l(()=>[e(I,{label:"商户订单号",prop:"merchant_order_no"},{default:l(()=>[e(R,{modelValue:d.merchant_order_no,"onUpdate:modelValue":t[0]||(t[0]=o=>d.merchant_order_no=o),placeholder:"请输入商户订单号",clearable:"",onKeyup:x(h,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),e(O,{span:8},{default:l(()=>[e(I,{label:"平台订单号",prop:"platform_order_no"},{default:l(()=>[e(R,{modelValue:d.platform_order_no,"onUpdate:modelValue":t[1]||(t[1]=o=>d.platform_order_no=o),placeholder:"请输入平台订单号",clearable:"",onKeyup:x(h,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),e(O,{span:8},{default:l(()=>[e(I,{label:"TraceId",prop:"trace_id"},{default:l(()=>[e(R,{modelValue:d.trace_id,"onUpdate:modelValue":t[2]||(t[2]=o=>d.trace_id=o),placeholder:"请输入TraceId",clearable:"",onKeyup:x(h,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(L,null,{default:l(()=>[e(O,{span:24},{default:l(()=>[e(I,null,{default:l(()=>[e(P,{type:"primary",onClick:h,loading:w.value},{default:l(()=>[e(p,null,{default:l(()=>[e(m(me))]),_:1}),t[6]||(t[6]=r(" 搜索 ",-1))]),_:1},8,["loading"]),e(P,{onClick:T},{default:l(()=>[e(p,null,{default:l(()=>[e(m(fe))]),_:1}),t[7]||(t[7]=r(" 重置 ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),i.value?(c(),E(k,{key:0,class:"order-info-card",shadow:"never"},{header:l(()=>[s("div",Ne,[e(p,null,{default:l(()=>[e(m(he))]),_:1}),t[8]||(t[8]=s("span",null,"订单信息",-1))])]),default:l(()=>[e(B,{column:4,border:""},{default:l(()=>[e(u,{label:"商户订单号"},{default:l(()=>[r(n(i.value.merchant_order_no||"-"),1)]),_:1}),e(u,{label:"平台订单号"},{default:l(()=>[r(n(i.value.platform_order_no||"-"),1)]),_:1}),e(u,{label:"订单金额"},{default:l(()=>[s("span",De,"¥"+n(i.value.order_amount||"0.00"),1)]),_:1}),e(u,{label:"支付状态"},{default:l(()=>[e(b,{type:q(i.value.pay_status)},{default:l(()=>[r(n(j(i.value.pay_status)),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"创建时间"},{default:l(()=>[r(n(i.value.created_at||"-"),1)]),_:1}),e(u,{label:"支付时间"},{default:l(()=>[r(n(i.value.pay_time||"-"),1)]),_:1}),e(u,{label:"商户名称"},{default:l(()=>[r(n(i.value.merchant_name||"-"),1)]),_:1}),e(u,{label:"产品名称"},{default:l(()=>[r(n(i.value.product_name||"-"),1)]),_:1})]),_:1})]),_:1})):g("",!0),f.value.length>0?(c(),E(k,{key:1,class:"logs-card",shadow:"never"},{header:l(()=>[s("div",Te,[e(p,null,{default:l(()=>[e(m(ke))]),_:1}),s("span",null,"日志记录 ("+n(f.value.length)+" 条)",1)])]),default:l(()=>[s("div",Ae,[e($,null,{default:l(()=>[(c(!0),v(Ee,null,we(f.value,(o,He)=>(c(),E(Q,{key:o.id,timestamp:o.created_at,type:G(o.log_level),icon:K(o.log_level),placement:"top"},{default:l(()=>[e(k,{class:"log-item"},{default:l(()=>[s("div",Fe,[s("div",Le,[e(b,{type:A(o.log_level),size:"small"},{default:l(()=>[r(n(o.log_level),1)]),_:2},1032,["type"]),e(b,{type:"info",size:"small"},{default:l(()=>[r(n(o.log_type),1)]),_:2},1024),e(b,{type:"warning",size:"small"},{default:l(()=>[r(n(F(o.node)),1)]),_:2},1024)]),s("div",Be,[e(P,{type:"primary",size:"small",text:"",onClick:Qe=>W(o)},{default:l(()=>[e(p,null,{default:l(()=>[e(m(Ie))]),_:1}),t[9]||(t[9]=r(" 详情 ",-1))]),_:1},8,["onClick"])])]),s("div",ze,[s("div",Ue,n(M(o.content)),1),o.ip||o.user_agent?(c(),v("div",We,[o.ip?(c(),v("div",Je,[e(p,null,{default:l(()=>[e(m(Oe))]),_:1}),s("span",null,n(o.ip),1)])):g("",!0),o.user_agent?(c(),v("div",Ge,[e(p,null,{default:l(()=>[e(m(Pe))]),_:1}),s("span",null,n(o.user_agent),1)])):g("",!0)])):g("",!0)])]),_:2},1024)]),_:2},1032,["timestamp","type","icon"]))),128))]),_:1})])]),_:1})):g("",!0),!w.value&&f.value.length===0&&V.value?(c(),E(z,{key:2,description:"未找到相关日志记录","image-size":120},{default:l(()=>[e(P,{type:"primary",onClick:T},{default:l(()=>[...t[10]||(t[10]=[r("重新搜索",-1)])]),_:1})]),_:1})):g("",!0),e(X,{modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=o=>C.value=o),title:"日志详情",width:"80%","before-close":J},{default:l(()=>[_.value?(c(),v("div",Ke,[e(B,{column:2,border:""},{default:l(()=>[e(u,{label:"日志ID"},{default:l(()=>[r(n(_.value.id),1)]),_:1}),e(u,{label:"TraceId"},{default:l(()=>[r(n(_.value.trace_id),1)]),_:1}),e(u,{label:"日志级别"},{default:l(()=>[e(b,{type:A(_.value.log_level)},{default:l(()=>[r(n(_.value.log_level),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"日志类型"},{default:l(()=>[r(n(_.value.log_type),1)]),_:1}),e(u,{label:"节点"},{default:l(()=>[r(n(F(_.value.node)),1)]),_:1}),e(u,{label:"创建时间"},{default:l(()=>[r(n(_.value.created_at),1)]),_:1}),e(u,{label:"IP地址"},{default:l(()=>[r(n(_.value.ip||"-"),1)]),_:1}),e(u,{label:"用户代理"},{default:l(()=>[r(n(_.value.user_agent||"-"),1)]),_:1})]),_:1}),s("div",Me,[t[11]||(t[11]=s("h4",null,"日志内容",-1)),D.value?(c(),v("pre",qe,[s("code",null,n(D.value),1)])):(c(),E(z,{key:1,description:"日志内容为空"}))])])):g("",!0)]),_:1},8,["modelValue"])])}}}),Ze=Se(je,[["__scopeId","data-v-20a32e32"]]);export{Ze as default};
//# sourceMappingURL=order-log-Dwd-gQUr.js.map
