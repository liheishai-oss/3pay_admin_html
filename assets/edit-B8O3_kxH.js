import{d as D,g as c,a8 as E,i as f,w as l,s as v,C as g,D as G,o as s,a,x as $,j as w,E as z,b as O,y as j,c as b,ao as M,L as W,ar as Z,ap as H,z as J,W as K,F as Q,e as X,q as Y,n as x,_ as ee}from"./index-CFTblcIy.js";/* empty css              *//* empty css               */const ae={key:0,class:"form-tip"},te={key:0,class:"form-tip"},le={key:1,class:"form-tip"},oe={class:"dialog-footer"},re=D({__name:"edit",emits:["refresh"],setup(se,{expose:I,emit:U}){const C=U,V=c(),d=c(!1),o=c({id:0,agent_id:"",merchant_name:"",username:"",ip_whitelist:"",status:1,remark:""}),h=c({}),p=E(()=>{var t;return((t=h.value)==null?void 0:t.is_agent)===!0}),y=c([]),A=E(()=>{const t={merchant_name:[{required:!0,message:"请输入商户名称",trigger:"blur"}],username:[{required:!0,message:"请输入账号",trigger:"blur"},{min:3,max:50,message:"账号长度在 3 到 50 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"账号只能包含字母、数字和下划线",trigger:"blur"}]};return p.value||(t.agent_id=[{required:!0,message:"请选择代理商",trigger:"change"}]),t}),T=async()=>{try{const t=await v({url:"/api/v1/admin/user/info",method:"GET"});t.status&&(h.value=t.data)}catch(t){console.error("获取用户信息失败:",t)}},B=async()=>{if(!p.value)try{const t=await v({url:"/api/v1/admin/merchant/agent-list",method:"GET"});t.status&&(y.value=t.data)}catch(t){console.error("获取代理商列表失败:",t)}},q=async t=>{if(await T(),await B(),t.id)try{const e=await v({url:`/api/v1/admin/merchant/detail/${t.id}`,method:"GET"});e.status&&(o.value={...e.data},console.log("商户详情数据:",o.value))}catch(e){console.error("获取详情失败:",e),g.error("获取详情失败");return}else{const e=p.value?h.value.agent_id:"";o.value={id:0,agent_id:e,merchant_name:"",username:"",ip_whitelist:"",status:1,remark:""}}d.value=!0,setTimeout(()=>{var e;(e=V.value)==null||e.clearValidate()},100)},F=async()=>{try{await V.value.validate();const t={...o.value},e=t.id?"/api/v1/admin/merchant/edit":"/api/v1/admin/merchant/add",m=await v({url:e,method:"POST",data:t});m.status?(g.success(m.msg||"操作成功"),d.value=!1,C("refresh")):g.error(m.msg||"操作失败")}catch(t){console.error("提交失败:",t),t!==!1&&g.error("提交失败")}};return I({open:q}),(t,e)=>{const m=H,L=M,n=j,u=O,i=z,_=J,N=K,P=Q,R=$,k=Y,S=G;return s(),f(S,{modelValue:d.value,"onUpdate:modelValue":e[7]||(e[7]=r=>d.value=r),title:o.value.id===0?"新增商户":"编辑商户",width:"700px","close-on-click-modal":!1},{footer:l(()=>[X("span",oe,[a(k,{onClick:e[6]||(e[6]=r=>d.value=!1)},{default:l(()=>[...e[8]||(e[8]=[x("取消",-1)])]),_:1}),a(k,{type:"primary",onClick:F},{default:l(()=>[...e[9]||(e[9]=[x("确定",-1)])]),_:1})])]),default:l(()=>[a(R,{model:o.value,"label-width":"140px",rules:A.value,ref_key:"formRef",ref:V},{default:l(()=>[p.value?w("",!0):(s(),f(i,{key:0,gutter:20},{default:l(()=>[a(u,{span:24},{default:l(()=>[a(n,{label:"代理商",prop:"agent_id"},{default:l(()=>[a(L,{modelValue:o.value.agent_id,"onUpdate:modelValue":e[0]||(e[0]=r=>o.value.agent_id=r),placeholder:"请选择代理商",clearable:"",filterable:"",disabled:o.value.id>0},{default:l(()=>[(s(!0),b(W,null,Z(y.value,r=>(s(),f(m,{key:r.id,label:r.agent_name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),o.value.id>0?(s(),b("div",ae,"代理商创建后不可修改")):w("",!0)]),_:1})]),_:1})]),_:1})),a(i,{gutter:20},{default:l(()=>[a(u,{span:24},{default:l(()=>[a(n,{label:"商户名称",prop:"merchant_name"},{default:l(()=>[a(_,{modelValue:o.value.merchant_name,"onUpdate:modelValue":e[1]||(e[1]=r=>o.value.merchant_name=r),placeholder:"请输入商户名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(i,{gutter:20},{default:l(()=>[a(u,{span:24},{default:l(()=>[a(n,{label:"账号",prop:"username"},{default:l(()=>[a(_,{modelValue:o.value.username,"onUpdate:modelValue":e[2]||(e[2]=r=>o.value.username=r),disabled:o.value.id>0,placeholder:"请输入账号",clearable:""},null,8,["modelValue","disabled"]),o.value.id>0?(s(),b("div",te,"账号创建后不可修改")):(s(),b("div",le,"账号创建后不可修改，请谨慎填写。默认密码：123456，首次登录需修改"))]),_:1})]),_:1})]),_:1}),a(i,{gutter:20},{default:l(()=>[a(u,{span:24},{default:l(()=>[a(n,{label:"IP白名单",prop:"ip_whitelist"},{default:l(()=>[a(_,{modelValue:o.value.ip_whitelist,"onUpdate:modelValue":e[3]||(e[3]=r=>o.value.ip_whitelist=r),type:"textarea",rows:3,placeholder:"多个IP用逗号分隔，例如：192.168.1.1,192.168.1.2",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(i,{gutter:20},{default:l(()=>[a(u,{span:24},{default:l(()=>[a(n,{label:"备注",prop:"remark"},{default:l(()=>[a(_,{modelValue:o.value.remark,"onUpdate:modelValue":e[4]||(e[4]=r=>o.value.remark=r),type:"textarea",rows:3,placeholder:"请输入备注信息",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(i,{gutter:20},{default:l(()=>[a(u,{span:24},{default:l(()=>[a(n,{label:"状态",prop:"status"},{default:l(()=>[a(N,{modelValue:o.value.status,"onUpdate:modelValue":e[5]||(e[5]=r=>o.value.status=r),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o.value.id===0?(s(),f(P,{key:1,title:"商户创建成功后将自动生成API密钥，请妥善保管",type:"warning",closable:!1,style:{"margin-bottom":"20px"}})):w("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),de=ee(re,[["__scopeId","data-v-574faeb9"]]);export{de as default};
//# sourceMappingURL=edit-B8O3_kxH.js.map
