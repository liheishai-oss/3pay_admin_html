{"version":3,"file":"edit-ByrICCLq.js","sources":["../../src/pages/payment-type/edit.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref, watch } from 'vue'\nimport { ElMessage, ElForm } from 'element-plus'\nimport { Check, Close } from '@element-plus/icons-vue'\nimport request from '@/utils/request'\n\nconst visible = ref(false)\nconst formRef = ref<InstanceType<typeof ElForm>>()\n\nconst form = ref({\n  id: 0,\n  product_name: '',\n  class_name: '',\n  description: '',\n  status: 1,\n  sort_order: 0,\n})\n\nconst emit = defineEmits<{\n  (event: 'refresh'): void\n}>()\n\n// 定义验证规则\nconst rules = ref({\n  product_name: [\n    { required: true, message: '请输入产品名称', trigger: 'blur' }\n  ],\n  class_name: [\n    { required: true, message: '请输入产品代码', trigger: 'blur' },\n    { \n      pattern: /^[A-Z][a-zA-Z0-9]*$/, \n      message: '产品代码必须以大写字母开头，只能包含字母和数字', \n      trigger: 'blur' \n    }\n  ],\n  sort_order: [\n    { required: true, message: '请输入排序值', trigger: 'blur' }\n  ]\n})\n\n// 获取详情\nconst getDetail = async (id: number) => {\n  try {\n    const res = await request({\n      url: `/api/v1/admin/payment-type/detail/${id}`,\n      method: 'GET'\n    })\n    return res.data\n  } catch (error) {\n    console.error('获取详情失败:', error)\n    ElMessage.error('获取详情失败')\n  }\n}\n\n// 打开对话框\nconst open = async (data = {}) => {\n  const merged = { ...data }\n  Object.assign(form.value, merged)\n\n  if ((merged as any).id > 0) {\n    const detail = await getDetail((merged as any).id)\n    if (detail) {\n      Object.assign(form.value, detail)\n    }\n  }\n\n  visible.value = true\n}\n\n// 提交表单\nconst handleSubmit = async () => {\n  await formRef.value?.validate()\n  \n  const payload = {\n    ...form.value\n  }\n\n  try {\n    let res\n    if (payload.id === 0) {\n      // 新增\n      res = await request({\n        url: '/api/v1/admin/payment-type/add',\n        method: 'POST',\n        data: payload\n      })\n    } else {\n      // 编辑\n      res = await request({\n        url: '/api/v1/admin/payment-type/edit',\n        method: 'POST',\n        data: payload\n      })\n    }\n\n    if (res.status) {\n      ElMessage.success(res.message || '操作成功')\n      emit('refresh')\n      visible.value = false\n    }\n  } catch (error: any) {\n    ElMessage.error(error.message || '操作失败')\n  }\n}\n\n// 重置表单数据\nconst resetForm = () => {\n  form.value = {\n    id: 0,\n    product_name: '',\n    class_name: '',\n    description: '',\n    status: 1,\n    sort_order: 0,\n  }\n  formRef.value?.clearValidate()\n}\n\n// 监听 visible 变化，关闭时重置表单\nwatch(visible, (newVal) => {\n  if (!newVal) {\n    resetForm()\n  }\n})\n\ndefineExpose({ open })\n</script>\n\n<template>\n  <el-dialog \n    v-model=\"visible\" \n    :title=\"form.id === 0 ? '新增支付类型' : '编辑支付类型'\" \n    width=\"600px\"\n    :close-on-click-modal=\"false\"\n  >\n    <el-form :model=\"form\" label-width=\"120px\" :rules=\"rules\" ref=\"formRef\">\n      <el-form-item label=\"产品名称\" prop=\"product_name\">\n        <el-input \n          v-model=\"form.product_name\" \n          placeholder=\"例如：当面付、手机网站支付\" \n          clearable\n        />\n      </el-form-item>\n\n      <el-form-item label=\"产品代码\" prop=\"class_name\">\n        <el-input \n          v-model=\"form.class_name\" \n          placeholder=\"例如：FaceToFacePayment、WapPayment\" \n          clearable\n          :disabled=\"form.id > 0\"\n        >\n          <template #prepend>Code</template>\n        </el-input>\n        <div class=\"form-tip\">必须以大写字母开头，只能包含字母和数字，创建后不可修改</div>\n      </el-form-item>\n\n      <el-form-item label=\"产品描述\" prop=\"description\">\n        <el-input \n          v-model=\"form.description\" \n          type=\"textarea\" \n          :rows=\"3\"\n          placeholder=\"请输入产品描述\" \n          maxlength=\"500\"\n          show-word-limit\n        />\n      </el-form-item>\n\n      <el-form-item label=\"排序权重\" prop=\"sort_order\">\n        <el-input-number \n          v-model=\"form.sort_order\" \n          :min=\"0\" \n          :max=\"9999\"\n          :step=\"10\"\n          controls-position=\"right\"\n        />\n        <div class=\"form-tip\">数值越大越靠前</div>\n      </el-form-item>\n\n      <el-form-item label=\"状态\" prop=\"status\">\n        <el-switch \n          v-model=\"form.status\" \n          :active-value=\"1\" \n          :inactive-value=\"0\"\n          active-text=\"启用\"\n          inactive-text=\"禁用\"\n        />\n      </el-form-item>\n\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"handleSubmit\">\n          <el-icon><Check /></el-icon>\n          提交\n        </el-button>\n        <el-button @click=\"visible = false\">\n          <el-icon><Close /></el-icon>\n          取消\n        </el-button>\n      </el-form-item>\n    </el-form>\n  </el-dialog>\n</template>\n\n<style scoped>\n.form-tip {\n  font-size: 12px;\n  color: #909399;\n  margin-top: 4px;\n  line-height: 1.5;\n}\n\n:deep(.el-input-group__prepend) {\n  background-color: #f5f7fa;\n  color: #909399;\n  font-weight: 500;\n}\n</style>\n\n"],"names":["visible","ref","formRef","form","emit","__emit","rules","getDetail","id","request","error","ElMessage","open","data","merged","detail","handleSubmit","_a","payload","res","resetForm","watch","newVal","__expose","_createBlock","_component_el_dialog","$event","_createVNode","_unref","ElForm","_component_el_form_item","_component_el_input","_cache","_createElementVNode","_component_el_input_number","_component_el_switch","_component_el_button","_component_el_icon","Check","Close"],"mappings":"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"}