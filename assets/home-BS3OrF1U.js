import{d as ge,r as E,c as J,o as he,a as y,e,b as _,w as l,a0 as Ce,J as c,F as Q,s as k,l as Se,a1 as De,A as Re,a2 as Oe,U as ye,n as f,z as we,i as Pe,g as S,f as D,v as Ve,R as Ie,j as ke,H as Ne,q as Ue,S as Te,k as xe,Q as Ae,p as r,a3 as Me,K as Le,a5 as Fe,B as ze,t as p,h as He,x as je,aw as Ge,ax as Be,ab as Ye,E as w,_ as We}from"./index-CZqKrVMb.js";/* empty css                     *//* empty css                          *//* empty css                   *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                          */import{u as $e}from"./table.plugin-sb-Y0yXn.js";const qe={class:"table-com-search"},Ke={class:"table-header ba-scroll-style"},Je={class:"table-search"},Qe={style:{width:"100%","overflow-x":"auto"},class:"table-content"},Xe={key:1,style:{color:"#999"}},Ze={class:"table-footer"},ea={class:"table-pagination"},aa={key:0,class:"complaint-handle"},la={style:{color:"#f56c6c","font-weight":"bold"}},ta={style:{color:"#f56c6c","font-weight":"bold"}},oa={key:0,style:{"margin-left":"10px",color:"#999","font-size":"12px"}},na=ge({__name:"home",setup(sa){const{isVisible:X,toggleVisibility:Z,loadData:ee,data:C,refreshData:P,handleSizeChange:ae,handleCurrentChange:le,searchParams:j}=$e("/api/v1/admin/complaint/list"),i=E({subject_id:"",agent_id:"",complaint_no:"",status:"",start_time:"",end_time:""}),N=E(null),G=E([]),R=E(!1),n=E(null),U=E(null),T=E(!1),m=E({process_code:"",feedback:"",refund_amount:0}),V=E([]),te=o=>{V.value=o.map(a=>a.id)},oe={process_code:[{required:!0,message:"请选择处理结果码",trigger:"change"}],feedback:[]},x=E({});J(()=>{var o;return((o=x.value)==null?void 0:o.is_agent)===!0});const B=J(()=>{var o;return((o=x.value)==null?void 0:o.user_group_id)===1}),ne=o=>{o?(i.value.start_time=o[0],i.value.end_time=o[1]):(i.value.start_time="",i.value.end_time="")},se=async()=>{j.value={...i.value},await P()},ue=()=>{i.value={subject_id:"",agent_id:"",complaint_no:"",status:"",start_time:"",end_time:""},N.value=null,j.value={...i.value},P()},re=async()=>{try{const o=await k({url:"/api/v1/admin/complaint/subject-list",method:"GET"});o.status&&(G.value=o.data)}catch(o){console.error("获取主体列表失败:",o)}},ie=async o=>{try{const a=await k({url:"/api/v1/admin/complaint/detail",method:"GET",params:{id:o.id}});a.status?(n.value=a.data,m.value={process_code:"",feedback:"",refund_amount:0},V.value=[],R.value=!0):w.error(a.message||"获取详情失败")}catch(a){console.error("获取投诉详情失败:",a),w.error(a.message||"获取详情失败")}},de=async()=>{U.value&&await U.value.validate(async o=>{if(o){T.value=!0;try{const a={id:n.value.id,process_code:m.value.process_code,feedback:m.value.feedback,refund_amount:m.value.refund_amount};V.value.length>0&&(a.detail_ids=V.value);const s=await k({url:"/api/v1/admin/complaint/handle",method:"POST",data:a});s.status?(w.success("处理成功"),R.value=!1,P()):w.error(s.message||"处理失败")}catch(a){console.error("处理投诉失败:",a),w.error(a.message||"处理失败")}finally{T.value=!1}}})},A=o=>({WAIT_PROCESS:"待处理",PROCESSING:"处理中",PROCESSED:"处理完成",OVERDUE:"超时未处理",OVERDUE_PROCESSED:"超时处理完成",PART_OVERDUE:"部分超时未处理",DROP_COMPLAIN:"用户撤诉",DROP_PROCESSED:"处理完成用户撤诉",DROP_OVERDUE_COMPLAIN:"超时后用户撤诉",DROP_OVERDUE_PROCESSED:"超时处理完成用户撤诉",CLOSED:"已关闭",MERCHANT_PROCESSING:"商家处理中",MERCHANT_FEEDBACKED:"商家已反馈",SUCCESS:"投诉完结",CANCELLED:"投诉撤销",FINISHED:"已完结",MERCHANT_REPLIED:"商家已回复",待处理:"待处理",处理中:"处理中",处理完成:"处理完成"})[o]||o,M=o=>({WAIT_PROCESS:"danger",PROCESSING:"warning",PROCESSED:"success",OVERDUE:"danger",OVERDUE_PROCESSED:"warning",PART_OVERDUE:"warning",DROP_COMPLAIN:"info",DROP_PROCESSED:"info",DROP_OVERDUE_COMPLAIN:"info",DROP_OVERDUE_PROCESSED:"info",CLOSED:"info"})[o]||"info",_e=async()=>{try{const o=await k({url:"/api/v1/admin/user/info",method:"GET"});o.status&&(x.value=o.data)}catch(o){console.error("获取用户信息失败:",o)}};return he(()=>{_e(),re(),ee()}),(o,a)=>{const s=Ne,L=ke,v=Ie,O=Ve,F=Te,Y=Pe,pe=xe,g=Se,W=Ae,ce=De,u=ze,I=He,$=Re,me=Oe,h=Be,fe=Ge,z=je,ve=Ye,Ee=ye;return f(),y(Q,null,[e(Ce,{name:"fade"},{default:l(()=>[we(_("div",qe,[e(Y,{gutter:20},{default:l(()=>[e(O,{span:6},{default:l(()=>[e(v,{label:"主体"},{default:l(()=>[e(L,{modelValue:i.value.subject_id,"onUpdate:modelValue":a[0]||(a[0]=t=>i.value.subject_id=t),placeholder:"选择主体",clearable:"",filterable:""},{default:l(()=>[e(s,{label:"全部",value:""}),(f(!0),y(Q,null,Ue(G.value,t=>(f(),S(s,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),B.value?(f(),S(O,{key:0,span:6},{default:l(()=>[e(v,{label:"代理商ID"},{default:l(()=>[e(F,{modelValue:i.value.agent_id,"onUpdate:modelValue":a[1]||(a[1]=t=>i.value.agent_id=t),placeholder:"按代理商ID搜索",clearable:"",type:"number"},null,8,["modelValue"])]),_:1})]),_:1})):D("",!0),e(O,{span:6},{default:l(()=>[e(v,{label:"投诉单号"},{default:l(()=>[e(F,{modelValue:i.value.complaint_no,"onUpdate:modelValue":a[2]||(a[2]=t=>i.value.complaint_no=t),placeholder:"按投诉单号搜索",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(O,{span:6},{default:l(()=>[e(v,{label:"状态"},{default:l(()=>[e(L,{modelValue:i.value.status,"onUpdate:modelValue":a[3]||(a[3]=t=>i.value.status=t),placeholder:"选择状态",clearable:""},{default:l(()=>[e(s,{label:"全部",value:""}),e(s,{label:"待处理",value:"WAIT_PROCESS"}),e(s,{label:"处理中",value:"PROCESSING"}),e(s,{label:"处理完成",value:"PROCESSED"}),e(s,{label:"部分超时未处理",value:"PART_OVERDUE"}),e(s,{label:"超时未处理",value:"OVERDUE"}),e(s,{label:"超时处理完成",value:"OVERDUE_PROCESSED"}),e(s,{label:"用户撤诉",value:"DROP_COMPLAIN"}),e(s,{label:"处理完成用户撤诉",value:"DROP_PROCESSED"}),e(s,{label:"超时后用户撤诉",value:"DROP_OVERDUE_COMPLAIN"}),e(s,{label:"超时处理完成用户撤诉",value:"DROP_OVERDUE_PROCESSED"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Y,{gutter:20},{default:l(()=>[e(O,{span:12},{default:l(()=>[e(v,{label:"投诉时间"},{default:l(()=>[e(pe,{modelValue:N.value,"onUpdate:modelValue":a[4]||(a[4]=t=>N.value=t),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",onChange:ne},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(W,{inline:!0,class:"demo-form-inline"},{default:l(()=>[e(v,null,{default:l(()=>[e(g,{type:"primary",onClick:se},{default:l(()=>[...a[12]||(a[12]=[r("搜索",-1)])]),_:1}),e(g,{type:"primary",onClick:ue},{default:l(()=>[...a[13]||(a[13]=[r("重置",-1)])]),_:1})]),_:1})]),_:1})],512),[[Me,c(X)]])]),_:1}),_("div",Ke,[e(g,{icon:c(Le),onClick:c(P),color:"#40485b"},null,8,["icon","onClick"]),_("div",Je,[e(ce,{class:"ml-4"},{default:l(()=>[e(g,{icon:c(Fe),onClick:c(Z)},null,8,["icon","onClick"])]),_:1})])]),_("div",Qe,[e($,{data:c(C).data,border:"",stripe:"","max-height":"600",style:{width:"100%"}},{default:l(()=>[e(u,{prop:"id",label:"ID",align:"center","min-width":"80"}),e(u,{prop:"complaint_no",label:"投诉单号",align:"center","min-width":"200","show-overflow-tooltip":""}),e(u,{prop:"subject_name",label:"主体名称",align:"center","min-width":"180","show-overflow-tooltip":""}),B.value?(f(),S(u,{key:0,prop:"agent_name",label:"代理商",align:"center","min-width":"150"})):D("",!0),e(u,{label:"投诉金额",align:"center","min-width":"120"},{default:l(({row:t})=>[r(p(t.complaint_amount>0?`¥${t.complaint_amount}`:"-"),1)]),_:1}),e(u,{label:"已退款",align:"center","min-width":"120"},{default:l(({row:t})=>[t.refund_amount>0?(f(),S(I,{key:0,type:"success"},{default:l(()=>[r("¥"+p(t.refund_amount),1)]),_:2},1024)):(f(),y("span",Xe,"-"))]),_:1}),e(u,{prop:"complainant_id",label:"投诉人ID",align:"center","min-width":"180","show-overflow-tooltip":""}),e(u,{prop:"complaint_time",label:"投诉时间",align:"center","min-width":"180"}),e(u,{label:"状态",align:"center","min-width":"150"},{default:l(({row:t})=>[e(I,{type:M(t.complaint_status)},{default:l(()=>[r(p(A(t.complaint_status)),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"created_at",label:"创建时间",align:"center","min-width":"180"}),e(u,{label:"操作",align:"center",fixed:"right","min-width":"120"},{default:l(t=>[e(g,{size:"small",type:"primary",onClick:H=>ie(t.row)},{default:l(()=>[...a[14]||(a[14]=[r("处理投诉",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_("div",Ze,[_("div",ea,[e(me,{"current-page":c(C).current_page,"onUpdate:currentPage":a[5]||(a[5]=t=>c(C).current_page=t),"page-size":c(C).page_size,"onUpdate:pageSize":a[6]||(a[6]=t=>c(C).page_size=t),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:c(C).page_total,onSizeChange:c(ae),onCurrentChange:c(le)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),e(Ee,{modelValue:R.value,"onUpdate:modelValue":a[11]||(a[11]=t=>R.value=t),title:"处理投诉",width:"90%","close-on-click-modal":!1},{footer:l(()=>[e(g,{onClick:a[10]||(a[10]=t=>R.value=!1)},{default:l(()=>[...a[18]||(a[18]=[r("取消",-1)])]),_:1}),e(g,{type:"primary",onClick:de,loading:T.value},{default:l(()=>[...a[19]||(a[19]=[r("提交处理",-1)])]),_:1},8,["loading"])]),default:l(()=>{var t,H,q,K;return[n.value?(f(),y("div",aa,[e(z,{class:"box-card",shadow:"never",style:{"margin-bottom":"20px"}},{header:l(()=>[...a[15]||(a[15]=[_("div",{class:"card-header"},[_("span",null,"投诉基本信息")],-1)])]),default:l(()=>[e(fe,{column:2,border:""},{default:l(()=>[e(h,{label:"投诉单号"},{default:l(()=>[r(p(n.value.complaint_no),1)]),_:1}),e(h,{label:"主体名称"},{default:l(()=>[r(p(n.value.subject_name),1)]),_:1}),e(h,{label:"投诉人ID"},{default:l(()=>[r(p(n.value.complainant_id),1)]),_:1}),e(h,{label:"投诉时间"},{default:l(()=>[r(p(n.value.complaint_time),1)]),_:1}),e(h,{label:"投诉金额"},{default:l(()=>{var d;return[_("span",la,p(((d=n.value)==null?void 0:d.complaint_amount)>0?`¥${n.value.complaint_amount}`:"-"),1)]}),_:1}),e(h,{label:"当前状态"},{default:l(()=>[e(I,{type:M(n.value.complaint_status)},{default:l(()=>[r(p(A(n.value.complaint_status)),1)]),_:1},8,["type"])]),_:1}),e(h,{label:"投诉原因",span:2},{default:l(()=>[r(p(n.value.complaint_reason),1)]),_:1})]),_:1})]),_:1}),((t=n.value)==null?void 0:t.complaint_status)==="WAIT_PROCESS"||((H=n.value)==null?void 0:H.complaint_status)==="PROCESSING"?(f(),S(z,{key:0,class:"box-card",shadow:"never",style:{"margin-bottom":"20px"}},{header:l(()=>[...a[16]||(a[16]=[_("div",{class:"card-header"},[_("span",null,"投诉订单列表"),_("span",{style:{"margin-left":"10px",color:"#999","font-size":"12px"}}," （请选择需要处理的订单，如不选择则处理所有订单） ")],-1)])]),default:l(()=>{var d;return[e($,{data:((d=n.value)==null?void 0:d.details)||[],border:"",stripe:"","max-height":"300",onSelectionChange:te},{default:l(()=>[e(u,{type:"selection",width:"55",align:"center"}),e(u,{prop:"id",label:"ID",align:"center",width:"80"}),e(u,{prop:"merchant_order_no",label:"商户订单号",align:"center","min-width":"200","show-overflow-tooltip":""}),e(u,{prop:"platform_order_no",label:"平台订单号",align:"center","min-width":"200","show-overflow-tooltip":""}),e(u,{prop:"order_amount",label:"订单金额",align:"center",width:"120"},{default:l(({row:b})=>[r(" ¥"+p(b.order_amount||"0.00"),1)]),_:1}),e(u,{prop:"complaint_amount",label:"投诉金额",align:"center",width:"120"},{default:l(({row:b})=>[_("span",ta," ¥"+p(b.complaint_amount||"0.00"),1)]),_:1})]),_:1},8,["data"])]}),_:1})):D("",!0),((q=n.value)==null?void 0:q.complaint_status)==="WAIT_PROCESS"||((K=n.value)==null?void 0:K.complaint_status)==="PROCESSING"?(f(),S(z,{key:1,class:"box-card",shadow:"never"},{header:l(()=>[...a[17]||(a[17]=[_("div",{class:"card-header"},[_("span",null,"商家反馈处理")],-1)])]),default:l(()=>[e(W,{model:m.value,ref_key:"handleFormRef",ref:U,"label-width":"130px",rules:oe},{default:l(()=>[e(v,{label:"当前状态"},{default:l(()=>{var d;return[e(I,{type:M((d=n.value)==null?void 0:d.complaint_status)},{default:l(()=>{var b;return[r(p(A((b=n.value)==null?void 0:b.complaint_status)),1)]}),_:1},8,["type"])]}),_:1}),e(v,{label:"处理结果码",prop:"process_code"},{default:l(()=>[e(L,{modelValue:m.value.process_code,"onUpdate:modelValue":a[7]||(a[7]=d=>m.value.process_code=d),placeholder:"请选择处理结果码",style:{width:"100%"}},{default:l(()=>[e(s,{label:"已联系到用户，协商一致，无异议",value:"CONSENSUS_WITH_CLIENT"}),e(s,{label:"已退款，用户无异议",value:"REFUND"}),e(s,{label:"不涉及退款，已针对投诉内容进行整改",value:"RECTIFICATION_NO_REFUND"}),e(s,{label:"已提交证明材料",value:"SUBMIT_PROOF_NOT_CONTACTED"}),e(s,{label:"其他渠道已退款",value:"OTHER_CHANNEL_REFUND"}),e(s,{label:"其他",value:"ORTHER"})]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"反馈内容（选填）",prop:"feedback"},{default:l(()=>[e(F,{modelValue:m.value.feedback,"onUpdate:modelValue":a[8]||(a[8]=d=>m.value.feedback=d),type:"textarea",rows:5,placeholder:"请详细描述您对该投诉的处理情况和解决方案（可选）...",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(v,{label:"退款金额",prop:"refund_amount"},{default:l(()=>{var d,b;return[e(ve,{modelValue:m.value.refund_amount,"onUpdate:modelValue":a[9]||(a[9]=be=>m.value.refund_amount=be),min:0,max:((d=n.value)==null?void 0:d.complaint_amount)||999999.99,precision:2,step:.01,placeholder:"如有退款请填写",style:{width:"200px"}},null,8,["modelValue","max"]),((b=n.value)==null?void 0:b.complaint_amount)>0?(f(),y("span",oa," 最大可退款金额：¥"+p(n.value.complaint_amount),1)):D("",!0)]}),_:1})]),_:1},8,["model"])]),_:1})):D("",!0)])):D("",!0)]}),_:1},8,["modelValue"])],64)}}}),va=We(na,[["__scopeId","data-v-a74261c0"]]);export{va as default};
//# sourceMappingURL=home-BS3OrF1U.js.map
