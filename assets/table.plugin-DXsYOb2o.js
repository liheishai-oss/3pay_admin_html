import{r as w,c as m,aW as y,E as h,aH as v,aX as f,aY as b,aZ as $}from"./index-BZRJkKFz.js";function x(){const t=w([]),a=r=>{console.log("当前选中后",r),t.value=r},e=m(()=>t.value.length>0);return{selectedRows:t,handleSelectionChange:a,hasSelectedRows:e}}function _(t=!1){const a=w(t);return{isVisible:a,toggleVisibility:()=>{a.value=!a.value}}}function T(t={}){const a=w({...t});return{searchParams:a,resetSearchParams:()=>{a.value={...t}}}}const D=(t,a)=>{const e=w({search_visible:!0,current_page:1,page_size:10,page_total:0,data:[],admin:!1,search:[]}),r=async()=>{console.log("搜索",a.value);try{const c=await y(t,e.value.current_page,e.value.page_size,{...a.value}),{admin:o,total:d,current_page:i,per_page:l,data:g}=c.data;e.value.admin=o,d>0?(e.value.current_page=i,e.value.page_size=l,e.value.page_total=d,e.value.data=[...g]):(e.value.data=[],e.value.page_total=0)}catch(c){console.error("加载数据失败",c)}};return{data:e,loadData:r,refreshData:(c={})=>{console.log(c),e.value.current_page=1,r()},handleSizeChange:(c,o={})=>{console.log(o),e.value.page_size=c,r()},handleCurrentChange:(c,o={})=>{console.log(c,o),e.value.current_page=c,r()}}},C=(t,a)=>({deleteRows:async(r,s)=>{let n=[];if(Array.isArray(s)&&s.length>0?n=s:t&&t.value.length>0&&(n=t.value.map(u=>u.id)),n.length===0){h.error("没有选中任何数据");return}try{await v.confirm(`确定要删除选中的 ${n.length} 条数据吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await f(r,n)).status&&(h.success("操作成功"),a==null||a())}catch{}}}),E=(t,a,e)=>({tableExport:async(s,n)=>{console.log("extraParams");let u=[];const c=n;if(console.log(t),t!=null&&t.value&&(u=t.value.map(o=>o.id)),c)try{await v.confirm("确定要导出全部数据吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const o=await b(s,u,a==null?void 0:a.value),d=window.URL.createObjectURL(o),i=document.createElement("a");i.href=d;const l=new Date,g=p=>p.toString().padStart(2,"0");i.download=`${l.getFullYear()}${g(l.getMonth()+1)}${g(l.getDate())}${g(l.getHours())}${g(l.getMinutes())}${g(l.getSeconds())}.xlsx`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(d),h.success("导出成功"),e==null||e()}catch(o){o!=="cancel"&&(h.error("导出失败，请稍后重试"),console.error(o))}else{if(u.length===0){h.error("没有选中任何数据");return}try{await v.confirm(`确定要导出选中的 ${u.length} 条数据吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const o=await b(s,u),d=window.URL.createObjectURL(o),i=document.createElement("a");i.href=d;const l=new Date,g=p=>p.toString().padStart(2,"0");i.download=`${l.getFullYear()}${g(l.getMonth()+1)}${g(l.getDate())}${g(l.getHours())}${g(l.getMinutes())}${g(l.getSeconds())}.xlsx`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(d),h.success("导出成功"),e==null||e()}catch(o){o!=="cancel"&&(h.error("导出失败，请稍后重试"),console.error(o))}}}}),L=t=>({toggleSwitch:async(e,r,s)=>{console.log("toggleSwitch called with:",{api:e,id:r,status:s});try{const n=await $(e,r,s);n.status?(h.success("操作成功"),t==null||t()):h.error(n.message||"操作失败")}catch(n){console.error("toggleSwitch error:",n),h.error("操作失败")}}});function B(t){const a=x(),e=_(),r=T(),s=D(t,r.searchParams),n=C(a.selectedRows,s.refreshData),u=L(s.refreshData),c=E(a.selectedRows,r.searchParams);return{...a,...e,...s,...r,...n,...u,...c}}export{B as u};
//# sourceMappingURL=table.plugin-DXsYOb2o.js.map
