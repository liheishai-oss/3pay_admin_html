import{s as P,d as K,g as t,h as O,i as W,o as v,w as l,e as s,c as x,j as G,a as o,k as X,u as b,l as j,m as oe,n as q,t as H,p as se,q as N,v as F,x as T,y as M,z as Q,A as le,C as k,D as Y,_ as Z,F as ee,G as ae,H as L,I as te,J as ne,K as re,L as de}from"./index-MfHcZ8eH.js";/* empty css              */function ie(I={}){return P({url:"/api/v1/admin/user/login",method:"post",data:I})}const J=I=>P.get("/api/v1/admin/google-auth/qr-code",{params:{admin_id:I}}),ue=I=>P.post("/api/v1/admin/google-auth/bind",I),ce={class:"google-auth-bind"},pe={key:0,class:"step-content"},_e={class:"step-header"},me={class:"qr-code-container"},ge={key:0,class:"qr-loading"},fe={key:1,class:"qr-code"},ve=["src"],we={class:"qr-info"},he={key:2,class:"qr-error"},ye={class:"step-actions"},be={key:1,class:"step-content"},ke={class:"step-header"},Ve={class:"step-actions"},Ce={key:2,class:"step-content"},xe={class:"success-content"},Ae=K({__name:"GoogleAuthBind",emits:["success","close"],setup(I,{expose:U,emit:w}){const h=w,_=t(!1),c=t(1),y=t(!1),p=t(!1),A=t(0),f=t(null),V=O({google_code:""}),$={google_code:[{required:!0,message:"ËØ∑ËæìÂÖ•È™åËØÅÁ†Å",trigger:"blur"},{pattern:/^\d{6}$/,message:"ËØ∑ËæìÂÖ•6‰ΩçÊï∞Â≠óÈ™åËØÅÁ†Å",trigger:"blur"}]},g=t(),a=(i,e)=>{_.value=!0,c.value=1,A.value=i,z()},r=()=>{c.value<3&&c.value++},D=()=>{c.value>1&&c.value--},z=async()=>{try{y.value=!0;const i=await J(A.value);i.data?f.value=i.data:k.error("ÁîüÊàê‰∫åÁª¥Á†ÅÂ§±Ë¥•")}catch(i){console.error("ÁîüÊàê‰∫åÁª¥Á†ÅÂ§±Ë¥•:",i),k.error("ÁîüÊàê‰∫åÁª¥Á†ÅÂ§±Ë¥•")}finally{y.value=!1}},E=async()=>{var i,e;try{await((i=g.value)==null?void 0:i.validate()),p.value=!0;const u=await ue({admin_id:A.value,google_code:V.google_code,secret:f.value.secret});u.data?(k.success("ÁªëÂÆöÊàêÂäü"),c.value=3):k.error(((e=u.data)==null?void 0:e.message)||"ÁªëÂÆöÂ§±Ë¥•")}catch(u){console.error("ÁªëÂÆöÂ§±Ë¥•:",u),k.error(u.message||"ÁªëÂÆöÂ§±Ë¥•")}finally{p.value=!1}},d=()=>{_.value=!1,h("success"),setTimeout(()=>{window.location.reload()},1e3)};return U({open:a}),(i,e)=>{const u=X,C=N,B=Q,R=M,n=T,m=Y;return v(),W(m,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=S=>_.value=S),title:"ÁªëÂÆöË∞∑Ê≠åÈ™åËØÅÁ†Å",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,center:""},{default:l(()=>[s("div",ce,[c.value===1?(v(),x("div",pe,[s("div",_e,[o(u,{class:"step-icon"},{default:l(()=>[o(b(j))]),_:1}),e[2]||(e[2]=s("h3",null,"Êâ´Êèè‰∫åÁª¥Á†Å",-1)),e[3]||(e[3]=s("p",null,"ËØ∑‰ΩøÁî®Ë∞∑Ê≠åÈ™åËØÅÂô®Êâ´Êèè‰∏ãÊñπ‰∫åÁª¥Á†Å",-1))]),s("div",me,[y.value?(v(),x("div",ge,[o(u,{class:"is-loading"},{default:l(()=>[o(b(oe))]),_:1}),e[4]||(e[4]=s("p",null,"ÁîüÊàê‰∫åÁª¥Á†Å‰∏≠...",-1))])):f.value?(v(),x("div",fe,[s("img",{src:f.value.qr_code_url,alt:"Ë∞∑Ê≠åÈ™åËØÅÁ†Å‰∫åÁª¥Á†Å"},null,8,ve),s("div",we,[s("p",null,[e[5]||(e[5]=s("strong",null,"Ë¥¶Êà∑Ôºö",-1)),q(H(f.value.account_name),1)]),s("p",null,[e[6]||(e[6]=s("strong",null,"ÂØÜÈí•Ôºö",-1)),q(H(f.value.secret),1)])])])):(v(),x("div",he,[o(u,null,{default:l(()=>[o(b(se))]),_:1}),e[8]||(e[8]=s("p",null,"ÁîüÊàê‰∫åÁª¥Á†ÅÂ§±Ë¥•",-1)),o(C,{onClick:b(J),type:"primary"},{default:l(()=>[...e[7]||(e[7]=[q("ÈáçËØï",-1)])]),_:1},8,["onClick"])]))]),s("div",ye,[o(C,{onClick:r,type:"primary",disabled:!f.value},{default:l(()=>[...e[9]||(e[9]=[q(" ‰∏ã‰∏ÄÊ≠• ",-1)])]),_:1},8,["disabled"])])])):G("",!0),c.value===2?(v(),x("div",be,[s("div",ke,[o(u,{class:"step-icon"},{default:l(()=>[o(b(F))]),_:1}),e[10]||(e[10]=s("h3",null,"È™åËØÅÁªëÂÆö",-1)),e[11]||(e[11]=s("p",null,"ËØ∑ËæìÂÖ•Ë∞∑Ê≠åÈ™åËØÅÂô®‰∏≠ÁöÑ6‰ΩçÊï∞Â≠óÈ™åËØÅÁ†Å",-1))]),o(n,{model:V,rules:$,ref_key:"bindFormRef",ref:g,"label-width":"0"},{default:l(()=>[o(R,{prop:"google_code"},{default:l(()=>[o(B,{modelValue:V.google_code,"onUpdate:modelValue":e[0]||(e[0]=S=>V.google_code=S),placeholder:"ËØ∑ËæìÂÖ•6‰ΩçÈ™åËØÅÁ†Å",maxlength:"6",size:"large",class:"verification-input"},{prefix:l(()=>[o(u,null,{default:l(()=>[o(b(j))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),s("div",Ve,[o(C,{onClick:D},{default:l(()=>[...e[12]||(e[12]=[q("‰∏ä‰∏ÄÊ≠•",-1)])]),_:1}),o(C,{onClick:E,type:"primary",loading:p.value,disabled:!V.google_code},{default:l(()=>[...e[13]||(e[13]=[q(" ÂÆåÊàêÁªëÂÆö ",-1)])]),_:1},8,["loading","disabled"])])])):G("",!0),c.value===3?(v(),x("div",Ce,[s("div",xe,[o(u,{class:"success-icon"},{default:l(()=>[o(b(le))]),_:1}),e[15]||(e[15]=s("h3",null,"ÁªëÂÆöÊàêÂäü",-1)),e[16]||(e[16]=s("p",null,"Ë∞∑Ê≠åÈ™åËØÅÁ†ÅÂ∑≤ÊàêÂäüÁªëÂÆöÂà∞ÊÇ®ÁöÑË¥¶Êà∑",-1)),o(C,{onClick:d,type:"primary",size:"large"},{default:l(()=>[...e[14]||(e[14]=[q(" ÂÆåÊàê ",-1)])]),_:1})])])):G("",!0)])]),_:1},8,["modelValue"])}}}),Se=Z(Ae,[["__scopeId","data-v-476542ff"]]),Ie={class:"dialog-footer"},$e=K({__name:"ChangePasswordDialog",emits:["success","close"],setup(I,{expose:U,emit:w}){const h=w,_=t(!1),c=t(!1),y=t(0),p=O({new_password:"",confirm_password:""}),A=t(),f={new_password:[{required:!0,message:"ËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†Å",trigger:"blur"},{min:8,message:"ÂØÜÁ†ÅÈïøÂ∫¶Ëá≥Â∞ë8‰Ωç",trigger:"blur"},{validator:(g,a,r)=>{a&&a.length<8?r(new Error("ÂØÜÁ†ÅÈïøÂ∫¶Ëá≥Â∞ë8‰Ωç")):a&&!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^a-zA-Z\d])/.test(a)?r(new Error("ÂØÜÁ†ÅÂøÖÈ°ªÂåÖÂê´Â§ßÂ∞èÂÜôÂ≠óÊØç„ÄÅÊï∞Â≠ó„ÄÅÁâπÊÆäÂ≠óÁ¨¶")):r()},trigger:"blur"}],confirm_password:[{required:!0,message:"ËØ∑Á°ÆËÆ§ÂØÜÁ†Å",trigger:"blur"},{validator:(g,a,r)=>{a!==p.new_password?r(new Error("‰∏§Ê¨°ËæìÂÖ•ÁöÑÂØÜÁ†Å‰∏ç‰∏ÄËá¥")):r()},trigger:"blur"}]},V=g=>{_.value=!0,y.value=g,p.new_password="",p.confirm_password=""},$=async()=>{var g,a;try{await((g=A.value)==null?void 0:g.validate()),c.value=!0;const r=await P.post("/api/v1/admin/change-password",{admin_id:y.value,new_password:p.new_password,confirm_password:p.confirm_password});console.log("ÂØÜÁ†Å‰øÆÊîπAPIÂìçÂ∫î:",r),r.code===200&&(k.success("ÂØÜÁ†Å‰øÆÊîπÊàêÂäüÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï"),_.value=!1,h("success"))}catch(r){console.error("ÂØÜÁ†Å‰øÆÊîπÂ§±Ë¥•:",r),console.error("ÈîôËØØËØ¶ÊÉÖ:",(a=r.response)==null?void 0:a.data)}finally{c.value=!1}};return U({open:V}),(g,a)=>{const r=ee,D=Q,z=M,E=T,d=N,i=Y;return v(),W(i,{modelValue:_.value,"onUpdate:modelValue":a[3]||(a[3]=e=>_.value=e),title:"‰øÆÊîπÂØÜÁ†Å",width:"500px","close-on-click-modal":!1,"show-close":!1,"close-on-press-escape":!1,"destroy-on-close":""},{footer:l(()=>[s("div",Ie,[o(d,{onClick:$,type:"primary",loading:c.value},{default:l(()=>[...a[4]||(a[4]=[q(" Á°ÆËÆ§‰øÆÊîπ ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[o(r,{title:"È¶ñÊ¨°ÁôªÂΩïÈúÄË¶Å‰øÆÊîπÂØÜÁ†Å",type:"warning",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}}),o(E,{ref_key:"formRef",ref:A,model:p,rules:f,"label-width":"120px",onSubmit:a[2]||(a[2]=ae(()=>{},["prevent"]))},{default:l(()=>[o(z,{label:"Êñ∞ÂØÜÁ†Å",prop:"new_password"},{default:l(()=>[o(D,{modelValue:p.new_password,"onUpdate:modelValue":a[0]||(a[0]=e=>p.new_password=e),type:"password",placeholder:"ËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†Å","show-password":"",clearable:"",onKeyup:L($,["enter"])},null,8,["modelValue"])]),_:1}),o(z,{label:"Á°ÆËÆ§ÂØÜÁ†Å",prop:"confirm_password"},{default:l(()=>[o(D,{modelValue:p.confirm_password,"onUpdate:modelValue":a[1]||(a[1]=e=>p.confirm_password=e),type:"password",placeholder:"ËØ∑ÂÜçÊ¨°ËæìÂÖ•Êñ∞ÂØÜÁ†Å","show-password":"",clearable:"",onKeyup:L($,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),qe=Z($e,[["__scopeId","data-v-8ea8ed6c"]]),Ee="/assets/login-header-C_4yz5CA.png",De={class:"login-container"},ze={class:"login-content"},Be={class:"login-card"},Re={class:"login-header"},Ue={class:"logo-container"},Ge=["src"],Pe={class:"login-form-container"},Fe={class:"form-item"},Le={class:"form-item"},Ke={key:0,class:"form-item google-auth-input"},Ne={class:"form-submit"},Te={key:0},Me={key:1},Qe=K({__name:"Login",setup(I){const U=ne(),w=t(""),h=t(""),_=t(""),c=t(!1),y=t(!1),p=t(),A=t(!1),f=t(null),V=t(),$=t(!1),g=t(null),a=t({username:"",password:"",googleAuthCode:""}),r=async()=>{var E,d,i,e,u,C,B,R;if(!w.value||!h.value){k.error("ËØ∑ËæìÂÖ•Ë¥¶Âè∑ÂíåÂØÜÁ†Å");return}try{y.value=!0;const n=await ie({username:w.value,password:h.value,google_code:c.value?_.value:""});if((E=n.data)!=null&&E.need_change_password){$.value=!0,g.value=n.data,(d=V.value)==null||d.open(n.data.admin_id);return}if((i=n.data)!=null&&i.need_bind_google){A.value=!0,f.value=n.data,(e=p.value)==null||e.open(n.data.admin_id,n.data.username);return}const m=n;console.log("üîç ÁôªÂΩïÂìçÂ∫îÊï∞ÊçÆ:",m),console.log("üîç responseData.data:",m.data);const S=((u=m.data)==null?void 0:u.Authorization)||((B=(C=m.data)==null?void 0:C.data)==null?void 0:B.Authorization)||localStorage.getItem("token");console.log("üîç Ëé∑ÂèñÂà∞ÁöÑtoken:",S),console.log("üîç localStorage‰∏≠ÁöÑtoken:",localStorage.getItem("token")),m.status===!0||m.code===200||m.code===0||S?(S?(localStorage.setItem("token",S),console.log("‚úÖ ÁôªÂΩïÈ°µÈù¢ÂÜçÊ¨°‰øùÂ≠òtokenÔºåÈ™åËØÅ:",localStorage.getItem("token")),window.dispatchEvent(new CustomEvent("tokenSet",{detail:{token:S}}))):console.error("‚ùå token‰∏∫Á©∫ÔºåÊó†Ê≥ï‰øùÂ≠ò"),k.success("ÁôªÂΩïÊàêÂäü"),await de(),U.push("/dashboard").catch(()=>{})):k.error(m.message||((R=m.data)==null?void 0:R.message)||"ÁôªÂΩïÂ§±Ë¥•")}catch(n){n.message&&n.message.includes("ËØ∑ËæìÂÖ•Ë∞∑Ê≠åÈ™åËØÅÁ†Å")&&(c.value=!0,setTimeout(()=>{const m=document.querySelector(".google-auth-input .el-input__inner");m&&m.focus()},100)),console.error("ÁôªÂΩïÈîôËØØ:",n)}finally{y.value=!1}},D=()=>{A.value=!1,f.value=null,k.success("Ë∞∑Ê≠åÈ™åËØÅÁ†ÅÁªëÂÆöÊàêÂäüÔºåÈ°µÈù¢Â∞ÜËá™Âä®Âà∑Êñ∞ÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï"),w.value="",h.value="",_.value=""},z=()=>{$.value=!1,g.value=null,k.success("ÂØÜÁ†Å‰øÆÊîπÊàêÂäüÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï"),w.value="",h.value="",_.value=""};return(E,d)=>{const i=X,e=Q,u=M,C=ee,B=N,R=T;return v(),x("div",De,[d[5]||(d[5]=te('<div class="background-decoration" data-v-a22fbcf5><div class="floating-shapes" data-v-a22fbcf5><div class="shape shape-1" data-v-a22fbcf5></div><div class="shape shape-2" data-v-a22fbcf5></div><div class="shape shape-3" data-v-a22fbcf5></div><div class="shape shape-4" data-v-a22fbcf5></div></div></div>',1)),s("div",ze,[s("div",Be,[s("div",Re,[s("div",Ue,[s("img",{src:b(Ee),alt:"Á≥ªÁªüLogo",class:"logo"},null,8,Ge)]),d[3]||(d[3]=s("h1",{class:"welcome-title"},"Ê¨¢ËøéÁôªÂΩï",-1)),d[4]||(d[4]=s("p",{class:"welcome-subtitle"},"Áôæ‰∫ø‰∏âÊñπÊîØ‰ªòÁÆ°ÁêÜÁ≥ªÁªü",-1))]),s("div",Pe,[o(R,{model:a.value,class:"login-form","label-position":"top",size:"large"},{default:l(()=>[s("div",Fe,[o(u,null,{default:l(()=>[o(e,{modelValue:w.value,"onUpdate:modelValue":d[0]||(d[0]=n=>w.value=n),placeholder:"ËØ∑ËæìÂÖ•ÁôªÂΩïË¥¶Âè∑",class:"custom-input",clearable:""},{prefix:l(()=>[o(i,{class:"input-icon"},{default:l(()=>[o(b(re))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),s("div",Le,[o(u,null,{default:l(()=>[o(e,{modelValue:h.value,"onUpdate:modelValue":d[1]||(d[1]=n=>h.value=n),type:"password",placeholder:"ËØ∑ËæìÂÖ•ÁôªÂΩïÂØÜÁ†Å",class:"custom-input","show-password":"",clearable:""},{prefix:l(()=>[o(i,{class:"input-icon"},{default:l(()=>[o(b(F))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),c.value?(v(),x("div",Ke,[o(C,{title:"ËØ∑ËæìÂÖ•Ë∞∑Ê≠åÈ™åËØÅÁ†Å",type:"info",closable:!1,"show-icon":"",class:"google-auth-alert"}),o(u,null,{default:l(()=>[o(e,{modelValue:_.value,"onUpdate:modelValue":d[2]||(d[2]=n=>_.value=n),placeholder:"ËØ∑ËæìÂÖ•6‰ΩçÈ™åËØÅÁ†Å",class:"custom-input",clearable:"",maxlength:"6",onKeyup:L(r,["enter"])},{prefix:l(()=>[o(i,{class:"input-icon"},{default:l(()=>[o(b(F))]),_:1})]),_:1},8,["modelValue"])]),_:1})])):G("",!0),s("div",Ne,[o(B,{type:"primary",size:"large",class:"login-button",onClick:r,disabled:!w.value||!h.value,loading:y.value},{default:l(()=>[y.value?(v(),x("span",Me,"ÁôªÂΩï‰∏≠...")):(v(),x("span",Te,"ÁôªÂΩïË¥¶Âè∑"))]),_:1},8,["disabled","loading"])])]),_:1},8,["model"])])])]),o(Se,{ref_key:"googleAuthBindRef",ref:p,onSuccess:D},null,512),o(qe,{ref_key:"changePasswordRef",ref:V,onSuccess:z},null,512)])}}}),He=Z(Qe,[["__scopeId","data-v-a22fbcf5"]]);export{He as default};
//# sourceMappingURL=Login-CqdtC_pc.js.map
