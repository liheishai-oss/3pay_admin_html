import{d as F,g as r,a8 as b,i as g,w as s,s as m,C as c,D as G,o as i,a as o,x as R,j as E,y as O,c as w,ao as $,L as j,ar as z,ap as M,z as P,W,e as H,q as J,n as x,_ as K}from"./index-BtkdBdlp.js";/* empty css               */const Q={key:0,class:"form-tip"},X={class:"dialog-footer"},Y=F({__name:"edit",emits:["refresh"],setup(Z,{expose:k,emit:I}){const U=I,p=r({}),d=b(()=>{var a;return((a=p.value)==null?void 0:a.is_agent)===!0}),n=r(!1),_=r(!1),v=r(null),y=r([]),l=r({id:0,agent_id:"",payee_name:"",payee_account:"",payee_user_id:"",status:1}),h=b(()=>{const a={payee_name:[{required:!0,message:"请输入收款人姓名",trigger:"blur"}],payee_account:[{required:!0,message:"请输入收款人账号",trigger:"blur"}],payee_user_id:[{required:!0,message:"请输入收款人用户ID",trigger:"blur"}]};return d.value||(a.agent_id=[{required:!0,message:"请选择代理商",trigger:"change"}]),a}),C=async()=>{try{const a=await m({url:"/api/v1/admin/user/info",method:"GET"});a.status&&(p.value=a.data)}catch(a){console.error("获取用户信息失败:",a)}},T=async()=>{if(!d.value)try{const a=await m({url:"/api/v1/admin/single-royalty/agent-list",method:"GET"});a.status&&(y.value=a.data)}catch(a){console.error("获取代理商列表失败:",a)}},q=async a=>{if(await C(),await T(),a.id)try{const e=await m({url:`/api/v1/admin/single-royalty/detail/${a.id}`,method:"GET"});e.status&&(l.value={...e.data})}catch(e){console.error("获取详情失败:",e),c.error("获取详情失败");return}else{const e=d.value?p.value.agent_id:"";l.value={id:0,agent_id:e,payee_name:"",payee_account:"",payee_user_id:"",status:1}}n.value=!0,setTimeout(()=>{var e;(e=v.value)==null||e.clearValidate()},100)},B=async()=>{try{await v.value.validate(),_.value=!0;const a=l.value.id?"/api/v1/admin/single-royalty/edit":"/api/v1/admin/single-royalty/add",e=await m({url:a,method:"POST",data:l.value});e.status?(c.success(e.msg||"操作成功"),n.value=!1,U("refresh")):c.error(e.msg||"操作失败")}catch(a){console.error("提交失败:",a),a!==!1&&c.error("提交失败")}finally{_.value=!1}};return k({open:q}),(a,e)=>{const D=M,L=$,u=O,f=P,N=W,S=R,V=J,A=G;return i(),g(A,{modelValue:n.value,"onUpdate:modelValue":e[6]||(e[6]=t=>n.value=t),title:l.value.id?"编辑单笔分账":"新增单笔分账",width:"600px","close-on-click-modal":!1},{footer:s(()=>[H("span",X,[o(V,{onClick:e[5]||(e[5]=t=>n.value=!1)},{default:s(()=>[...e[7]||(e[7]=[x("取消",-1)])]),_:1}),o(V,{type:"primary",onClick:B,loading:_.value},{default:s(()=>[...e[8]||(e[8]=[x(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:s(()=>[o(S,{ref_key:"formRef",ref:v,model:l.value,rules:h.value,"label-width":"140px"},{default:s(()=>[d.value?E("",!0):(i(),g(u,{key:0,label:"代理商",prop:"agent_id"},{default:s(()=>[o(L,{modelValue:l.value.agent_id,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.agent_id=t),placeholder:"请选择代理商",clearable:"",filterable:"",disabled:l.value.id>0},{default:s(()=>[(i(!0),w(j,null,z(y.value,t=>(i(),g(D,{key:t.id,label:t.agent_name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l.value.id>0?(i(),w("div",Q,"代理商创建后不可修改")):E("",!0)]),_:1})),o(u,{label:"收款人姓名",prop:"payee_name"},{default:s(()=>[o(f,{modelValue:l.value.payee_name,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.payee_name=t),placeholder:"请输入收款人姓名",clearable:""},null,8,["modelValue"])]),_:1}),o(u,{label:"收款人账号",prop:"payee_account"},{default:s(()=>[o(f,{modelValue:l.value.payee_account,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.payee_account=t),placeholder:"请输入收款人账号",clearable:""},null,8,["modelValue"])]),_:1}),o(u,{label:"收款人用户ID",prop:"payee_user_id"},{default:s(()=>[o(f,{modelValue:l.value.payee_user_id,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.payee_user_id=t),placeholder:"请输入收款人用户ID",clearable:""},null,8,["modelValue"])]),_:1}),o(u,{label:"状态",prop:"status"},{default:s(()=>[o(N,{modelValue:l.value.status,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.status=t),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),le=K(Y,[["__scopeId","data-v-47e45358"]]);export{le as default};
//# sourceMappingURL=edit-CWl3c0is.js.map
