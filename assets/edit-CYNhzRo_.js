import{d as A,r as n,c as V,g as f,w as o,s as c,E as m,U as G,n as u,e as s,Q as O,f as E,R as $,a as w,j,F as D,q as H,H as M,S as P,a6 as Q,b as z,l as J,p as k,_ as K}from"./index-BlNhG5G6.js";/* empty css               */const W={key:0,class:"form-tip"},X={class:"dialog-footer"},Y=A({__name:"edit",emits:["refresh"],setup(Z,{expose:x,emit:h}){const U=h,p=n({}),i=V(()=>{var a;return((a=p.value)==null?void 0:a.is_agent)===!0}),r=n(!1),_=n(!1),v=n(null),g=n([]),t=n({id:0,agent_id:"",payee_name:"",payee_account:"",status:1}),I=V(()=>{const a={payee_name:[{required:!0,message:"请输入收款人姓名",trigger:"blur"}],payee_account:[{required:!0,message:"请输入收款人账号",trigger:"blur"}]};return i.value||(a.agent_id=[{required:!0,message:"请选择代理商",trigger:"change"}]),a}),T=async()=>{try{const a=await c({url:"/api/v1/admin/user/info",method:"GET"});a.status&&(p.value=a.data)}catch(a){console.error("获取用户信息失败:",a)}},B=async()=>{if(!i.value)try{const a=await c({url:"/api/v1/admin/single-royalty/agent-list",method:"GET"});a.status&&(g.value=a.data)}catch(a){console.error("获取代理商列表失败:",a)}},C=async a=>{if(await T(),await B(),a.id)try{const e=await c({url:`/api/v1/admin/single-royalty/detail/${a.id}`,method:"GET"});e.status&&(t.value={...e.data})}catch(e){console.error("获取详情失败:",e),m.error("获取详情失败");return}else{const e=i.value?p.value.agent_id:"";t.value={id:0,agent_id:e,payee_name:"",payee_account:"",status:1}}r.value=!0,setTimeout(()=>{var e;(e=v.value)==null||e.clearValidate()},100)},S=async()=>{try{await v.value.validate(),_.value=!0;const a=t.value.id?"/api/v1/admin/single-royalty/edit":"/api/v1/admin/single-royalty/add",e=await c({url:a,method:"POST",data:t.value});e.status?(m.success(e.msg||"操作成功"),r.value=!1,U("refresh")):m.error(e.msg||"操作失败")}catch(a){console.error("提交失败:",a),a!==!1&&m.error("提交失败")}finally{_.value=!1}};return x({open:C}),(a,e)=>{const q=M,F=j,d=$,y=P,L=Q,N=O,b=J,R=G;return u(),f(R,{modelValue:r.value,"onUpdate:modelValue":e[5]||(e[5]=l=>r.value=l),title:t.value.id?"编辑单笔分账":"新增单笔分账",width:"600px","close-on-click-modal":!1},{footer:o(()=>[z("span",X,[s(b,{onClick:e[4]||(e[4]=l=>r.value=!1)},{default:o(()=>[...e[6]||(e[6]=[k("取消",-1)])]),_:1}),s(b,{type:"primary",onClick:S,loading:_.value},{default:o(()=>[...e[7]||(e[7]=[k(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:o(()=>[s(N,{ref_key:"formRef",ref:v,model:t.value,rules:I.value,"label-width":"140px"},{default:o(()=>[i.value?E("",!0):(u(),f(d,{key:0,label:"代理商",prop:"agent_id"},{default:o(()=>[s(F,{modelValue:t.value.agent_id,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.agent_id=l),placeholder:"请选择代理商",clearable:"",filterable:"",disabled:t.value.id>0},{default:o(()=>[(u(!0),w(D,null,H(g.value,l=>(u(),f(q,{key:l.id,label:l.agent_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),t.value.id>0?(u(),w("div",W,"代理商创建后不可修改")):E("",!0)]),_:1})),s(d,{label:"收款人姓名",prop:"payee_name"},{default:o(()=>[s(y,{modelValue:t.value.payee_name,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.payee_name=l),placeholder:"请输入收款人姓名",clearable:""},null,8,["modelValue"])]),_:1}),s(d,{label:"收款人账号",prop:"payee_account"},{default:o(()=>[s(y,{modelValue:t.value.payee_account,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.payee_account=l),placeholder:"请输入收款人账号",clearable:""},null,8,["modelValue"])]),_:1}),s(d,{label:"状态",prop:"status"},{default:o(()=>[s(L,{modelValue:t.value.status,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.status=l),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),te=K(Y,[["__scopeId","data-v-45489a81"]]);export{te as default};
//# sourceMappingURL=edit-CYNhzRo_.js.map
