import{d as ge,r as w,c as P,o as be,a as c,e as a,b as f,w as t,a0 as ke,J as v,p as n,t as u,F as L,s as C,l as he,a1 as we,A as xe,a2 as Ve,U as Ce,n as s,z as Ee,x as Se,Q as De,i as Te,g as d,f as b,v as ze,R as Ue,S as Me,j as Be,q as Ie,H as Re,k as Ye,I as $e,a5 as O,K as q,a3 as Fe,B as He,h as Pe,aw as Ge,ax as Ne,E as Y,aH as je,_ as Ae}from"./index-CZqKrVMb.js";/* empty css                          *//* empty css                   *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                          */import{u as Le}from"./table.plugin-sb-Y0yXn.js";const Oe={class:"table-com-search"},qe={class:"search-buttons"},Je={class:"table-header ba-scroll-style"},Ke={class:"table-statistics-bar"},Qe={class:"stat stat-amt"},We={class:"stat-num"},Xe={class:"stat"},Ze={class:"stat-num"},et={class:"stat stat-succ"},tt={class:"stat-num"},at={class:"table-search"},lt={style:{width:"100%","overflow-x":"auto"},class:"table-content"},ot={key:0},st={key:1},nt={key:2},rt={key:0},ut={key:5},dt=["title"],_t={key:1},it={class:"table-footer"},yt={class:"table-pagination"},pt={key:0},mt={key:1},ct={key:3},ft={key:0},vt={key:5},gt={key:0,style:{color:"#f56c6c"}},bt={key:1},kt=ge({__name:"order",setup(ht){const{loadData:J,data:x,refreshData:E,handleSizeChange:K,handleCurrentChange:Q,searchParams:S,isVisible:W,toggleVisibility:X}=Le("/api/v1/admin/single-royalty/order-list"),Z=()=>{const o=new Date,e=o.getFullYear(),B=String(o.getMonth()+1).padStart(2,"0"),k=String(o.getDate()).padStart(2,"0");return`${e}-${B}-${k}`},D=()=>{const o=Z();return[`${o} 00:00:00`,`${o} 23:59:59`]},$=w(D()),_=w({platform_order_no:"",merchant_order_no:"",merchant_id:"",pay_status:"",royalty_status:"",royalty_type:"",start_time:D()[0],end_time:D()[1]}),ee=o=>{o&&o.length===2?(_.value.start_time=o[0],_.value.end_time=o[1]):(_.value.start_time="",_.value.end_time="")},G=w([]),T=w({today_amount:0,yesterday_amount:0,history_amount:0}),F=w(!1),r=w(null),z=w({}),U=P(()=>{var o;return((o=z.value)==null?void 0:o.is_agent)===!0}),te=P(()=>{var o;return((o=z.value)==null?void 0:o.user_group_id)===1}),M=P(()=>{var e;const o=(e=z.value)==null?void 0:e.user_group_id;return Number(o)===4}),ae=async()=>{try{const o=await C({url:"/api/v1/admin/user/info",method:"GET"});o.status&&(z.value=o.data)}catch(o){console.error("获取用户信息失败:",o)}},le=async()=>{if(!(M.value||U.value))try{const o=await C({url:"/api/v1/admin/order/merchant-list",method:"GET"});o.status&&(G.value=o.data)}catch(o){console.error("获取商户列表失败:",o)}},H=async()=>{try{const o=await C({url:"/api/v1/admin/single-royalty/order-statistics",method:"GET",params:S.value});o.status&&(T.value=o.data)}catch(o){console.error("获取统计失败:",o)}},oe=async()=>{S.value={..._.value},await E(),await H()},se=()=>{const o=D();$.value=o,_.value={platform_order_no:"",merchant_order_no:"",merchant_id:"",pay_status:"",royalty_status:"",royalty_type:"",start_time:o[0],end_time:o[1]},S.value={..._.value},E(),H()},ne=w([]),re=o=>{ne.value=o},ue=async o=>{try{const e=await C({url:`/api/v1/admin/single-royalty/order-detail/${o.id}`,method:"GET"});e.status&&(r.value=e.data,F.value=!0)}catch(e){console.error("获取详情失败:",e),Y.error("获取详情失败")}},de=async o=>{try{await je.confirm(`确定要对订单进行手动分账吗？
订单号：${o.platform_order_no||o.order_no}`,"手动分账",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await C({url:"/api/v1/admin/single-royalty/order-manual-royalty",method:"POST",data:{order_id:o.id}});e.status?(Y.success(e.msg||"分账成功"),await E()):Y.error(e.msg||"分账失败")}catch(e){e!=="cancel"&&(console.error("分账失败:",e),Y.error(e.message||"分账失败"))}};return be(async()=>{await ae(),await le(),S.value={..._.value},J(),await H()}),(o,e)=>{const B=Me,k=Ue,h=ze,m=Re,I=Be,N=Te,_e=Ye,j=$e,V=he,ie=De,ye=Se,pe=we,g=He,i=Pe,me=xe,ce=Ve,y=Ne,fe=Ge,ve=Ce;return s(),c(L,null,[a(ke,{name:"fade"},{default:t(()=>[Ee(f("div",Oe,[a(ye,{class:"search-card",shadow:"never"},{default:t(()=>[a(ie,{model:_.value,"label-width":"100px",class:"search-form"},{default:t(()=>[a(N,{gutter:20},{default:t(()=>[a(h,{span:6},{default:t(()=>[a(k,{label:"平台订单号"},{default:t(()=>[a(B,{modelValue:_.value.platform_order_no,"onUpdate:modelValue":e[0]||(e[0]=l=>_.value.platform_order_no=l),placeholder:"请输入平台订单号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),a(h,{span:6},{default:t(()=>[a(k,{label:"商户订单号"},{default:t(()=>[a(B,{modelValue:_.value.merchant_order_no,"onUpdate:modelValue":e[1]||(e[1]=l=>_.value.merchant_order_no=l),placeholder:"请输入商户订单号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),!M.value&&!U.value?(s(),d(h,{key:0,span:6},{default:t(()=>[a(k,{label:"商户"},{default:t(()=>[a(I,{modelValue:_.value.merchant_id,"onUpdate:modelValue":e[2]||(e[2]=l=>_.value.merchant_id=l),placeholder:"请选择商户",clearable:"",filterable:"",style:{width:"100%"}},{default:t(()=>[(s(!0),c(L,null,Ie(G.value,l=>(s(),d(m,{key:l.id,label:l.merchant_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):b("",!0),a(h,{span:6},{default:t(()=>[a(k,{label:"支付状态"},{default:t(()=>[a(I,{modelValue:_.value.pay_status,"onUpdate:modelValue":e[3]||(e[3]=l=>_.value.pay_status=l),placeholder:"请选择订单状态",clearable:"",style:{width:"100%"}},{default:t(()=>[a(m,{label:"全部",value:""}),a(m,{label:"已创建",value:0}),a(m,{label:"已打开",value:4}),a(m,{label:"已支付",value:1}),a(m,{label:"已关闭",value:2}),a(m,{label:"已退款",value:3})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(N,{gutter:20},{default:t(()=>[a(h,{span:6},{default:t(()=>[a(k,{label:"分账状态"},{default:t(()=>[a(I,{modelValue:_.value.royalty_status,"onUpdate:modelValue":e[4]||(e[4]=l=>_.value.royalty_status=l),placeholder:"请选择分账状态",clearable:"",style:{width:"100%"}},{default:t(()=>[a(m,{label:"全部",value:""}),a(m,{label:"待分账",value:0}),a(m,{label:"分账中",value:1}),a(m,{label:"分账成功",value:2}),a(m,{label:"分账失败",value:3})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(h,{span:6},{default:t(()=>[a(k,{label:"分账类型"},{default:t(()=>[a(I,{modelValue:_.value.royalty_type,"onUpdate:modelValue":e[5]||(e[5]=l=>_.value.royalty_type=l),placeholder:"请选择分账类型",clearable:"",style:{width:"100%"}},{default:t(()=>[a(m,{label:"全部",value:""}),a(m,{label:"不分账",value:"none"}),a(m,{label:"单笔分账",value:"single"}),a(m,{label:"商家分账",value:"merchant"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(h,{span:6},{default:t(()=>[a(k,{label:"分账时间"},{default:t(()=>[a(_e,{modelValue:$.value,"onUpdate:modelValue":e[6]||(e[6]=l=>$.value=l),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"},onChange:ee,clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(h,{span:6},{default:t(()=>[a(k,null,{default:t(()=>[f("div",qe,[a(V,{type:"primary",onClick:oe},{default:t(()=>[a(j,null,{default:t(()=>[a(v(O))]),_:1}),e[10]||(e[10]=n("搜索 ",-1))]),_:1}),a(V,{onClick:se},{default:t(()=>[a(j,null,{default:t(()=>[a(v(q))]),_:1}),e[11]||(e[11]=n("重置 ",-1))]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[Fe,v(W)]])]),_:1}),f("div",Je,[a(V,{icon:v(q),onClick:v(E),color:"#40485b"},null,8,["icon","onClick"]),f("div",Ke,[f("span",Qe,[e[12]||(e[12]=n("总分账金额: ",-1)),f("b",We,"¥"+u(T.value.history_amount??0),1)]),e[15]||(e[15]=f("span",{class:"split"},"|",-1)),f("span",Xe,[e[13]||(e[13]=n("昨日分账金额: ",-1)),f("b",Ze,"¥"+u(T.value.yesterday_amount??0),1)]),e[16]||(e[16]=f("span",{class:"split"},"|",-1)),f("span",et,[e[14]||(e[14]=n("今日分账金额: ",-1)),f("b",tt,"¥"+u(T.value.today_amount??0),1)])]),f("div",at,[a(pe,{class:"ml-4"},{default:t(()=>[a(V,{icon:v(O),onClick:v(X)},null,8,["icon","onClick"])]),_:1})])]),f("div",lt,[a(me,{data:v(x).data,border:"",stripe:"","max-height":"600",style:{width:"100%"},onSelectionChange:re},{default:t(()=>[a(g,{type:"selection",width:"40"}),a(g,{label:"分账主体",align:"center","min-width":"150"},{default:t(({row:l})=>[n(u(l.royalty_subject_name||"-"),1)]),_:1}),a(g,{prop:"order_no",label:"订单号",align:"center","min-width":"200"},{default:t(({row:l})=>[n(u(l.order_no||l.platform_order_no||"-"),1)]),_:1}),a(g,{label:"收款账号",align:"center","min-width":"180"},{default:t(({row:l})=>[n(u(l.payee_account||"-"),1)]),_:1}),a(g,{label:"订单金额",align:"center",width:"100"},{default:t(({row:l})=>[n(" ¥"+u(l.order_amount||"0.00"),1)]),_:1}),a(g,{label:"分账金额",align:"center",width:"100"},{default:t(({row:l})=>[l.royalty_amount>0?(s(),c("span",ot,"¥"+u(l.royalty_amount),1)):(s(),c("span",st,"-"))]),_:1}),a(g,{label:"分账方式",align:"center",width:"100"},{default:t(({row:l})=>[l.royalty_method==="manual"?(s(),d(i,{key:0,type:"warning"},{default:t(()=>[...e[17]||(e[17]=[n("手动",-1)])]),_:1})):l.royalty_method==="auto"?(s(),d(i,{key:1,type:"success"},{default:t(()=>[...e[18]||(e[18]=[n("自动",-1)])]),_:1})):(s(),c("span",nt,"-"))]),_:1}),a(g,{label:"分账状态",align:"center","min-width":"120"},{default:t(({row:l})=>[!l.royalty_status_text||l.royalty_status_text==="-"?(s(),c("span",rt,"-")):l.royalty_status_text==="待分账"?(s(),d(i,{key:1,type:"info"},{default:t(()=>[...e[19]||(e[19]=[n("待分账",-1)])]),_:1})):l.royalty_status_text==="分账中"?(s(),d(i,{key:2,type:"warning"},{default:t(()=>[...e[20]||(e[20]=[n("分账中",-1)])]),_:1})):l.royalty_status_text==="分账成功"?(s(),d(i,{key:3,type:"success"},{default:t(()=>[...e[21]||(e[21]=[n("分账成功",-1)])]),_:1})):l.royalty_status_text==="分账失败"?(s(),d(i,{key:4,type:"danger"},{default:t(()=>[...e[22]||(e[22]=[n("分账失败",-1)])]),_:1})):(s(),c("span",ut,u(l.royalty_status_text),1))]),_:1}),a(g,{label:"创建时间",align:"center","min-width":"160"},{default:t(({row:l})=>[n(u(l.created_at||"-"),1)]),_:1}),a(g,{label:"分账时间",align:"center","min-width":"160"},{default:t(({row:l})=>[n(u(l.royalty_time||"-"),1)]),_:1}),a(g,{label:"备注",align:"center","min-width":"150"},{default:t(({row:l})=>[l.royalty_status===3&&l.royalty_error?(s(),c("span",{key:0,style:{color:"#f56c6c"},title:l.royalty_error},u(l.order_remark||"-"),9,dt)):(s(),c("span",_t,u(l.order_remark||"-"),1))]),_:1}),a(g,{label:"操作",align:"center",fixed:"right","min-width":"150"},{default:t(l=>[a(V,{size:"small",type:"primary",onClick:R=>ue(l.row)},{default:t(()=>[...e[23]||(e[23]=[n("详情",-1)])]),_:1},8,["onClick"]),l.row.can_manual_royalty?(s(),d(V,{key:0,size:"small",type:"warning",onClick:R=>de(l.row)},{default:t(()=>[...e[24]||(e[24]=[n(" 分账 ",-1)])]),_:1},8,["onClick"])):b("",!0)]),_:1})]),_:1},8,["data"])]),f("div",it,[f("div",yt,[a(ce,{"current-page":v(x).current_page,"onUpdate:currentPage":e[7]||(e[7]=l=>v(x).current_page=l),"page-size":v(x).page_size,"onUpdate:pageSize":e[8]||(e[8]=l=>v(x).page_size=l),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:v(x).page_total,onSizeChange:v(K),onCurrentChange:v(Q)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),a(ve,{modelValue:F.value,"onUpdate:modelValue":e[9]||(e[9]=l=>F.value=l),title:"分账订单详情",width:"800px"},{default:t(()=>[r.value?(s(),d(fe,{key:0,column:2,border:""},{default:t(()=>{var l,R;return[a(y,{label:"平台订单号"},{default:t(()=>[n(u(r.value.platform_order_no),1)]),_:1}),a(y,{label:"商户订单号"},{default:t(()=>[n(u(r.value.merchant_order_no),1)]),_:1}),a(y,{label:"订单金额"},{default:t(()=>[n("¥"+u(r.value.order_amount),1)]),_:1}),a(y,{label:"分账金额"},{default:t(()=>[r.value.royalty_amount>0?(s(),c("span",pt,"¥"+u(r.value.royalty_amount),1)):(s(),c("span",mt,"-"))]),_:1}),te.value?(s(),d(y,{key:0,label:"代理商"},{default:t(()=>{var p;return[n(u(((p=r.value.agent)==null?void 0:p.agent_name)||"-"),1)]}),_:1})):b("",!0),!M.value&&!U.value?(s(),d(y,{key:1,label:"商户"},{default:t(()=>{var p;return[n(u(((p=r.value.merchant)==null?void 0:p.merchant_name)||"-"),1)]}),_:1})):b("",!0),a(y,{label:"产品"},{default:t(()=>{var p;return[n(u(((p=r.value.product)==null?void 0:p.product_name)||"-"),1)]}),_:1}),!M.value&&!U.value?(s(),d(y,{key:2,label:"主体"},{default:t(()=>{var p;return[n(u(((p=r.value.subject)==null?void 0:p.company_name)||"-"),1)]}),_:1})):b("",!0),a(y,{label:"分账类型"},{default:t(()=>[r.value.royalty_type==="none"?(s(),d(i,{key:0,type:"info"},{default:t(()=>[...e[25]||(e[25]=[n("不分账",-1)])]),_:1})):r.value.royalty_type==="single"?(s(),d(i,{key:1,type:"success"},{default:t(()=>[...e[26]||(e[26]=[n("单笔分账",-1)])]),_:1})):r.value.royalty_type==="merchant"?(s(),d(i,{key:2,type:"warning"},{default:t(()=>[...e[27]||(e[27]=[n("商家分账",-1)])]),_:1})):(s(),c("span",ct,"-"))]),_:1}),a(y,{label:"支付状态"},{default:t(()=>[r.value.pay_status===0?(s(),d(i,{key:0,type:"info"},{default:t(()=>[...e[28]||(e[28]=[n("已创建",-1)])]),_:1})):r.value.pay_status===4?(s(),d(i,{key:1,type:"warning"},{default:t(()=>[...e[29]||(e[29]=[n("已打开",-1)])]),_:1})):r.value.pay_status===1?(s(),d(i,{key:2,type:"success"},{default:t(()=>[...e[30]||(e[30]=[n("已支付",-1)])]),_:1})):r.value.pay_status===2?(s(),d(i,{key:3,type:"warning"},{default:t(()=>[...e[31]||(e[31]=[n("已关闭",-1)])]),_:1})):r.value.pay_status===3?(s(),d(i,{key:4,type:"danger"},{default:t(()=>[...e[32]||(e[32]=[n("已退款",-1)])]),_:1})):b("",!0)]),_:1}),a(y,{label:"分账状态"},{default:t(()=>[!r.value.royalty_status_text||r.value.royalty_status_text==="-"?(s(),c("span",ft,"-")):r.value.royalty_status_text==="待分账"?(s(),d(i,{key:1,type:"info"},{default:t(()=>[...e[33]||(e[33]=[n("待分账",-1)])]),_:1})):r.value.royalty_status_text==="分账中"?(s(),d(i,{key:2,type:"warning"},{default:t(()=>[...e[34]||(e[34]=[n("分账中",-1)])]),_:1})):r.value.royalty_status_text==="分账成功"?(s(),d(i,{key:3,type:"success"},{default:t(()=>[...e[35]||(e[35]=[n("分账成功",-1)])]),_:1})):r.value.royalty_status_text==="分账失败"?(s(),d(i,{key:4,type:"danger"},{default:t(()=>[...e[36]||(e[36]=[n("分账失败",-1)])]),_:1})):(s(),c("span",vt,u(r.value.royalty_status_text),1))]),_:1}),r.value.royalty_record?(s(),d(y,{key:3,label:"收款人姓名"},{default:t(()=>{var p;return[n(u(((p=r.value.royalty_record)==null?void 0:p.payee_name)||"-"),1)]}),_:1})):b("",!0),r.value.royalty_record?(s(),d(y,{key:4,label:"收款人账号"},{default:t(()=>{var p,A;return[n(u(((p=r.value.royalty_record)==null?void 0:p.payee_account)||((A=r.value.royalty_record)==null?void 0:A.payee_user_id)||"-"),1)]}),_:1})):b("",!0),(l=r.value.royalty_record)!=null&&l.alipay_royalty_no?(s(),d(y,{key:5,label:"分账单号"},{default:t(()=>[n(u(r.value.royalty_record.alipay_royalty_no),1)]),_:1})):b("",!0),(R=r.value.royalty_record)!=null&&R.royalty_time?(s(),d(y,{key:6,label:"分账时间"},{default:t(()=>[n(u(r.value.royalty_record.royalty_time),1)]),_:1})):b("",!0),a(y,{label:"创建时间"},{default:t(()=>[n(u(r.value.created_at),1)]),_:1}),a(y,{label:"支付时间"},{default:t(()=>[n(u(r.value.pay_time||"-"),1)]),_:1}),a(y,{label:"备注",span:2},{default:t(()=>[r.value.royalty_status===3&&r.value.royalty_error?(s(),c("span",gt,u(r.value.order_remark||"-"),1)):(s(),c("span",bt,u(r.value.order_remark||"-"),1))]),_:1})]}),_:1})):b("",!0)]),_:1},8,["modelValue"])],64)}}}),zt=Ae(kt,[["__scopeId","data-v-e0251eb4"]]);export{zt as default};
//# sourceMappingURL=order-L9_CdvzU.js.map
