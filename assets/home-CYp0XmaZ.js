const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/edit-B8O3_kxH.js","assets/index-CFTblcIy.js","assets/index-B-isprgm.css","assets/edit-LVtr4UGo.css","assets/alert-CF5VuMnX.css","assets/select-Cg3B10gN.css"])))=>i.map(i=>d[i]);
import{d as we,g as f,a8 as Ce,K as be,c as z,a as t,e as c,u as i,w as n,T as ke,L as O,s as g,q as Se,D as Ee,M as xe,N as Te,O as Ve,o as _,an as Pe,j as $,a0 as ze,z as $e,aE as Ie,n as r,P as Ae,E as De,i as y,b as Ue,y as Be,ao as Re,ar as Fe,ap as Le,x as Me,Q as Oe,R as Ne,S as Ge,U as He,V as Ke,W as We,a7 as je,t as qe,aq as Je,aF as I,C as d,_ as Qe}from"./index-CFTblcIy.js";/* empty css                   *//* empty css               *//* empty css                     *//* empty css                 */import{u as Xe}from"./table.plugin-D8tqfcxX.js";const Ye={key:0,class:"api-docs-content"},Ze={class:"card-header"},ea={class:"api-info-textarea"},aa={class:"dialog-footer"},ta={class:"table-com-search"},na={class:"table-header ba-scroll-style"},la={class:"table-search"},oa={style:{width:"100%","overflow-x":"auto"},class:"table-content"},sa={class:"table-footer"},ia={class:"table-pagination"},ra=we({__name:"home",setup(ca){const N=Pe(()=>Je(()=>import("./edit-B8O3_kxH.js"),__vite__mapDeps([0,1,2,3,4,5]))),x=f(null),A=(a={})=>{console.log(a),x.value?x.value.open({...a}):console.error("EditForm 组件未正确挂载！")},{handleSelectionChange:G,hasSelectedRows:H,isVisible:K,toggleVisibility:W,loadData:j,data:o,refreshData:T,handleSizeChange:q,handleCurrentChange:J,searchParams:D,deleteRows:U,toggleSwitch:Q}=Xe("/api/v1/admin/merchant/list"),v=async a=>{try{const e=await g({url:`/api/v1/admin/merchant/circuit-status/${a.id}`,method:"GET"});e.status&&(a.circuit_status=e.data)}catch(e){console.error("获取熔断状态失败:",e),a.circuit_status={is_circuit_open:!1,remain_seconds:0}}},X=async a=>{await q(a),o.value.data&&o.value.data.length>0&&await Promise.all(o.value.data.map(e=>v(e)))},Y=async a=>{await J(a),o.value.data&&o.value.data.length>0&&await Promise.all(o.value.data.map(e=>v(e)))},u=f({agent_id:"",merchant_name:"",contact_name:"",contact_phone:"",status:""}),B=f([]),R=f({}),V=Ce(()=>{var a;return((a=R.value)==null?void 0:a.is_agent)===!0}),Z=async()=>{try{const a=await g({url:"/api/v1/admin/user/info",method:"GET"});a.status&&(R.value=a.data)}catch(a){console.error("获取用户信息失败:",a)}},ee=async()=>{if(!V.value)try{const a=await g({url:"/api/v1/admin/merchant/agent-list",method:"GET"});a.status&&(B.value=a.data)}catch(a){console.error("获取代理商列表失败:",a)}},ae=async()=>{D.value={...u.value},await w()},te=()=>{u.value={agent_id:"",merchant_name:"",contact_name:"",contact_phone:"",status:""},D.value={...u.value},w()},ne=async a=>{try{await I.confirm("确定要重置该商户的API密钥吗？重置后原密钥将失效！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await g({url:"/api/v1/admin/merchant/reset-api-key",method:"POST",data:{id:a.id}});e.status?(await I.alert(`<div style="word-break: break-all;">
          <p><strong>API Key:</strong><br/>${e.data.api_key}</p>
          <p style="margin-top: 10px;"><strong>API Secret:</strong><br/>${e.data.api_secret}</p>
        </div>`,"新的API密钥",{dangerouslyUseHTMLString:!0,confirmButtonText:"我已复制"}),await w()):d.error(e.msg||"重置失败")}catch(e){e!=="cancel"&&(console.error("重置失败:",e),d.error("重置失败"))}},le=a=>{if(a<=0)return"0秒";const e=Math.floor(a/60),s=a%60;return e>0?`${e}分${s}秒`:`${s}秒`},oe=async a=>{try{await I.confirm("确定要解除该商户的熔断状态吗？","解除熔断",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await g({url:"/api/v1/admin/merchant/clear-circuit",method:"POST",data:{merchant_id:a.id}});e.status?(d.success(e.msg||"熔断已成功解除"),await v(a),await T()):d.error(e.msg||"解除熔断失败")}catch(e){e!=="cancel"&&(console.error("解除熔断失败:",e),d.error("解除熔断失败"))}},se=async()=>{await j(),o.value.data&&o.value.data.length>0&&await Promise.all(o.value.data.map(a=>v(a)))},w=async()=>{await T(),o.value.data&&o.value.data.length>0&&await Promise.all(o.value.data.map(a=>v(a)))};be(async()=>{await Z(),await ee(),await se()});const ie=(a,e)=>{U(a,[e.id])},re=a=>{U(a)},C=f(!1),b=f(null),h=f(""),ce=async a=>{try{const e=await g({url:`/api/v1/admin/merchant/detail/${a.id}`,method:"GET"});if(e.status)a={...a,...e.data};else{d.error("获取商户详情失败");return}}catch(e){console.error("获取商户详情失败:",e),d.error("获取商户详情失败");return}b.value=a,de(),C.value=!0},de=()=>{if(!b.value)return;const a=b.value,e=`=== 百亿支付对接信息 ===

商户名称：${a.merchant_name||"未设置"}
商户Key：${a.api_key||"未生成"}
商户秘钥：${a.api_secret||"未生成"}
回调IP：34.92.49.193,34.150.65.167

API接口信息：
API网关：https://api.baiyi-pay.com
API文档：https://www.baiyi-pay.com/docs.html

接口说明：
1. 所有接口请求都需要进行签名验证
2. 签名算法：MD5(参数按key排序后拼接 + 商户秘钥)
3. 请求方式：POST
4. 数据格式：JSON
5. 字符编码：UTF-8

回调说明：
- 支付成功后系统会主动回调商户的notify_url
- 回调参数包含订单状态和签名信息
- 商户收到回调后需要返回"success"字符串确认（不区分大小写）
- HTTP状态码必须返回200，响应内容必须为"SUCCESS"

熔断机制：
- 连续超时5次：如果商户回调接口连续5次超时（超过10秒未响应），系统将触发熔断，暂停自动回调5分钟
- 连续非期望响应5次：如果商户回调接口连续5次返回非200状态码或响应内容不是"SUCCESS"，系统将触发熔断，暂停自动回调5分钟
- 熔断恢复：回调成功后自动恢复，或等待5分钟后自动恢复
- 建议：请确保回调接口稳定可用，响应时间控制在10秒以内，避免触发熔断机制

注意事项：
1. 请妥善保管商户Key和商户秘钥
2. 必须使用HTTPS协议进行接口调用
3. 回调地址必须是公网可访问的URL
4. 如有疑问请联系技术支持

生成时间：${new Date().toLocaleString()}`;h.value=e},ue=async()=>{try{await navigator.clipboard.writeText(h.value),d.success("完整对接信息已复制到剪贴板")}catch{const e=document.createElement("textarea");e.value=h.value,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.select();try{document.execCommand("copy"),d.success("完整对接信息已复制到剪贴板")}catch{d.error("复制失败，请手动复制")}document.body.removeChild(e)}};return(a,e)=>{const s=Se,F=$e,me=ze,pe=Ee,k=Le,L=Re,S=Be,P=Ue,_e=De,fe=Me,ge=xe,m=Ke,ve=We,M=je,he=Te,ye=Ve;return _(),z(O,null,[t(i(N),{ref_key:"editFormRef",ref:x,onRefresh:i(T)},null,8,["onRefresh"]),t(pe,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=l=>C.value=l),title:"对接资料",width:"600px","close-on-click-modal":!1},{footer:n(()=>[c("div",aa,[t(s,{onClick:e[1]||(e[1]=l=>C.value=!1)},{default:n(()=>[...e[11]||(e[11]=[r("关闭",-1)])]),_:1})])]),default:n(()=>[b.value?(_(),z("div",Ye,[t(me,{class:"api-info-card",shadow:"never"},{header:n(()=>[c("div",Ze,[e[10]||(e[10]=c("span",null,"对接信息",-1)),t(s,{type:"primary",size:"small",onClick:ue,icon:i(Ie)},{default:n(()=>[...e[9]||(e[9]=[r(" 一键复制全部 ",-1)])]),_:1},8,["icon"])])]),default:n(()=>[c("div",ea,[t(F,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=l=>h.value=l),type:"textarea",rows:12,readonly:"",placeholder:"对接信息加载中...",class:"api-info-text"},null,8,["modelValue"])])]),_:1})])):$("",!0)]),_:1},8,["modelValue"]),t(ke,{name:"fade"},{default:n(()=>[Ae(c("div",ta,[t(_e,{gutter:20},{default:n(()=>[V.value?$("",!0):(_(),y(P,{key:0,span:6},{default:n(()=>[t(S,{label:"代理商"},{default:n(()=>[t(L,{modelValue:u.value.agent_id,"onUpdate:modelValue":e[3]||(e[3]=l=>u.value.agent_id=l),placeholder:"选择代理商",clearable:"",filterable:""},{default:n(()=>[(_(!0),z(O,null,Fe(B.value,l=>(_(),y(k,{key:l.id,label:l.agent_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})),t(P,{span:6},{default:n(()=>[t(S,{label:"商户名称"},{default:n(()=>[t(F,{modelValue:u.value.merchant_name,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.merchant_name=l),placeholder:"按商户名称搜索",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(P,{span:6},{default:n(()=>[t(S,{label:"状态"},{default:n(()=>[t(L,{modelValue:u.value.status,"onUpdate:modelValue":e[5]||(e[5]=l=>u.value.status=l),placeholder:"选择状态",clearable:""},{default:n(()=>[t(k,{label:"全部",value:""}),t(k,{label:"启用",value:1}),t(k,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(fe,{inline:!0,class:"demo-form-inline"},{default:n(()=>[t(S,null,{default:n(()=>[t(s,{type:"primary",onClick:ae},{default:n(()=>[...e[12]||(e[12]=[r("搜索",-1)])]),_:1}),t(s,{type:"primary",onClick:te},{default:n(()=>[...e[13]||(e[13]=[r("重置",-1)])]),_:1})]),_:1})]),_:1})],512),[[Oe,i(K)]])]),_:1}),c("div",na,[t(s,{icon:i(Ne),onClick:w,color:"#40485b"},null,8,["icon"]),t(s,{type:"primary",icon:i(Ge),onClick:A},{default:n(()=>[...e[14]||(e[14]=[r("添加",-1)])]),_:1},8,["icon"]),t(s,{type:"danger",disabled:!i(H),onClick:e[6]||(e[6]=l=>re("/api/v1/admin/merchant/delete"))},{default:n(()=>[...e[15]||(e[15]=[r("删除",-1)])]),_:1},8,["disabled"]),c("div",la,[t(ge,{class:"ml-4"},{default:n(()=>[t(s,{icon:i(He),onClick:i(W)},null,8,["icon","onClick"])]),_:1})])]),c("div",oa,[t(he,{data:i(o).data,border:"",stripe:"","max-height":"600",style:{width:"100%"},onSelectionChange:i(G)},{default:n(()=>[t(m,{type:"selection",width:"40"}),V.value?$("",!0):(_(),y(m,{key:0,prop:"agent.agent_name",label:"代理商",align:"center","min-width":"150"})),t(m,{prop:"merchant_name",label:"商户名称",align:"center","min-width":"200"}),t(m,{prop:"username",label:"账号",align:"center","min-width":"150"}),t(m,{label:"状态",align:"center","min-width":"90"},{default:n(({row:l})=>[t(ve,{modelValue:l.status,"onUpdate:modelValue":p=>l.status=p,"active-value":1,"inactive-value":0,onChange:p=>i(Q)("/api/v1/admin/merchant/switch",l.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(m,{label:"熔断状态",align:"center","min-width":"120"},{default:n(({row:l})=>{var p;return[(p=l.circuit_status)!=null&&p.is_circuit_open?(_(),y(M,{key:0,type:"danger",size:"small"},{default:n(()=>[r(" 熔断中 ("+qe(le(l.circuit_status.remain_seconds))+") ",1)]),_:2},1024)):(_(),y(M,{key:1,type:"success",size:"small"},{default:n(()=>[...e[16]||(e[16]=[r("正常",-1)])]),_:1}))]}),_:1}),t(m,{prop:"created_at",label:"创建时间",align:"center","min-width":"150"}),t(m,{label:"操作",align:"center",fixed:"right","min-width":"400"},{default:n(l=>{var p;return[t(s,{size:"small",onClick:E=>A(l.row)},{default:n(()=>[...e[17]||(e[17]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(s,{size:"small",type:"info",onClick:E=>ce(l.row)},{default:n(()=>[...e[18]||(e[18]=[r("对接资料",-1)])]),_:1},8,["onClick"]),t(s,{size:"small",type:"warning",onClick:E=>ne(l.row)},{default:n(()=>[...e[19]||(e[19]=[r("重置密钥",-1)])]),_:1},8,["onClick"]),t(s,{size:"small",type:"danger",disabled:!((p=l.row.circuit_status)!=null&&p.is_circuit_open),onClick:E=>oe(l.row)},{default:n(()=>[...e[20]||(e[20]=[r(" 解除熔断 ",-1)])]),_:1},8,["disabled","onClick"]),t(s,{size:"small",type:"danger",onClick:E=>ie("/api/v1/admin/merchant/delete",l.row)},{default:n(()=>[...e[21]||(e[21]=[r("删除",-1)])]),_:1},8,["onClick"])]}),_:1})]),_:1},8,["data","onSelectionChange"])]),c("div",sa,[c("div",ia,[t(ye,{"current-page":i(o).current_page,"onUpdate:currentPage":e[7]||(e[7]=l=>i(o).current_page=l),"page-size":i(o).page_size,"onUpdate:pageSize":e[8]||(e[8]=l=>i(o).page_size=l),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:i(o).page_total,onSizeChange:X,onCurrentChange:Y},null,8,["current-page","page-size","total"])])])],64)}}}),ga=Qe(ra,[["__scopeId","data-v-2c3c9128"]]);export{ga as default};
//# sourceMappingURL=home-CYp0XmaZ.js.map
