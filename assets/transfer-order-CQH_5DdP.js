import{d as ve,r as d,c as ge,o as be,a as C,e as a,b as s,w as l,a0 as ye,J as r,p as u,t as c,F as Y,s as E,l as we,a1 as he,U as Ve,A as ke,a2 as Ce,n as f,z as Ee,x as xe,Q as Se,i as je,v as De,R as Ue,j as ze,q as G,g as B,H as Te,S as Fe,k as Re,I as Ye,a5 as H,K as O,a3 as Be,aQ as Ie,aw as Ne,f as Le,ax as Me,V as Pe,B as qe,E as U,_ as Ae}from"./index-BkdMl2fu.js";/* empty css                   *//* empty css               *//* empty css                     *//* empty css                 *//* empty css              *//* empty css                          *//* empty css                          */import{u as Ge}from"./table.plugin-Brlesw2b.js";const He={class:"table-com-search"},Oe={class:"search-buttons"},Qe={class:"table-header ba-scroll-style"},$e={class:"table-statistics-bar"},Je={class:"stat stat-amt"},Ke={class:"stat-num"},We={class:"stat"},Xe={class:"stat-num"},Ze={class:"stat stat-succ"},ea={class:"stat-num"},aa={class:"table-search"},ta={class:"confirm-content"},la={style:{color:"#f56c6c","font-size":"18px","font-weight":"bold"}},oa={class:"confirm-tip"},na={class:"dialog-footer"},sa={class:"dialog-footer"},ra={style:{width:"100%","overflow-x":"auto"},class:"table-content"},ua={key:0},ia={key:1},da={class:"table-footer"},ma={class:"table-pagination"},ca=ve({__name:"transfer-order",setup(pa){const{loadData:Q,data:g,refreshData:x,handleSizeChange:$,handleCurrentChange:J,searchParams:S,isVisible:K,toggleVisibility:W}=Ge("/api/v1/admin/single-royalty/transfer-order-list"),z=d([]),i=d({subject_id:"",payee_name:"",payee_account:"",start_time:"",end_time:""}),X=t=>{t&&t.length===2?(i.value.start_time=t[0],i.value.end_time=t[1]):(i.value.start_time="",i.value.end_time="")},I=d([]),j=d([]),T=d({}),Z=ge(()=>{var t;return((t=T.value)==null?void 0:t.is_agent)===!0}),b=d({total_count:0,total_amount:0,transferred_amount:0,pending_amount:0}),w=d(!1),h=d(!1),F=d(!1),R=d(null),n=d({subject_id:"",payee_name:"",payee_account:"",amount:"",remark:""}),ee={subject_id:[{required:!0,message:"请选择转出主体",trigger:"change"}],payee_name:[{required:!0,message:"请输入收款人姓名",trigger:"blur"}],payee_account:[{required:!0,message:"请输入收款人账号",trigger:"blur"}],amount:[{required:!0,message:"请输入转账金额",trigger:"blur"},{validator:(t,e,v)=>{e&&(isNaN(e)||parseFloat(e)<=0)?v(new Error("转账金额必须大于0")):v()},trigger:"blur"}]},N=async()=>{try{const t=await E({url:"/api/v1/admin/user/info",method:"GET"});t.status&&(T.value=t.data)}catch(t){console.error("获取用户信息失败:",t)}},ae=async()=>{try{const t=await E({url:"/api/v1/admin/subject/list",method:"GET",params:{page_size:1e3}});t.status&&t.data.data&&(I.value=t.data.data)}catch(t){console.error("获取主体列表失败:",t)}},te=async()=>{try{const t=await E({url:"/api/v1/admin/subject/list",method:"GET",params:{page_size:1e3,status:1}});t.status&&t.data.data&&(Z.value?j.value=t.data.data.filter(e=>e.agent_id===T.value.agent_id):j.value=t.data.data)}catch(t){console.error("获取代理商主体列表失败:",t)}},D=async()=>{try{const t=await E({url:"/api/v1/admin/single-royalty/transfer-order-statistics",method:"GET",params:S.value});t.status&&(b.value=t.data)}catch(t){console.error("获取统计失败:",t)}},le=async()=>{await N(),await te(),n.value={subject_id:"",payee_name:"",payee_account:"",amount:"",remark:""},w.value=!0,setTimeout(()=>{var t;(t=R.value)==null||t.clearValidate()},100)},oe=t=>{if(!t)return"-";const e=j.value.find(v=>v.id===t);return(e==null?void 0:e.company_name)||"-"},ne=async()=>{try{await R.value.validate(),w.value=!1,h.value=!0}catch(t){console.error("表单验证失败:",t),t!==!1&&U.error("请填写完整的转账信息")}},se=async()=>{try{F.value=!0;const t=await E({url:"/api/v1/admin/single-royalty/transfer",method:"POST",data:{subject_id:n.value.subject_id,payee_name:n.value.payee_name,payee_account:n.value.payee_account,amount:parseFloat(n.value.amount),remark:n.value.remark||""}});t.status?(U.success(t.msg||"转账成功"),h.value=!1,n.value={subject_id:"",payee_name:"",payee_account:"",amount:"",remark:""},x(),await D()):U.error(t.msg||"转账失败")}catch(t){console.error("转账失败:",t),t!==!1&&U.error("转账失败")}finally{F.value=!1}},re=async()=>{S.value={...i.value},await x(),await D()},ue=()=>{z.value=[],i.value={subject_id:"",payee_name:"",payee_account:"",start_time:"",end_time:""},S.value={...i.value},x(),D()};return be(async()=>{await N(),await ae(),S.value={...i.value},Q(),await D()}),(t,e)=>{const v=Te,L=ze,m=Ue,V=De,y=Fe,ie=Re,M=je,P=Ye,p=we,q=Se,de=xe,me=he,k=Me,ce=Ne,pe=Pe,A=Ve,_=qe,_e=ke,fe=Ce;return f(),C(Y,null,[a(ye,{name:"fade"},{default:l(()=>[Ee(s("div",He,[a(de,{class:"search-card",shadow:"never"},{default:l(()=>[a(q,{model:i.value,"label-width":"100px",class:"search-form"},{default:l(()=>[a(M,{gutter:20},{default:l(()=>[a(V,{span:6},{default:l(()=>[a(m,{label:"转出主体"},{default:l(()=>[a(L,{modelValue:i.value.subject_id,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value.subject_id=o),placeholder:"请选择主体",clearable:"",filterable:"",style:{width:"100%"}},{default:l(()=>[(f(!0),C(Y,null,G(I.value,o=>(f(),B(v,{key:o.id,label:o.company_name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(V,{span:6},{default:l(()=>[a(m,{label:"收款人姓名"},{default:l(()=>[a(y,{modelValue:i.value.payee_name,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.payee_name=o),placeholder:"请输入收款人姓名",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),a(V,{span:6},{default:l(()=>[a(m,{label:"收款人账号"},{default:l(()=>[a(y,{modelValue:i.value.payee_account,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value.payee_account=o),placeholder:"请输入收款人账号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),a(V,{span:6},{default:l(()=>[a(m,{label:"转账时间"},{default:l(()=>[a(ie,{modelValue:z.value,"onUpdate:modelValue":e[3]||(e[3]=o=>z.value=o),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"},onChange:X,clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(M,{gutter:20},{default:l(()=>[a(V,{span:6},{default:l(()=>[a(m,null,{default:l(()=>[s("div",Oe,[a(p,{type:"primary",onClick:re},{default:l(()=>[a(P,null,{default:l(()=>[a(r(H))]),_:1}),e[15]||(e[15]=u("搜索 ",-1))]),_:1}),a(p,{onClick:ue},{default:l(()=>[a(P,null,{default:l(()=>[a(r(O))]),_:1}),e[16]||(e[16]=u("重置 ",-1))]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[Be,r(K)]])]),_:1}),s("div",Qe,[a(p,{icon:r(O),onClick:r(x),color:"#40485b"},null,8,["icon","onClick"]),a(p,{type:"primary",icon:r(Ie),onClick:le},{default:l(()=>[...e[17]||(e[17]=[u("转账",-1)])]),_:1},8,["icon"]),s("div",$e,[s("span",Je,[e[18]||(e[18]=u("总金额: ",-1)),s("b",Ke,"¥"+c(b.value.total_amount?b.value.total_amount:0),1)]),e[21]||(e[21]=s("span",{class:"split"},"|",-1)),s("span",We,[e[19]||(e[19]=u("总订单: ",-1)),s("b",Xe,c(b.value.total_count||0),1)]),e[22]||(e[22]=s("span",{class:"split"},"|",-1)),s("span",Ze,[e[20]||(e[20]=u("已转账: ",-1)),s("b",ea,"¥"+c(b.value.transferred_amount?b.value.transferred_amount:0),1)])]),s("div",aa,[a(me,{class:"ml-4"},{default:l(()=>[a(p,{icon:r(H),onClick:r(W)},null,8,["icon","onClick"])]),_:1})])]),a(A,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=o=>h.value=o),title:"确认转账信息",width:"500px","close-on-click-modal":!1},{footer:l(()=>[s("span",na,[a(p,{onClick:e[4]||(e[4]=o=>h.value=!1)},{default:l(()=>[...e[23]||(e[23]=[u("取消",-1)])]),_:1}),a(p,{type:"primary",onClick:se,loading:F.value},{default:l(()=>[...e[24]||(e[24]=[u(" 确认转账 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[s("div",ta,[a(ce,{column:1,border:""},{default:l(()=>[a(k,{label:"转出主体"},{default:l(()=>[u(c(oe(n.value.subject_id)),1)]),_:1}),a(k,{label:"收款人姓名"},{default:l(()=>[u(c(n.value.payee_name),1)]),_:1}),a(k,{label:"收款人账号"},{default:l(()=>[u(c(n.value.payee_account),1)]),_:1}),a(k,{label:"转账金额"},{default:l(()=>[s("span",la," ¥"+c(n.value.amount||"0.00"),1)]),_:1}),n.value.remark?(f(),B(k,{key:0,label:"备注"},{default:l(()=>[u(c(n.value.remark),1)]),_:1})):Le("",!0)]),_:1}),s("div",oa,[a(pe,{title:"请确认转账信息无误后再提交",type:"warning",closable:!1,"show-icon":""})])])]),_:1},8,["modelValue"]),a(A,{modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=o=>w.value=o),title:"转账",width:"600px","close-on-click-modal":!1},{footer:l(()=>[s("span",sa,[a(p,{onClick:e[11]||(e[11]=o=>w.value=!1)},{default:l(()=>[...e[26]||(e[26]=[u("取消",-1)])]),_:1}),a(p,{type:"primary",onClick:ne},{default:l(()=>[...e[27]||(e[27]=[u(" 下一步 ",-1)])]),_:1})])]),default:l(()=>[a(q,{ref_key:"transferFormRef",ref:R,model:n.value,rules:ee,"label-width":"120px"},{default:l(()=>[a(m,{label:"转出主体",prop:"subject_id"},{default:l(()=>[a(L,{modelValue:n.value.subject_id,"onUpdate:modelValue":e[6]||(e[6]=o=>n.value.subject_id=o),placeholder:"请选择转出主体",clearable:"",filterable:"",style:{width:"100%"}},{default:l(()=>[(f(!0),C(Y,null,G(j.value,o=>(f(),B(v,{key:o.id,label:o.company_name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"收款人姓名",prop:"payee_name"},{default:l(()=>[a(y,{modelValue:n.value.payee_name,"onUpdate:modelValue":e[7]||(e[7]=o=>n.value.payee_name=o),placeholder:"请输入收款人姓名",clearable:""},null,8,["modelValue"])]),_:1}),a(m,{label:"收款人账号",prop:"payee_account"},{default:l(()=>[a(y,{modelValue:n.value.payee_account,"onUpdate:modelValue":e[8]||(e[8]=o=>n.value.payee_account=o),placeholder:"请输入收款人账号",clearable:""},null,8,["modelValue"])]),_:1}),a(m,{label:"转账金额",prop:"amount"},{default:l(()=>[a(y,{modelValue:n.value.amount,"onUpdate:modelValue":e[9]||(e[9]=o=>n.value.amount=o),placeholder:"请输入转账金额",clearable:"",type:"number",min:0,precision:2},{prefix:l(()=>[...e[25]||(e[25]=[u("¥",-1)])]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"备注",prop:"remark"},{default:l(()=>[a(y,{modelValue:n.value.remark,"onUpdate:modelValue":e[10]||(e[10]=o=>n.value.remark=o),type:"textarea",rows:3,placeholder:"请输入备注信息（选填）",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),s("div",ra,[a(_e,{data:r(g).data,border:"",stripe:"","max-height":"600",style:{width:"100%"}},{default:l(()=>[a(_,{prop:"transfer_no",label:"转账单号",align:"center","min-width":"200"}),a(_,{prop:"subject_name",label:"转出主体",align:"center","min-width":"200"}),a(_,{prop:"payee_name",label:"收款人姓名",align:"center","min-width":"150"}),a(_,{prop:"payee_account",label:"收款人账号",align:"center","min-width":"180"}),a(_,{prop:"amount",label:"金额",align:"center","min-width":"120"},{default:l(({row:o})=>[u(" ¥"+c(o.amount||"0.00"),1)]),_:1}),a(_,{prop:"transfer_time",label:"转账时间",align:"center","min-width":"180"}),a(_,{prop:"remark",label:"备注信息",align:"center","min-width":"200","show-overflow-tooltip":""}),a(_,{label:"创建时间",align:"center","min-width":"180"},{default:l(({row:o})=>[o.transfer_time?(f(),C("span",ia,"-")):(f(),C("span",ua,c(o.created_at||"-"),1))]),_:1})]),_:1},8,["data"])]),s("div",da,[s("div",ma,[a(fe,{"current-page":r(g).current_page,"onUpdate:currentPage":e[13]||(e[13]=o=>r(g).current_page=o),"page-size":r(g).page_size,"onUpdate:pageSize":e[14]||(e[14]=o=>r(g).page_size=o),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:r(g).page_total,onSizeChange:r($),onCurrentChange:r(J)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])],64)}}}),ka=Ae(ca,[["__scopeId","data-v-1bba4f83"]]);export{ka as default};
//# sourceMappingURL=transfer-order-CQH_5DdP.js.map
