import{s as Y,d as Z,L as ee,r as y,c as le,a as v,b as s,e,g as E,f as g,p as r,w as l,I as te,x as ae,D as oe,U as ne,n as c,J as m,ay as re,Q as se,W as de,i as ue,v as ie,R as _e,S as ce,X as x,l as pe,a5 as me,K as fe,aw as ve,ax as ge,t as n,h as ye,az as he,aA as be,F as Ee,q as we,aB as Ie,aC as Ce,aD as Oe,aE as Pe,aF as Se,E as k,_ as ke}from"./index-BZRJkKFz.js";/* empty css              *//* empty css                          */function Re(N){return Y({url:"/api/v1/admin/order-log/search",method:"get",params:N})}const Ve={class:"order-log-container"},xe={class:"page-header"},Ne={class:"card-header"},De={class:"amount"},Fe={class:"card-header"},Le={class:"timeline-container"},Te={class:"log-header"},Ae={class:"log-meta"},Be={class:"log-actions"},Ue={class:"log-content"},We={class:"log-message"},ze={key:0,class:"log-extra"},Je={key:0,class:"extra-item"},Ke={key:1,class:"extra-item"},qe={key:0,class:"log-detail"},Ge={class:"log-content-detail"},Me={key:0,class:"json-pre"},Qe=Z({__name:"order-log",setup(N){const d=ee({merchant_order_no:"",platform_order_no:"",trace_id:""}),W={merchant_order_no:[{validator:(t,a,p)=>{!a&&!d.platform_order_no&&!d.trace_id?p(new Error("请至少输入一个搜索条件")):p()},trigger:"blur"}]},w=y(!1),f=y([]),i=y(null),R=y(!1),I=y(!1),_=y(null),D=le(()=>{var a;const t=(a=_.value)==null?void 0:a.content;if(!t)return"";if(typeof t=="string")try{return JSON.stringify(JSON.parse(t),null,2)}catch{return t}try{return JSON.stringify(t,null,2)}catch{return String(t)}}),h=async()=>{if(!d.merchant_order_no&&!d.platform_order_no&&!d.trace_id){k.warning("请至少输入一个搜索条件");return}w.value=!0,R.value=!0;try{const t=await Re(d);console.log("API响应:",t),t.code===0||t.code===200?(f.value=t.data.logs||[],i.value=t.data.order_info||null,console.log("日志数据:",f.value),console.log("订单信息:",i.value),k.success("搜索成功")):(console.error("API错误:",t),k.error(t.msg||t.message||"搜索失败"))}catch(t){console.error("请求错误:",t),k.error("搜索失败："+(t.message||"未知错误"))}finally{w.value=!1}},F=()=>{d.merchant_order_no="",d.platform_order_no="",d.trace_id="",f.value=[],i.value=null,R.value=!1},z=t=>{_.value=t,I.value=!0},J=()=>{I.value=!1,_.value=null},L=t=>({ERROR:"danger",WARN:"warning",INFO:"success",DEBUG:"info"})[t]||"info",K=t=>({ERROR:"danger",WARN:"warning",INFO:"primary",DEBUG:"info"})[t]||"primary",q=t=>({ERROR:"CircleClose",WARN:"Warning",INFO:"InfoFilled",DEBUG:"QuestionFilled"})[t]||"InfoFilled",T=t=>({"PaymentPageController::oauthCallback":"OAuth回调","PaymentPageController::paymentPage":"支付页面","PaymentPageController::createOrder":"创建订单","PaymentPageController::callPaymentApi":"调用支付接口","PaymentPageController::handlePaymentResult":"处理支付结果","PaymentPageController::closeOrder":"关闭订单","OrderLogService::log":"日志记录","AlipayService::createOrder":"支付宝创建订单","AlipayService::queryOrder":"支付宝查询订单","AlipayService::closeOrder":"支付宝关闭订单","WechatService::createOrder":"微信创建订单","WechatService::queryOrder":"微信查询订单","WechatService::closeOrder":"微信关闭订单"})[t]||t,G=t=>{try{const a=JSON.parse(t);return a.message||a.msg||t}catch{return t}},M=t=>({0:"warning",1:"success",2:"info",3:"danger"})[t]||"info",Q=t=>({0:"待支付",1:"已支付",2:"已关闭",3:"已退款"})[t]||"未知";return(t,a)=>{const p=te,V=ce,C=_e,O=ie,A=ue,P=pe,j=se,S=ae,u=ge,b=ye,B=ve,X=Ie,$=be,U=oe,H=ne;return c(),v("div",Ve,[s("div",xe,[s("h2",null,[e(p,null,{default:l(()=>[e(m(re))]),_:1}),a[4]||(a[4]=r(" 订单日志查询 ",-1))]),a[5]||(a[5]=s("p",{class:"page-description"},"支持按商户订单号、平台订单号、TraceId查询订单日志",-1))]),e(S,{class:"search-card",shadow:"never"},{default:l(()=>[e(j,{ref:"searchFormRef",model:d,rules:W,"label-width":"120px",onSubmit:de(h,["prevent"])},{default:l(()=>[e(A,{gutter:20},{default:l(()=>[e(O,{span:8},{default:l(()=>[e(C,{label:"商户订单号",prop:"merchant_order_no"},{default:l(()=>[e(V,{modelValue:d.merchant_order_no,"onUpdate:modelValue":a[0]||(a[0]=o=>d.merchant_order_no=o),placeholder:"请输入商户订单号",clearable:"",onKeyup:x(h,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),e(O,{span:8},{default:l(()=>[e(C,{label:"平台订单号",prop:"platform_order_no"},{default:l(()=>[e(V,{modelValue:d.platform_order_no,"onUpdate:modelValue":a[1]||(a[1]=o=>d.platform_order_no=o),placeholder:"请输入平台订单号",clearable:"",onKeyup:x(h,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),e(O,{span:8},{default:l(()=>[e(C,{label:"TraceId",prop:"trace_id"},{default:l(()=>[e(V,{modelValue:d.trace_id,"onUpdate:modelValue":a[2]||(a[2]=o=>d.trace_id=o),placeholder:"请输入TraceId",clearable:"",onKeyup:x(h,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(A,null,{default:l(()=>[e(O,{span:24},{default:l(()=>[e(C,null,{default:l(()=>[e(P,{type:"primary",onClick:h,loading:w.value},{default:l(()=>[e(p,null,{default:l(()=>[e(m(me))]),_:1}),a[6]||(a[6]=r(" 搜索 ",-1))]),_:1},8,["loading"]),e(P,{onClick:F},{default:l(()=>[e(p,null,{default:l(()=>[e(m(fe))]),_:1}),a[7]||(a[7]=r(" 重置 ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),i.value?(c(),E(S,{key:0,class:"order-info-card",shadow:"never"},{header:l(()=>[s("div",Ne,[e(p,null,{default:l(()=>[e(m(he))]),_:1}),a[8]||(a[8]=s("span",null,"订单信息",-1))])]),default:l(()=>[e(B,{column:4,border:""},{default:l(()=>[e(u,{label:"商户订单号"},{default:l(()=>[r(n(i.value.merchant_order_no||"-"),1)]),_:1}),e(u,{label:"平台订单号"},{default:l(()=>[r(n(i.value.platform_order_no||"-"),1)]),_:1}),e(u,{label:"订单金额"},{default:l(()=>[s("span",De,"¥"+n(i.value.order_amount||"0.00"),1)]),_:1}),e(u,{label:"支付状态"},{default:l(()=>[e(b,{type:M(i.value.pay_status)},{default:l(()=>[r(n(Q(i.value.pay_status)),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"创建时间"},{default:l(()=>[r(n(i.value.created_at||"-"),1)]),_:1}),e(u,{label:"支付时间"},{default:l(()=>[r(n(i.value.pay_time||"-"),1)]),_:1}),e(u,{label:"商户名称"},{default:l(()=>[r(n(i.value.merchant_name||"-"),1)]),_:1}),e(u,{label:"产品名称"},{default:l(()=>[r(n(i.value.product_name||"-"),1)]),_:1})]),_:1})]),_:1})):g("",!0),f.value.length>0?(c(),E(S,{key:1,class:"logs-card",shadow:"never"},{header:l(()=>[s("div",Fe,[e(p,null,{default:l(()=>[e(m(Se))]),_:1}),s("span",null,"日志记录 ("+n(f.value.length)+" 条)",1)])]),default:l(()=>[s("div",Le,[e($,null,{default:l(()=>[(c(!0),v(Ee,null,we(f.value,(o,je)=>(c(),E(X,{key:o.id,timestamp:o.created_at,type:K(o.log_level),icon:q(o.log_level),placement:"top"},{default:l(()=>[e(S,{class:"log-item"},{default:l(()=>[s("div",Te,[s("div",Ae,[e(b,{type:L(o.log_level),size:"small"},{default:l(()=>[r(n(o.log_level),1)]),_:2},1032,["type"]),e(b,{type:"info",size:"small"},{default:l(()=>[r(n(o.log_type),1)]),_:2},1024),e(b,{type:"warning",size:"small"},{default:l(()=>[r(n(T(o.node)),1)]),_:2},1024)]),s("div",Be,[e(P,{type:"primary",size:"small",text:"",onClick:Xe=>z(o)},{default:l(()=>[e(p,null,{default:l(()=>[e(m(Ce))]),_:1}),a[9]||(a[9]=r(" 详情 ",-1))]),_:1},8,["onClick"])])]),s("div",Ue,[s("div",We,n(G(o.content)),1),o.ip||o.user_agent?(c(),v("div",ze,[o.ip?(c(),v("div",Je,[e(p,null,{default:l(()=>[e(m(Oe))]),_:1}),s("span",null,n(o.ip),1)])):g("",!0),o.user_agent?(c(),v("div",Ke,[e(p,null,{default:l(()=>[e(m(Pe))]),_:1}),s("span",null,n(o.user_agent),1)])):g("",!0)])):g("",!0)])]),_:2},1024)]),_:2},1032,["timestamp","type","icon"]))),128))]),_:1})])]),_:1})):g("",!0),!w.value&&f.value.length===0&&R.value?(c(),E(U,{key:2,description:"未找到相关日志记录","image-size":120},{default:l(()=>[e(P,{type:"primary",onClick:F},{default:l(()=>[...a[10]||(a[10]=[r("重新搜索",-1)])]),_:1})]),_:1})):g("",!0),e(H,{modelValue:I.value,"onUpdate:modelValue":a[3]||(a[3]=o=>I.value=o),title:"日志详情",width:"80%","before-close":J},{default:l(()=>[_.value?(c(),v("div",qe,[e(B,{column:2,border:""},{default:l(()=>[e(u,{label:"日志ID"},{default:l(()=>[r(n(_.value.id),1)]),_:1}),e(u,{label:"TraceId"},{default:l(()=>[r(n(_.value.trace_id),1)]),_:1}),e(u,{label:"日志级别"},{default:l(()=>[e(b,{type:L(_.value.log_level)},{default:l(()=>[r(n(_.value.log_level),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"日志类型"},{default:l(()=>[r(n(_.value.log_type),1)]),_:1}),e(u,{label:"节点"},{default:l(()=>[r(n(T(_.value.node)),1)]),_:1}),e(u,{label:"创建时间"},{default:l(()=>[r(n(_.value.created_at),1)]),_:1}),e(u,{label:"IP地址"},{default:l(()=>[r(n(_.value.ip||"-"),1)]),_:1}),e(u,{label:"用户代理"},{default:l(()=>[r(n(_.value.user_agent||"-"),1)]),_:1})]),_:1}),s("div",Ge,[a[11]||(a[11]=s("h4",null,"日志内容",-1)),D.value?(c(),v("pre",Me,[s("code",null,n(D.value),1)])):(c(),E(U,{key:1,description:"日志内容为空"}))])])):g("",!0)]),_:1},8,["modelValue"])])}}}),Ze=ke(Qe,[["__scopeId","data-v-20a32e32"]]);export{Ze as default};
//# sourceMappingURL=order-log-DeMb4x9W.js.map
