import{d as z,g as d,a8 as h,i,w as r,s as _,C as y,D as M,o as u,a as o,x as W,j as b,E as H,b as J,y as K,c as w,ao as Q,L as U,ar as C,ap as X,z as Y,e as Z,F as ee,W as ae,q as te,u as I,am as le,n as L,ah as oe,_ as re}from"./index-eDxl0EL6.js";/* empty css              *//* empty css               */const se={key:0,class:"form-tip"},ue=z({__name:"edit",emits:["refresh"],setup(ne,{expose:A,emit:B}){const q=B,V=d(),m=d(!1),t=d({id:0,agent_id:"",product_name:"",payment_type_id:"",product_code:"",status:1,remark:""}),f=d({}),c=h(()=>{var a;return((a=f.value)==null?void 0:a.is_agent)===!0}),E=d([]),x=d([]),F=h(()=>{const a={product_name:[{required:!0,message:"请输入产品名称",trigger:"blur"}],payment_type_id:[{required:!0,message:"请选择支付类型",trigger:"change"}]};return c.value||(a.agent_id=[{required:!0,message:"请选择代理商",trigger:"change"}]),a}),G=async()=>{try{const a=await _({url:"/api/v1/admin/user/info",method:"GET"});a.status&&(f.value=a.data)}catch(a){console.error("获取用户信息失败:",a)}},N=async()=>{if(!c.value)try{const a=await _({url:"/api/v1/admin/product/agent-list",method:"GET"});a.status&&(E.value=a.data)}catch(a){console.error("获取代理商列表失败:",a)}},R=async()=>{try{const a=await _({url:"/api/v1/admin/product/payment-type-list",method:"GET"});a.status&&(x.value=a.data)}catch(a){console.error("获取支付类型列表失败:",a)}},S=async a=>{if(await G(),await N(),await R(),a.id)try{const e=await _({url:`/api/v1/admin/product/detail/${a.id}`,method:"GET"});e.status&&(t.value={...e.data})}catch(e){console.error("获取详情失败:",e),y.error("获取详情失败");return}else{const e=c.value?f.value.agent_id:"";t.value={id:0,agent_id:e,product_name:"",payment_type_id:"",product_code:"",status:1,remark:""},console.log("isAgent:",c.value),console.log("userInfo:",f.value),console.log("agent_id set to:",e)}m.value=!0,setTimeout(()=>{var e;(e=V.value)==null||e.clearValidate()},100)},D=async()=>{var e,p;if(await V.value.validate().catch(()=>!1))try{const n=t.value.id>0?"/api/v1/admin/product/edit":"/api/v1/admin/product/add",s=await _({url:n,method:"POST",data:t.value});s.status?(y.success(s.msg||"操作成功"),m.value=!1,q("refresh")):y.error(s.msg||"操作失败")}catch(n){console.error("提交失败:",n),y.error(((p=(e=n.response)==null?void 0:e.data)==null?void 0:p.msg)||"提交失败")}};return A({open:S}),(a,e)=>{const p=X,n=Q,s=K,v=J,g=H,k=Y,O=ee,P=ae,T=te,$=W,j=M;return u(),i(j,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=l=>m.value=l),title:t.value.id===0?"新增产品":"编辑产品",width:"600px","close-on-click-modal":!1},{default:r(()=>[o($,{model:t.value,"label-width":"120px",rules:F.value,ref_key:"formRef",ref:V},{default:r(()=>[c.value?b("",!0):(u(),i(g,{key:0,gutter:20},{default:r(()=>[o(v,{span:24},{default:r(()=>[o(s,{label:"代理商",prop:"agent_id"},{default:r(()=>[o(n,{modelValue:t.value.agent_id,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.agent_id=l),placeholder:"请选择代理商",clearable:"",filterable:"",disabled:t.value.id>0},{default:r(()=>[(u(!0),w(U,null,C(E.value,l=>(u(),i(p,{key:l.id,label:l.agent_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),t.value.id>0?(u(),w("div",se,"代理商创建后不可修改")):b("",!0)]),_:1})]),_:1})]),_:1})),o(g,{gutter:20},{default:r(()=>[o(v,{span:24},{default:r(()=>[o(s,{label:"产品名称",prop:"product_name"},{default:r(()=>[o(k,{modelValue:t.value.product_name,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.product_name=l),placeholder:"请输入产品名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(g,{gutter:20},{default:r(()=>[o(v,{span:24},{default:r(()=>[o(s,{label:"支付类型",prop:"payment_type_id"},{default:r(()=>[o(n,{modelValue:t.value.payment_type_id,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.payment_type_id=l),placeholder:"请选择支付类型",clearable:"",filterable:""},{default:r(()=>[(u(!0),w(U,null,C(x.value,l=>(u(),i(p,{key:l.id,label:l.product_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t.value.id>0?(u(),i(g,{key:1,gutter:20},{default:r(()=>[o(v,{span:24},{default:r(()=>[o(s,{label:"产品编号"},{default:r(()=>[o(k,{modelValue:t.value.product_code,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.product_code=l),disabled:""},null,8,["modelValue"]),e[8]||(e[8]=Z("div",{class:"form-tip"},"产品编号自动生成，不可修改",-1))]),_:1})]),_:1})]),_:1})):b("",!0),t.value.id===0?(u(),i(O,{key:2,title:"产品编号将在创建时自动生成（4位数字）",type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}})):b("",!0),o(s,{label:"状态",prop:"status"},{default:r(()=>[o(P,{modelValue:t.value.status,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.status=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),o(s,{label:"备注",prop:"remark"},{default:r(()=>[o(k,{modelValue:t.value.remark,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.remark=l),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),o(s,null,{default:r(()=>[o(T,{type:"primary",onClick:D,icon:I(le)},{default:r(()=>[...e[9]||(e[9]=[L("提交",-1)])]),_:1},8,["icon"]),o(T,{onClick:e[6]||(e[6]=l=>m.value=!1),icon:I(oe)},{default:r(()=>[...e[10]||(e[10]=[L("取消",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),ce=re(ue,[["__scopeId","data-v-4fa930f1"]]);export{ce as default};
//# sourceMappingURL=edit-DrXQq7Qm.js.map
