import{s as N,d as M,r as t,L as j,g as ee,n as v,w as l,b as s,a as A,f as F,e as o,I as oe,J as b,M as W,N as ae,p as E,t as X,O as te,l as Q,P as T,Q as Z,R as H,S as J,T as ne,E as k,U as se,_ as O,V as le,W as re,X as K,Y as de,m as ie,Z as ue,$ as ce}from"./index-BlNhG5G6.js";/* empty css              */function pe($={}){return N({url:"/api/v1/admin/user/login",method:"post",data:$})}const Y=$=>N.get("/api/v1/admin/google-auth/qr-code",{params:{admin_id:$}}),_e=$=>N.post("/api/v1/admin/google-auth/bind",$),me={class:"google-auth-bind"},ge={key:0,class:"step-content"},fe={class:"step-header"},ve={class:"qr-code-container"},we={key:0,class:"qr-loading"},he={key:1,class:"qr-code"},ye=["src"],be={class:"qr-info"},ke={key:2,class:"qr-error"},Ve={class:"step-actions"},Ce={key:1,class:"step-content"},xe={class:"step-header"},Ae={class:"step-actions"},Se={key:2,class:"step-content"},$e={class:"success-content"},Ie=M({__name:"GoogleAuthBind",emits:["success","close"],setup($,{expose:P,emit:w}){const h=w,p=t(!1),u=t(1),y=t(!1),c=t(!1),S=t(0),g=t(null),V=j({google_code:""}),I={google_code:[{required:!0,message:"ËØ∑ËæìÂÖ•È™åËØÅÁ†Å",trigger:"blur"},{pattern:/^\d{6}$/,message:"ËØ∑ËæìÂÖ•6‰ΩçÊï∞Â≠óÈ™åËØÅÁ†Å",trigger:"blur"}]},m=t(),a=(d,e)=>{p.value=!0,u.value=1,S.value=d,U()},n=()=>{u.value<3&&u.value++},R=()=>{u.value>1&&u.value--},U=async()=>{try{y.value=!0;const d=await Y(S.value);d.data?g.value=d.data:k.error("ÁîüÊàê‰∫åÁª¥Á†ÅÂ§±Ë¥•")}catch(d){console.error("ÁîüÊàê‰∫åÁª¥Á†ÅÂ§±Ë¥•:",d),k.error("ÁîüÊàê‰∫åÁª¥Á†ÅÂ§±Ë¥•")}finally{y.value=!1}},q=async()=>{var d,e;try{await((d=m.value)==null?void 0:d.validate()),c.value=!0;const i=await _e({admin_id:S.value,google_code:V.google_code,secret:g.value.secret});i.data?(k.success("ÁªëÂÆöÊàêÂäü"),u.value=3):k.error(((e=i.data)==null?void 0:e.message)||"ÁªëÂÆöÂ§±Ë¥•")}catch(i){console.error("ÁªëÂÆöÂ§±Ë¥•:",i),k.error(i.message||"ÁªëÂÆöÂ§±Ë¥•")}finally{c.value=!1}},r=()=>{p.value=!1,h("success"),setTimeout(()=>{window.location.reload()},1e3)};return P({open:a}),(d,e)=>{const i=oe,C=Q,z=J,B=H,x=Z,L=se;return v(),ee(L,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=D=>p.value=D),title:"ÁªëÂÆöË∞∑Ê≠åÈ™åËØÅÁ†Å",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,center:""},{default:l(()=>[s("div",me,[u.value===1?(v(),A("div",ge,[s("div",fe,[o(i,{class:"step-icon"},{default:l(()=>[o(b(W))]),_:1}),e[2]||(e[2]=s("h3",null,"Êâ´Êèè‰∫åÁª¥Á†Å",-1)),e[3]||(e[3]=s("p",null,"ËØ∑‰ΩøÁî®Ë∞∑Ê≠åÈ™åËØÅÂô®Êâ´Êèè‰∏ãÊñπ‰∫åÁª¥Á†Å",-1))]),s("div",ve,[y.value?(v(),A("div",we,[o(i,{class:"is-loading"},{default:l(()=>[o(b(ae))]),_:1}),e[4]||(e[4]=s("p",null,"ÁîüÊàê‰∫åÁª¥Á†Å‰∏≠...",-1))])):g.value?(v(),A("div",he,[s("img",{src:g.value.qr_code_url,alt:"Ë∞∑Ê≠åÈ™åËØÅÁ†Å‰∫åÁª¥Á†Å"},null,8,ye),s("div",be,[s("p",null,[e[5]||(e[5]=s("strong",null,"Ë¥¶Êà∑Ôºö",-1)),E(X(g.value.account_name),1)]),s("p",null,[e[6]||(e[6]=s("strong",null,"ÂØÜÈí•Ôºö",-1)),E(X(g.value.secret),1)])])])):(v(),A("div",ke,[o(i,null,{default:l(()=>[o(b(te))]),_:1}),e[8]||(e[8]=s("p",null,"ÁîüÊàê‰∫åÁª¥Á†ÅÂ§±Ë¥•",-1)),o(C,{onClick:b(Y),type:"primary"},{default:l(()=>[...e[7]||(e[7]=[E("ÈáçËØï",-1)])]),_:1},8,["onClick"])]))]),s("div",Ve,[o(C,{onClick:n,type:"primary",disabled:!g.value},{default:l(()=>[...e[9]||(e[9]=[E(" ‰∏ã‰∏ÄÊ≠• ",-1)])]),_:1},8,["disabled"])])])):F("",!0),u.value===2?(v(),A("div",Ce,[s("div",xe,[o(i,{class:"step-icon"},{default:l(()=>[o(b(T))]),_:1}),e[10]||(e[10]=s("h3",null,"È™åËØÅÁªëÂÆö",-1)),e[11]||(e[11]=s("p",null,"ËØ∑ËæìÂÖ•Ë∞∑Ê≠åÈ™åËØÅÂô®‰∏≠ÁöÑ6‰ΩçÊï∞Â≠óÈ™åËØÅÁ†Å",-1))]),o(x,{model:V,rules:I,ref_key:"bindFormRef",ref:m,"label-width":"0"},{default:l(()=>[o(B,{prop:"google_code"},{default:l(()=>[o(z,{modelValue:V.google_code,"onUpdate:modelValue":e[0]||(e[0]=D=>V.google_code=D),placeholder:"ËØ∑ËæìÂÖ•6‰ΩçÈ™åËØÅÁ†Å",maxlength:"6",size:"large",class:"verification-input"},{prefix:l(()=>[o(i,null,{default:l(()=>[o(b(W))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),s("div",Ae,[o(C,{onClick:R},{default:l(()=>[...e[12]||(e[12]=[E("‰∏ä‰∏ÄÊ≠•",-1)])]),_:1}),o(C,{onClick:q,type:"primary",loading:c.value,disabled:!V.google_code},{default:l(()=>[...e[13]||(e[13]=[E(" ÂÆåÊàêÁªëÂÆö ",-1)])]),_:1},8,["loading","disabled"])])])):F("",!0),u.value===3?(v(),A("div",Se,[s("div",$e,[o(i,{class:"success-icon"},{default:l(()=>[o(b(ne))]),_:1}),e[15]||(e[15]=s("h3",null,"ÁªëÂÆöÊàêÂäü",-1)),e[16]||(e[16]=s("p",null,"Ë∞∑Ê≠åÈ™åËØÅÁ†ÅÂ∑≤ÊàêÂäüÁªëÂÆöÂà∞ÊÇ®ÁöÑË¥¶Êà∑",-1)),o(C,{onClick:r,type:"primary",size:"large"},{default:l(()=>[...e[14]||(e[14]=[E(" ÂÆåÊàê ",-1)])]),_:1})])])):F("",!0)])]),_:1},8,["modelValue"])}}}),Ee=O(Ie,[["__scopeId","data-v-476542ff"]]),qe={class:"dialog-footer"},Re=M({__name:"ChangePasswordDialog",emits:["success","close"],setup($,{expose:P,emit:w}){const h=w,p=t(!1),u=t(!1),y=t(0),c=j({new_password:"",confirm_password:""}),S=t(),g={new_password:[{required:!0,message:"ËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†Å",trigger:"blur"},{min:8,message:"ÂØÜÁ†ÅÈïøÂ∫¶Ëá≥Â∞ë8‰Ωç",trigger:"blur"},{validator:(m,a,n)=>{a&&a.length<8?n(new Error("ÂØÜÁ†ÅÈïøÂ∫¶Ëá≥Â∞ë8‰Ωç")):a&&!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^a-zA-Z\d])/.test(a)?n(new Error("ÂØÜÁ†ÅÂøÖÈ°ªÂåÖÂê´Â§ßÂ∞èÂÜôÂ≠óÊØç„ÄÅÊï∞Â≠ó„ÄÅÁâπÊÆäÂ≠óÁ¨¶")):n()},trigger:"blur"}],confirm_password:[{required:!0,message:"ËØ∑Á°ÆËÆ§ÂØÜÁ†Å",trigger:"blur"},{validator:(m,a,n)=>{a!==c.new_password?n(new Error("‰∏§Ê¨°ËæìÂÖ•ÁöÑÂØÜÁ†Å‰∏ç‰∏ÄËá¥")):n()},trigger:"blur"}]},V=m=>{p.value=!0,y.value=m,c.new_password="",c.confirm_password=""},I=async()=>{var m,a;try{await((m=S.value)==null?void 0:m.validate()),u.value=!0;const n=await N.post("/api/v1/admin/change-password",{admin_id:y.value,new_password:c.new_password,confirm_password:c.confirm_password});console.log("ÂØÜÁ†Å‰øÆÊîπAPIÂìçÂ∫î:",n),n.code===200&&(k.success("ÂØÜÁ†Å‰øÆÊîπÊàêÂäüÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï"),p.value=!1,h("success"))}catch(n){console.error("ÂØÜÁ†Å‰øÆÊîπÂ§±Ë¥•:",n),console.error("ÈîôËØØËØ¶ÊÉÖ:",(a=n.response)==null?void 0:a.data)}finally{u.value=!1}};return P({open:V}),(m,a)=>{const n=le,R=J,U=H,q=Z,r=Q,d=se;return v(),ee(d,{modelValue:p.value,"onUpdate:modelValue":a[3]||(a[3]=e=>p.value=e),title:"‰øÆÊîπÂØÜÁ†Å",width:"500px","close-on-click-modal":!1,"show-close":!1,"close-on-press-escape":!1,"destroy-on-close":""},{footer:l(()=>[s("div",qe,[o(r,{onClick:I,type:"primary",loading:u.value},{default:l(()=>[...a[4]||(a[4]=[E(" Á°ÆËÆ§‰øÆÊîπ ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[o(n,{title:"È¶ñÊ¨°ÁôªÂΩïÈúÄË¶Å‰øÆÊîπÂØÜÁ†Å",type:"warning",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}}),o(q,{ref_key:"formRef",ref:S,model:c,rules:g,"label-width":"120px",onSubmit:a[2]||(a[2]=re(()=>{},["prevent"]))},{default:l(()=>[o(U,{label:"Êñ∞ÂØÜÁ†Å",prop:"new_password"},{default:l(()=>[o(R,{modelValue:c.new_password,"onUpdate:modelValue":a[0]||(a[0]=e=>c.new_password=e),type:"password",placeholder:"ËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†Å","show-password":"",clearable:"",onKeyup:K(I,["enter"])},null,8,["modelValue"])]),_:1}),o(U,{label:"Á°ÆËÆ§ÂØÜÁ†Å",prop:"confirm_password"},{default:l(()=>[o(R,{modelValue:c.confirm_password,"onUpdate:modelValue":a[1]||(a[1]=e=>c.confirm_password=e),type:"password",placeholder:"ËØ∑ÂÜçÊ¨°ËæìÂÖ•Êñ∞ÂØÜÁ†Å","show-password":"",clearable:"",onKeyup:K(I,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Ue=O(Re,[["__scopeId","data-v-8ea8ed6c"]]),ze="/assets/login-header-C_4yz5CA.png",Be={class:"login-container"},De={class:"login-content"},Pe={class:"login-card"},Ge={class:"login-header"},Le={class:"logo-container"},Fe=["src"],Ne={class:"login-form-container"},Te={class:"form-item"},Ke={class:"form-item"},Me={key:0,class:"form-item google-auth-input"},Qe={class:"form-submit"},Ze={key:0},He={key:1},Je=M({__name:"Login",setup($){const P=ie(),w=t(""),h=t(""),p=t(""),u=t(!1),y=t(!1),c=t(),S=t(!1),g=t(null),V=t(),I=t(!1),m=t(null),a=t({username:"",password:"",googleAuthCode:""}),n=async()=>{var q,r,d,e,i,C,z,B,x,L,D;if(!w.value||!h.value){k.error("ËØ∑ËæìÂÖ•Ë¥¶Âè∑ÂíåÂØÜÁ†Å");return}try{y.value=!0;const f=await pe({username:w.value,password:h.value,google_code:u.value?p.value:""});if((q=f.data)!=null&&q.need_change_password){I.value=!0,m.value=f.data,(r=V.value)==null||r.open(f.data.admin_id);return}if((d=f.data)!=null&&d.need_bind_google){S.value=!0,g.value=f.data,(e=c.value)==null||e.open(f.data.admin_id,f.data.username);return}const _=f;console.log("üîç ÁôªÂΩïÂìçÂ∫îÊï∞ÊçÆ:",_),console.log("üîç responseData.data:",_.data);const G=((i=_.data)==null?void 0:i.Authorization)||((z=(C=_.data)==null?void 0:C.data)==null?void 0:z.Authorization)||((B=_.data)==null?void 0:B.token)||((L=(x=_.data)==null?void 0:x.data)==null?void 0:L.token)||_.Authorization||localStorage.getItem("token");console.log("üîç Ëé∑ÂèñÂà∞ÁöÑtoken:",G),console.log("üîç localStorage‰∏≠ÁöÑtoken:",localStorage.getItem("token")),_.status===!0||_.code===200||_.code===0||G?(G?(localStorage.setItem("token",G),console.log("‚úÖ ÁôªÂΩïÈ°µÈù¢ÂÜçÊ¨°‰øùÂ≠òtokenÔºåÈ™åËØÅ:",localStorage.getItem("token")),window.dispatchEvent(new CustomEvent("tokenSet",{detail:{token:G}}))):console.error("‚ùå token‰∏∫Á©∫ÔºåÊó†Ê≥ï‰øùÂ≠ò"),k.success("ÁôªÂΩïÊàêÂäü"),await ce(),P.push("/Home").catch(()=>{})):k.error(_.message||((D=_.data)==null?void 0:D.message)||"ÁôªÂΩïÂ§±Ë¥•")}catch(f){f.message&&f.message.includes("ËØ∑ËæìÂÖ•Ë∞∑Ê≠åÈ™åËØÅÁ†Å")&&(u.value=!0,setTimeout(()=>{const _=document.querySelector(".google-auth-input .el-input__inner");_&&_.focus()},100)),console.error("ÁôªÂΩïÈîôËØØ:",f)}finally{y.value=!1}},R=()=>{S.value=!1,g.value=null,k.success("Ë∞∑Ê≠åÈ™åËØÅÁ†ÅÁªëÂÆöÊàêÂäüÔºåÈ°µÈù¢Â∞ÜËá™Âä®Âà∑Êñ∞ÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï"),w.value="",h.value="",p.value=""},U=()=>{I.value=!1,m.value=null,k.success("ÂØÜÁ†Å‰øÆÊîπÊàêÂäüÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï"),w.value="",h.value="",p.value=""};return(q,r)=>{const d=oe,e=J,i=H,C=le,z=Q,B=Z;return v(),A("div",Be,[r[5]||(r[5]=de('<div class="background-decoration" data-v-23ae3100><div class="floating-shapes" data-v-23ae3100><div class="shape shape-1" data-v-23ae3100></div><div class="shape shape-2" data-v-23ae3100></div><div class="shape shape-3" data-v-23ae3100></div><div class="shape shape-4" data-v-23ae3100></div></div></div>',1)),s("div",De,[s("div",Pe,[s("div",Ge,[s("div",Le,[s("img",{src:b(ze),alt:"Á≥ªÁªüLogo",class:"logo"},null,8,Fe)]),r[3]||(r[3]=s("h1",{class:"welcome-title"},"Ê¨¢ËøéÁôªÂΩï",-1)),r[4]||(r[4]=s("p",{class:"welcome-subtitle"},"Áôæ‰∫ø‰∏âÊñπÊîØ‰ªòÁÆ°ÁêÜÁ≥ªÁªü",-1))]),s("div",Ne,[o(B,{model:a.value,class:"login-form","label-position":"top",size:"large"},{default:l(()=>[s("div",Te,[o(i,null,{default:l(()=>[o(e,{modelValue:w.value,"onUpdate:modelValue":r[0]||(r[0]=x=>w.value=x),placeholder:"ËØ∑ËæìÂÖ•ÁôªÂΩïË¥¶Âè∑",class:"custom-input",clearable:""},{prefix:l(()=>[o(d,{class:"input-icon"},{default:l(()=>[o(b(ue))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),s("div",Ke,[o(i,null,{default:l(()=>[o(e,{modelValue:h.value,"onUpdate:modelValue":r[1]||(r[1]=x=>h.value=x),type:"password",placeholder:"ËØ∑ËæìÂÖ•ÁôªÂΩïÂØÜÁ†Å",class:"custom-input","show-password":"",clearable:""},{prefix:l(()=>[o(d,{class:"input-icon"},{default:l(()=>[o(b(T))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),u.value?(v(),A("div",Me,[o(C,{title:"ËØ∑ËæìÂÖ•Ë∞∑Ê≠åÈ™åËØÅÁ†Å",type:"info",closable:!1,"show-icon":"",class:"google-auth-alert"}),o(i,null,{default:l(()=>[o(e,{modelValue:p.value,"onUpdate:modelValue":r[2]||(r[2]=x=>p.value=x),placeholder:"ËØ∑ËæìÂÖ•6‰ΩçÈ™åËØÅÁ†Å",class:"custom-input",clearable:"",maxlength:"6",onKeyup:K(n,["enter"])},{prefix:l(()=>[o(d,{class:"input-icon"},{default:l(()=>[o(b(T))]),_:1})]),_:1},8,["modelValue"])]),_:1})])):F("",!0),s("div",Qe,[o(z,{type:"primary",size:"large",class:"login-button",onClick:n,disabled:!w.value||!h.value,loading:y.value},{default:l(()=>[y.value?(v(),A("span",He,"ÁôªÂΩï‰∏≠...")):(v(),A("span",Ze,"ÁôªÂΩïË¥¶Âè∑"))]),_:1},8,["disabled","loading"])])]),_:1},8,["model"])])])]),o(Ee,{ref_key:"googleAuthBindRef",ref:c,onSuccess:R},null,512),o(Ue,{ref_key:"changePasswordRef",ref:V,onSuccess:U},null,512)])}}}),Xe=O(Je,[["__scopeId","data-v-23ae3100"]]);export{Xe as default};
//# sourceMappingURL=Login-DG50_iRo.js.map
