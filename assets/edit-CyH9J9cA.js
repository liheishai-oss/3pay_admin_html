import{d as R,g as p,a9 as k,i as c,w as t,s as f,C as v,D as $,o as i,a,x as G,j as y,E as D,b as O,y as j,c as h,ap as z,M as H,as as K,aq as X,z as J,X as Q,F as W,e as Y,q as Z,n as x,aF as ee,_ as ae}from"./index-Bd9DWvNd.js";/* empty css              *//* empty css               */const te={key:0,class:"form-tip"},le={class:"dialog-footer"},re=R({__name:"edit",emits:["refresh"],setup(oe,{expose:E,emit:I}){const U=I,g=p(),m=p(!1),l=p({id:0,agent_id:"",merchant_name:"",contact_email:"",notify_url:"",return_url:"",ip_whitelist:"",status:1,remark:""}),b=p({}),_=k(()=>{var r;return((r=b.value)==null?void 0:r.is_agent)===!0}),V=p([]),T=k(()=>{const r={merchant_name:[{required:!0,message:"请输入商户名称",trigger:"blur"}],contact_email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]};return _.value||(r.agent_id=[{required:!0,message:"请选择代理商",trigger:"change"}]),r}),A=async()=>{try{const r=await f({url:"/api/v1/admin/user/info",method:"GET"});r.status&&(b.value=r.data)}catch(r){console.error("获取用户信息失败:",r)}},B=async()=>{if(!_.value)try{const r=await f({url:"/api/v1/admin/merchant/agent-list",method:"GET"});r.status&&(V.value=r.data)}catch(r){console.error("获取代理商列表失败:",r)}},C=async r=>{if(await A(),await B(),r.id)try{const e=await f({url:`/api/v1/admin/merchant/detail/${r.id}`,method:"GET"});e.status&&(l.value={...e.data})}catch(e){console.error("获取详情失败:",e),v.error("获取详情失败");return}else{const e=_.value?b.value.agent_id:"";l.value={id:0,agent_id:e,merchant_name:"",contact_email:"",notify_url:"",return_url:"",ip_whitelist:"",status:1,remark:""}}m.value=!0,setTimeout(()=>{var e;(e=g.value)==null||e.clearValidate()},100)},P=async()=>{try{await g.value.validate();const r=l.value.id?"/api/v1/admin/merchant/edit":"/api/v1/admin/merchant/add",e=await f({url:r,method:"POST",data:l.value});e.status?(!l.value.id&&e.data&&e.data.api_key?await ee.alert(`<div style="word-break: break-all;">
            <p><strong>API Key:</strong><br/>${e.data.api_key}</p>
            <p style="margin-top: 10px;"><strong>API Secret:</strong><br/>${e.data.api_secret}</p>
            <p style="margin-top: 10px; color: red;">请妥善保管以上信息，关闭后将无法再次查看！</p>
          </div>`,"商户创建成功",{dangerouslyUseHTMLString:!0,confirmButtonText:"我已复制"}):v.success(e.msg||"操作成功"),m.value=!1,U("refresh")):v.error(e.msg||"操作失败")}catch(r){console.error("提交失败:",r),r!==!1&&v.error("提交失败")}};return E({open:C}),(r,e)=>{const S=X,F=z,n=j,u=O,s=D,d=J,q=Q,L=W,M=G,w=Z,N=$;return i(),c(N,{modelValue:m.value,"onUpdate:modelValue":e[9]||(e[9]=o=>m.value=o),title:l.value.id===0?"新增商户":"编辑商户",width:"700px","close-on-click-modal":!1},{footer:t(()=>[Y("span",le,[a(w,{onClick:e[8]||(e[8]=o=>m.value=!1)},{default:t(()=>[...e[10]||(e[10]=[x("取消",-1)])]),_:1}),a(w,{type:"primary",onClick:P},{default:t(()=>[...e[11]||(e[11]=[x("确定",-1)])]),_:1})])]),default:t(()=>[a(M,{model:l.value,"label-width":"140px",rules:T.value,ref_key:"formRef",ref:g},{default:t(()=>[_.value?y("",!0):(i(),c(s,{key:0,gutter:20},{default:t(()=>[a(u,{span:24},{default:t(()=>[a(n,{label:"代理商",prop:"agent_id"},{default:t(()=>[a(F,{modelValue:l.value.agent_id,"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.agent_id=o),placeholder:"请选择代理商",clearable:"",filterable:"",disabled:l.value.id>0},{default:t(()=>[(i(!0),h(H,null,K(V.value,o=>(i(),c(S,{key:o.id,label:o.agent_name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l.value.id>0?(i(),h("div",te,"代理商创建后不可修改")):y("",!0)]),_:1})]),_:1})]),_:1})),a(s,{gutter:20},{default:t(()=>[a(u,{span:24},{default:t(()=>[a(n,{label:"商户名称",prop:"merchant_name"},{default:t(()=>[a(d,{modelValue:l.value.merchant_name,"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.merchant_name=o),placeholder:"请输入商户名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(s,{gutter:20},{default:t(()=>[a(u,{span:24},{default:t(()=>[a(n,{label:"联系邮箱",prop:"contact_email"},{default:t(()=>[a(d,{modelValue:l.value.contact_email,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.contact_email=o),placeholder:"请输入联系邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(s,{gutter:20},{default:t(()=>[a(u,{span:24},{default:t(()=>[a(n,{label:"回调通知地址",prop:"notify_url"},{default:t(()=>[a(d,{modelValue:l.value.notify_url,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.notify_url=o),placeholder:"请输入回调通知地址",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(s,{gutter:20},{default:t(()=>[a(u,{span:24},{default:t(()=>[a(n,{label:"同步返回地址",prop:"return_url"},{default:t(()=>[a(d,{modelValue:l.value.return_url,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.return_url=o),placeholder:"请输入同步返回地址",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(s,{gutter:20},{default:t(()=>[a(u,{span:24},{default:t(()=>[a(n,{label:"IP白名单",prop:"ip_whitelist"},{default:t(()=>[a(d,{modelValue:l.value.ip_whitelist,"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.ip_whitelist=o),type:"textarea",rows:3,placeholder:"多个IP用逗号分隔，例如：192.168.1.1,192.168.1.2",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(s,{gutter:20},{default:t(()=>[a(u,{span:24},{default:t(()=>[a(n,{label:"备注",prop:"remark"},{default:t(()=>[a(d,{modelValue:l.value.remark,"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.remark=o),type:"textarea",rows:3,placeholder:"请输入备注信息",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(s,{gutter:20},{default:t(()=>[a(u,{span:24},{default:t(()=>[a(n,{label:"状态",prop:"status"},{default:t(()=>[a(q,{modelValue:l.value.status,"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.status=o),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l.value.id===0?(i(),c(L,{key:1,title:"商户创建成功后将自动生成API密钥，请妥善保管",type:"warning",closable:!1,style:{"margin-bottom":"20px"}})):y("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),de=ae(re,[["__scopeId","data-v-3ef06d1b"]]);export{de as default};
//# sourceMappingURL=edit-CyH9J9cA.js.map
