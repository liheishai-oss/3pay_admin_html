import{d as re,u as ie,r as p,c as V,o as de,a as h,b as t,e as s,f as E,g as w,w as l,s as z,E as F,h as ce,i as me,j as pe,k as _e,l as fe,m as ve,n as i,p as _,t as o,F as L,q as O,v as ge,x as ye,y as be,z as he,A as we,B as ke,C as xe,D as De,G as Ee,H as Ce,I as Ne,J as Se,K as Me,_ as Te}from"./index-CZqKrVMb.js";/* empty css                *//* empty css                          *//* empty css               *//* empty css              *//* empty css                     *//* empty css                 *//* empty css                 */const Ve={key:0,class:"merchant-dashboard"},ze={class:"welcome-card__left"},Re={class:"stat-card__label"},Ye={class:"stat-card__value"},$e={class:"stat-card__suffix"},Be={class:"stat-card__desc"},He={class:"card-header"},Pe={class:"rate-wrapper"},Fe={class:"rate-detail"},Le={class:"card-header"},Oe={class:"card-actions"},Ie={class:"summary-list"},Ge={class:"summary-list"},Ue={key:0,class:"floating-controls"},Je={key:1,class:"non-merchant-placeholder"},je=re({__name:"Home",setup(qe){const I=ve(),R=ie(),C=p(!1),v=p(!1),k=p(null),u=p(Y()),N=p([]),S=p("today"),f=p($("today")),G=[{label:"今日",value:"today"},{label:"昨日",value:"yesterday"},{label:"近7天",value:"week"},{label:"近30天",value:"month"},{label:"自定义",value:"custom"}],m=V(()=>{var a;return Number((a=k.value)==null?void 0:a.user_group_id)===4}),M=V(()=>{const a=Number(u.value.success_rate||0);return Number.isNaN(a)?0:Math.min(100,Math.max(0,Number(a.toFixed(2))))}),U=V(()=>[{label:"订单总量",value:u.value.total_count,suffix:"笔",desc:"该时间段产生的订单"},{label:"成交金额",value:`¥${y(u.value.paid_amount)}`,suffix:"",desc:"已完成支付的总金额"},{label:"成功订单",value:u.value.paid_count,suffix:"笔",desc:"支付成功数量"},{label:"成功率",value:`${M.value}`,suffix:"%",desc:"支付成功占比"}]);function Y(){return{total_count:0,paid_count:0,unpaid_count:0,closed_count:0,refunded_count:0,total_amount:0,paid_amount:0,success_rate:0,official_fee:0,last_minute_count:0}}function g(a){return String(a).padStart(2,"0")}function d(a,e=!1){return`${a.getFullYear()}-${g(a.getMonth()+1)}-${g(a.getDate())} ${g(e?23:0)}:${g(e?59:0)}:${g(e?59:0)}`}function $(a){const e=new Date,r=new Date(e);switch(a){case"today":return[d(e),d(e,!0)];case"yesterday":r.setDate(r.getDate()-1);const c=new Date(r);return[d(c),d(c,!0)];case"week":return r.setDate(r.getDate()-6),[d(r),d(e,!0)];case"month":return r.setDate(r.getDate()-29),[d(r),d(e,!0)];default:return f.value}}function B(){const[a,e]=f.value;return{start_time:a,end_time:e}}const J=a=>{m.value&&a!=="custom"&&(f.value=$(a),x())},j=a=>{m.value&&(!a||a.length!==2||(f.value=a,x()))},x=async()=>{m.value&&await Promise.all([q(),A()])},q=async()=>{if(m.value){C.value=!0;try{const a=await z({url:"/api/v1/admin/order/statistics",method:"GET",params:B()});u.value={...Y(),...a.data||{}}}catch(a){F.error((a==null?void 0:a.message)||"获取统计数据失败")}finally{C.value=!1}}},A=async()=>{var a;if(m.value){v.value=!0;try{const e=await z({url:"/api/v1/admin/order/list",method:"GET",params:{page:1,page_size:5,search:JSON.stringify(B())}});N.value=((a=e.data)==null?void 0:a.data)||[]}catch(e){F.error((e==null?void 0:e.message)||"获取订单列表失败")}finally{v.value=!1}}},K=async()=>{try{const a=await z({url:"/api/v1/admin/user/info",method:"GET"});k.value=a.data||null}catch{}},W=()=>{const a="/order/home";R.findTabByPath(a)||R.addWebTab({name:a,title:"订单管理",content:"",path:a}),I.push(a)};function y(a){return Number(a||0).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2})}function Q(a){return{0:"已创建",1:"已支付",2:"已关闭",3:"已退款",4:"已打开"}[a]||"未知"}function X(a){return{0:"info",1:"success",2:"warning",3:"danger",4:"warning"}[a]||"info"}return de(async()=>{await K(),await x()}),(a,e)=>{var P;const r=ce,c=ye,b=ge,T=me,Z=be,ee=Ee,D=ke,te=we,H=De,ae=Ce,le=pe,se=_e,ne=Ne,oe=fe,ue=xe;return m.value?(i(),h("div",Ve,[t("div",ze,[(P=k.value)!=null&&P.merchant_name?(i(),w(r,{key:0,effect:"dark",round:""},{default:l(()=>[_(o(k.value.merchant_name),1)]),_:1})):E("",!0)]),s(T,{gutter:20,class:"stat-grid"},{default:l(()=>[(i(!0),h(L,null,O(U.value,n=>(i(),w(b,{key:n.label,xs:24,sm:12,md:6},{default:l(()=>[s(c,{shadow:"hover",class:"stat-card"},{default:l(()=>[t("p",Re,o(n.label),1),t("p",Ye,[_(o(n.value)+" ",1),t("span",$e,o(n.suffix),1)]),t("p",Be,o(n.desc),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),s(T,{gutter:20,class:"content-grid"},{default:l(()=>[s(b,{xs:24,lg:12},{default:l(()=>[s(c,{shadow:"never",class:"panel-card"},{header:l(()=>[t("div",He,[e[2]||(e[2]=t("span",null,"成交质量",-1)),s(r,{type:"success",effect:"plain"},{default:l(()=>[_(" 成功率 "+o(M.value)+"% ",1)]),_:1})])]),default:l(()=>[t("div",Pe,[s(Z,{percentage:M.value,"stroke-width":12,status:"success",striped:"","striped-flow":""},null,8,["percentage"]),t("ul",Fe,[t("li",null,[e[3]||(e[3]=t("span",null,"成功笔数",-1)),t("b",null,o(u.value.paid_count),1)]),t("li",null,[e[4]||(e[4]=t("span",null,"失败/关闭",-1)),t("b",null,o(u.value.closed_count+u.value.refunded_count),1)]),t("li",null,[e[5]||(e[5]=t("span",null,"等待支付",-1)),t("b",null,o(u.value.unpaid_count),1)]),t("li",null,[e[6]||(e[6]=t("span",null,"一分钟订单",-1)),t("b",null,o(u.value.last_minute_count),1)])])])]),_:1})]),_:1}),s(b,{xs:24,lg:12},{default:l(()=>[s(c,{shadow:"never",class:"panel-card table-panel"},{header:l(()=>[t("div",Le,[e[9]||(e[9]=t("span",null,"最新订单",-1)),t("div",Oe,[e[8]||(e[8]=t("span",{class:"card-tip"},"显示最近 5 条",-1)),s(ee,{type:"primary",onClick:W},{default:l(()=>[...e[7]||(e[7]=[_(" 前往订单中心 ",-1)])]),_:1})])])]),default:l(()=>[he((i(),w(te,{data:N.value,"empty-text":"暂无订单数据",size:"small",border:""},{default:l(()=>[s(D,{prop:"platform_order_no",label:"平台订单号","min-width":"150","show-overflow-tooltip":""}),s(D,{label:"金额",width:"90"},{default:l(({row:n})=>[_(" ¥"+o(y(n.order_amount)),1)]),_:1}),s(D,{label:"支付状态",width:"110"},{default:l(({row:n})=>[s(r,{type:X(n.pay_status),effect:"plain",size:"small"},{default:l(()=>[_(o(Q(n.pay_status)),1)]),_:2},1032,["type"])]),_:1}),s(D,{prop:"created_at",label:"创建时间","min-width":"140","show-overflow-tooltip":""})]),_:1},8,["data"])),[[ue,v.value]]),!N.value.length&&!v.value?(i(),w(H,{key:0,description:"当前时间段暂无订单","image-size":120})):E("",!0)]),_:1})]),_:1})]),_:1}),s(T,{gutter:20,class:"content-grid"},{default:l(()=>[s(b,{xs:24,lg:12},{default:l(()=>[s(c,{shadow:"never",class:"panel-card summary-panel"},{header:l(()=>[...e[10]||(e[10]=[t("div",{class:"card-header"},[t("span",null,"金额分布")],-1)])]),default:l(()=>[t("ul",Ie,[t("li",null,[e[11]||(e[11]=t("span",null,"总金额",-1)),t("b",null,"¥"+o(y(u.value.total_amount)),1)]),t("li",null,[e[12]||(e[12]=t("span",null,"成交金额",-1)),t("b",null,"¥"+o(y(u.value.paid_amount)),1)]),t("li",null,[e[13]||(e[13]=t("span",null,"官方手续费",-1)),t("b",null,"¥"+o(y(u.value.official_fee)),1)])])]),_:1})]),_:1}),s(b,{xs:24,lg:12},{default:l(()=>[s(c,{shadow:"never",class:"panel-card summary-panel"},{header:l(()=>[...e[14]||(e[14]=[t("div",{class:"card-header"},[t("span",null,"订单分布")],-1)])]),default:l(()=>[t("ul",Ge,[t("li",null,[e[15]||(e[15]=t("span",null,"总订单",-1)),t("b",null,o(u.value.total_count)+" 笔",1)]),t("li",null,[e[16]||(e[16]=t("span",null,"付款成功",-1)),t("b",null,o(u.value.paid_count)+" 笔",1)]),t("li",null,[e[17]||(e[17]=t("span",null,"关闭/退款",-1)),t("b",null,o(u.value.closed_count+u.value.refunded_count)+" 笔",1)])])]),_:1})]),_:1})]),_:1}),m.value?(i(),h("div",Ue,[s(le,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=n=>S.value=n),class:"range-select",size:"large",placeholder:"选择统计周期",onChange:J},{default:l(()=>[(i(),h(L,null,O(G,n=>s(ae,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),S.value==="custom"?(i(),w(se,{key:0,modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=n=>f.value=n),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss",class:"custom-range",size:"large",onChange:j},null,8,["modelValue"])):E("",!0),s(oe,{type:"primary",loading:C.value||v.value,size:"large",onClick:x},{default:l(()=>[s(ne,null,{default:l(()=>[s(Se(Me))]),_:1}),e[18]||(e[18]=_(" 刷新数据 ",-1))]),_:1},8,["loading"])])):E("",!0)])):(i(),h("div",Je,[s(H,{description:"请选择左侧菜单进入对应功能","image-size":"180"})]))}}}),at=Te(je,[["__scopeId","data-v-31a11f2d"]]);export{at as default};
//# sourceMappingURL=Home-Bf4h9NPn.js.map
