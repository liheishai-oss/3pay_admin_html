{"version":3,"file":"edit-BR6EcOTb.js","sources":["../../src/pages/single-royalty/edit.vue"],"sourcesContent":["<template>\n  <el-dialog\n    v-model=\"visible\"\n    :title=\"form.id ? '编辑单笔分账' : '新增单笔分账'\"\n    width=\"600px\"\n    :close-on-click-modal=\"false\"\n  >\n    <el-form\n      ref=\"formRef\"\n      :model=\"form\"\n      :rules=\"formRules\"\n      label-width=\"140px\"\n    >\n      <el-form-item label=\"代理商\" prop=\"agent_id\" v-if=\"!isAgent\">\n        <el-select \n          v-model=\"form.agent_id\" \n          placeholder=\"请选择代理商\" \n          clearable\n          filterable\n          :disabled=\"form.id > 0\"\n        >\n          <el-option\n            v-for=\"agent in agentList\"\n            :key=\"agent.id\"\n            :label=\"agent.agent_name\"\n            :value=\"agent.id\"\n          />\n        </el-select>\n        <div class=\"form-tip\" v-if=\"form.id > 0\">代理商创建后不可修改</div>\n      </el-form-item>\n\n      <el-form-item label=\"收款人姓名\" prop=\"payee_name\">\n        <el-input \n          v-model=\"form.payee_name\" \n          placeholder=\"请输入收款人姓名\" \n          clearable\n        />\n      </el-form-item>\n\n      <el-form-item label=\"收款人账号\" prop=\"payee_account\">\n        <el-input \n          v-model=\"form.payee_account\" \n          placeholder=\"请输入收款人账号\" \n          clearable\n        />\n      </el-form-item>\n\n      <el-form-item label=\"收款人用户ID\" prop=\"payee_user_id\">\n        <el-input \n          v-model=\"form.payee_user_id\" \n          placeholder=\"请输入收款人用户ID\" \n          clearable\n        />\n      </el-form-item>\n\n      <el-form-item label=\"状态\" prop=\"status\">\n        <el-switch \n          v-model=\"form.status\" \n          :active-value=\"1\" \n          :inactive-value=\"0\"\n          active-text=\"启用\"\n          inactive-text=\"禁用\"\n        />\n      </el-form-item>\n    </el-form>\n\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"visible = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"handleSubmit\" :loading=\"submitLoading\">\n          确定\n        </el-button>\n      </span>\n    </template>\n  </el-dialog>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref, reactive, computed } from 'vue'\nimport { ElMessage } from 'element-plus'\nimport request from '@/utils/request'\n\nconst emit = defineEmits(['refresh'])\n\n// 用户信息\nconst userInfo = ref<any>({})\nconst isAgent = computed(() => userInfo.value?.is_agent === true)\n\nconst visible = ref(false)\nconst submitLoading = ref(false)\nconst formRef = ref(null)\nconst agentList = ref([])\n\nconst form = ref({\n  id: 0,\n  agent_id: '',\n  payee_name: '',\n  payee_account: '',\n  payee_user_id: '',\n  status: 1\n})\n\n// 动态验证规则\nconst formRules = computed(() => {\n  const rules = {\n    payee_name: [\n      { required: true, message: '请输入收款人姓名', trigger: 'blur' }\n    ],\n    payee_account: [\n      { required: true, message: '请输入收款人账号', trigger: 'blur' }\n    ],\n    payee_user_id: [\n      { required: true, message: '请输入收款人用户ID', trigger: 'blur' }\n    ]\n  }\n  \n  // 非代理商需要验证agent_id\n  if (!isAgent.value) {\n    rules.agent_id = [\n      { required: true, message: '请选择代理商', trigger: 'change' }\n    ]\n  }\n  \n  return rules\n})\n\n// 获取用户信息\nconst getUserInfo = async () => {\n  try {\n    const res = await request({\n      url: '/api/v1/admin/user/info',\n      method: 'GET'\n    })\n    if (res.status) {\n      userInfo.value = res.data\n    }\n  } catch (error) {\n    console.error('获取用户信息失败:', error)\n  }\n}\n\n// 获取代理商列表\nconst getAgentList = async () => {\n  if (isAgent.value) return\n  \n  try {\n    const res = await request({\n      url: '/api/v1/admin/single-royalty/agent-list',\n      method: 'GET'\n    })\n    if (res.status) {\n      agentList.value = res.data\n    }\n  } catch (error) {\n    console.error('获取代理商列表失败:', error)\n  }\n}\n\n// 打开对话框\nconst open = async (row) => {\n  // 先获取用户信息\n  await getUserInfo()\n  \n  // 然后获取其他数据\n  await getAgentList()\n  \n  if (row.id) {\n    // 编辑模式 - 获取详情\n    try {\n      const res = await request({\n        url: `/api/v1/admin/single-royalty/detail/${row.id}`,\n        method: 'GET'\n      })\n      if (res.status) {\n        form.value = { ...res.data }\n      }\n    } catch (error) {\n      console.error('获取详情失败:', error)\n      ElMessage.error('获取详情失败')\n      return\n    }\n  } else {\n    // 新增模式 - 重置表单\n    const currentAgentId = isAgent.value ? userInfo.value.agent_id : ''\n    \n    form.value = {\n      id: 0,\n      agent_id: currentAgentId,\n      payee_name: '',\n      payee_account: '',\n      payee_user_id: '',\n      status: 1\n    }\n  }\n  \n  visible.value = true\n  \n  // 清除验证\n  setTimeout(() => {\n    formRef.value?.clearValidate()\n  }, 100)\n}\n\n// 提交表单\nconst handleSubmit = async () => {\n  try {\n    await formRef.value.validate()\n    \n    submitLoading.value = true\n    \n    const url = form.value.id \n      ? '/api/v1/admin/single-royalty/edit' \n      : '/api/v1/admin/single-royalty/add'\n    \n    const res = await request({\n      url,\n      method: 'POST',\n      data: form.value\n    })\n    \n    if (res.status) {\n      ElMessage.success(res.msg || '操作成功')\n      visible.value = false\n      emit('refresh')\n    } else {\n      ElMessage.error(res.msg || '操作失败')\n    }\n  } catch (error) {\n    console.error('提交失败:', error)\n    if (error !== false) { // 验证失败时返回false\n      ElMessage.error('提交失败')\n    }\n  } finally {\n    submitLoading.value = false\n  }\n}\n\ndefineExpose({\n  open\n})\n</script>\n\n<style scoped>\n.form-tip {\n  font-size: 12px;\n  color: #909399;\n  margin-top: 4px;\n}\n</style>\n\n"],"names":["emit","__emit","userInfo","ref","isAgent","computed","_a","visible","submitLoading","formRef","agentList","form","formRules","rules","getUserInfo","res","request","error","getAgentList","open","row","ElMessage","currentAgentId","handleSubmit","url","__expose","_createBlock","_component_el_dialog","$event","_createElementVNode","_hoisted_2","_createVNode","_component_el_button","_cache","_component_el_form","_component_el_form_item","_component_el_select","_createElementBlock","_Fragment","_renderList","agent","_component_el_option","_hoisted_1","_component_el_input","_component_el_switch"],"mappings":"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"}