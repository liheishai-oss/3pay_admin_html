import{d as _e,r as m,c as fe,o as ve,a as k,e,b as i,w as t,a0 as ge,J as r,F as T,s as x,l as be,a1 as ye,U as he,A as we,a2 as Ve,n as _,z as ke,x as Ce,Q as Ee,i as xe,v as Se,R as je,j as De,q,g as R,H as Ue,S as ze,k as Fe,p as u,I as Te,a5 as A,K as H,a3 as Re,aQ as Ye,aw as Be,f as Ie,ax as Ne,t as v,V as Le,B as Me,E as S,_ as Pe}from"./index-BZRJkKFz.js";/* empty css                   *//* empty css               *//* empty css                     *//* empty css                 *//* empty css              *//* empty css                          *//* empty css                          */import{u as qe}from"./table.plugin-DXsYOb2o.js";const Ae={class:"table-com-search"},He={class:"search-buttons"},Ge={class:"table-header ba-scroll-style"},Oe={class:"table-search"},Qe={class:"confirm-content"},$e={style:{color:"#f56c6c","font-size":"18px","font-weight":"bold"}},Je={class:"confirm-tip"},Ke={class:"dialog-footer"},We={class:"dialog-footer"},Xe={style:{width:"100%","overflow-x":"auto"},class:"table-content"},Ze={key:0},ea={key:1},aa={class:"table-footer"},ta={class:"table-pagination"},la=_e({__name:"transfer-order",setup(oa){const{loadData:G,data:g,refreshData:C,handleSizeChange:O,handleCurrentChange:Q,searchParams:j,isVisible:$,toggleVisibility:J}=qe("/api/v1/admin/single-royalty/transfer-order-list"),D=m([]),s=m({subject_id:"",payee_name:"",payee_account:"",start_time:"",end_time:""}),K=l=>{l&&l.length===2?(s.value.start_time=l[0],s.value.end_time=l[1]):(s.value.start_time="",s.value.end_time="")},Y=m([]),E=m([]),U=m({}),W=fe(()=>{var l;return((l=U.value)==null?void 0:l.is_agent)===!0}),y=m(!1),h=m(!1),z=m(!1),F=m(null),n=m({subject_id:"",payee_name:"",payee_account:"",amount:"",remark:""}),X={subject_id:[{required:!0,message:"请选择转出主体",trigger:"change"}],payee_name:[{required:!0,message:"请输入收款人姓名",trigger:"blur"}],payee_account:[{required:!0,message:"请输入收款人账号",trigger:"blur"}],amount:[{required:!0,message:"请输入转账金额",trigger:"blur"},{validator:(l,a,f)=>{a&&(isNaN(a)||parseFloat(a)<=0)?f(new Error("转账金额必须大于0")):f()},trigger:"blur"}]},B=async()=>{try{const l=await x({url:"/api/v1/admin/user/info",method:"GET"});l.status&&(U.value=l.data)}catch(l){console.error("获取用户信息失败:",l)}},Z=async()=>{try{const l=await x({url:"/api/v1/admin/subject/list",method:"GET",params:{page_size:1e3}});l.status&&l.data.data&&(Y.value=l.data.data)}catch(l){console.error("获取主体列表失败:",l)}},ee=async()=>{try{const l=await x({url:"/api/v1/admin/subject/list",method:"GET",params:{page_size:1e3,status:1}});l.status&&l.data.data&&(W.value?E.value=l.data.data.filter(a=>a.agent_id===U.value.agent_id):E.value=l.data.data)}catch(l){console.error("获取代理商主体列表失败:",l)}},ae=async()=>{await B(),await ee(),n.value={subject_id:"",payee_name:"",payee_account:"",amount:"",remark:""},y.value=!0,setTimeout(()=>{var l;(l=F.value)==null||l.clearValidate()},100)},te=l=>{if(!l)return"-";const a=E.value.find(f=>f.id===l);return(a==null?void 0:a.company_name)||"-"},le=async()=>{try{await F.value.validate(),y.value=!1,h.value=!0}catch(l){console.error("表单验证失败:",l),l!==!1&&S.error("请填写完整的转账信息")}},oe=async()=>{try{z.value=!0;const l=await x({url:"/api/v1/admin/single-royalty/transfer",method:"POST",data:{subject_id:n.value.subject_id,payee_name:n.value.payee_name,payee_account:n.value.payee_account,amount:parseFloat(n.value.amount),remark:n.value.remark||""}});l.status?(S.success(l.msg||"转账成功"),h.value=!1,n.value={subject_id:"",payee_name:"",payee_account:"",amount:"",remark:""},C()):S.error(l.msg||"转账失败")}catch(l){console.error("转账失败:",l),l!==!1&&S.error("转账失败")}finally{z.value=!1}},ne=async()=>{j.value={...s.value},await C()},re=()=>{D.value=[],s.value={subject_id:"",payee_name:"",payee_account:"",start_time:"",end_time:""},j.value={...s.value},C()};return ve(async()=>{await B(),await Z(),j.value={...s.value},G()}),(l,a)=>{const f=Ue,I=De,d=je,w=Se,b=ze,se=Fe,N=xe,L=Te,c=be,M=Ee,ue=Ce,ie=ye,V=Ne,de=Be,me=Le,P=he,p=Me,ce=we,pe=Ve;return _(),k(T,null,[e(ge,{name:"fade"},{default:t(()=>[ke(i("div",Ae,[e(ue,{class:"search-card",shadow:"never"},{default:t(()=>[e(M,{model:s.value,"label-width":"100px",class:"search-form"},{default:t(()=>[e(N,{gutter:20},{default:t(()=>[e(w,{span:6},{default:t(()=>[e(d,{label:"转出主体"},{default:t(()=>[e(I,{modelValue:s.value.subject_id,"onUpdate:modelValue":a[0]||(a[0]=o=>s.value.subject_id=o),placeholder:"请选择主体",clearable:"",filterable:"",style:{width:"100%"}},{default:t(()=>[(_(!0),k(T,null,q(Y.value,o=>(_(),R(f,{key:o.id,label:o.company_name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(w,{span:6},{default:t(()=>[e(d,{label:"收款人姓名"},{default:t(()=>[e(b,{modelValue:s.value.payee_name,"onUpdate:modelValue":a[1]||(a[1]=o=>s.value.payee_name=o),placeholder:"请输入收款人姓名",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:6},{default:t(()=>[e(d,{label:"收款人账号"},{default:t(()=>[e(b,{modelValue:s.value.payee_account,"onUpdate:modelValue":a[2]||(a[2]=o=>s.value.payee_account=o),placeholder:"请输入收款人账号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:6},{default:t(()=>[e(d,{label:"转账时间"},{default:t(()=>[e(se,{modelValue:D.value,"onUpdate:modelValue":a[3]||(a[3]=o=>D.value=o),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"},onChange:K,clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(N,{gutter:20},{default:t(()=>[e(w,{span:6},{default:t(()=>[e(d,null,{default:t(()=>[i("div",He,[e(c,{type:"primary",onClick:ne},{default:t(()=>[e(L,null,{default:t(()=>[e(r(A))]),_:1}),a[15]||(a[15]=u("搜索 ",-1))]),_:1}),e(c,{onClick:re},{default:t(()=>[e(L,null,{default:t(()=>[e(r(H))]),_:1}),a[16]||(a[16]=u("重置 ",-1))]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[Re,r($)]])]),_:1}),i("div",Ge,[e(c,{icon:r(H),onClick:r(C),color:"#40485b"},null,8,["icon","onClick"]),e(c,{type:"primary",icon:r(Ye),onClick:ae},{default:t(()=>[...a[17]||(a[17]=[u("转账",-1)])]),_:1},8,["icon"]),i("div",Oe,[e(ie,{class:"ml-4"},{default:t(()=>[e(c,{icon:r(A),onClick:r(J)},null,8,["icon","onClick"])]),_:1})])]),e(P,{modelValue:h.value,"onUpdate:modelValue":a[5]||(a[5]=o=>h.value=o),title:"确认转账信息",width:"500px","close-on-click-modal":!1},{footer:t(()=>[i("span",Ke,[e(c,{onClick:a[4]||(a[4]=o=>h.value=!1)},{default:t(()=>[...a[18]||(a[18]=[u("取消",-1)])]),_:1}),e(c,{type:"primary",onClick:oe,loading:z.value},{default:t(()=>[...a[19]||(a[19]=[u(" 确认转账 ",-1)])]),_:1},8,["loading"])])]),default:t(()=>[i("div",Qe,[e(de,{column:1,border:""},{default:t(()=>[e(V,{label:"转出主体"},{default:t(()=>[u(v(te(n.value.subject_id)),1)]),_:1}),e(V,{label:"收款人姓名"},{default:t(()=>[u(v(n.value.payee_name),1)]),_:1}),e(V,{label:"收款人账号"},{default:t(()=>[u(v(n.value.payee_account),1)]),_:1}),e(V,{label:"转账金额"},{default:t(()=>[i("span",$e," ¥"+v(n.value.amount||"0.00"),1)]),_:1}),n.value.remark?(_(),R(V,{key:0,label:"备注"},{default:t(()=>[u(v(n.value.remark),1)]),_:1})):Ie("",!0)]),_:1}),i("div",Je,[e(me,{title:"请确认转账信息无误后再提交",type:"warning",closable:!1,"show-icon":""})])])]),_:1},8,["modelValue"]),e(P,{modelValue:y.value,"onUpdate:modelValue":a[12]||(a[12]=o=>y.value=o),title:"转账",width:"600px","close-on-click-modal":!1},{footer:t(()=>[i("span",We,[e(c,{onClick:a[11]||(a[11]=o=>y.value=!1)},{default:t(()=>[...a[21]||(a[21]=[u("取消",-1)])]),_:1}),e(c,{type:"primary",onClick:le},{default:t(()=>[...a[22]||(a[22]=[u(" 下一步 ",-1)])]),_:1})])]),default:t(()=>[e(M,{ref_key:"transferFormRef",ref:F,model:n.value,rules:X,"label-width":"120px"},{default:t(()=>[e(d,{label:"转出主体",prop:"subject_id"},{default:t(()=>[e(I,{modelValue:n.value.subject_id,"onUpdate:modelValue":a[6]||(a[6]=o=>n.value.subject_id=o),placeholder:"请选择转出主体",clearable:"",filterable:"",style:{width:"100%"}},{default:t(()=>[(_(!0),k(T,null,q(E.value,o=>(_(),R(f,{key:o.id,label:o.company_name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"收款人姓名",prop:"payee_name"},{default:t(()=>[e(b,{modelValue:n.value.payee_name,"onUpdate:modelValue":a[7]||(a[7]=o=>n.value.payee_name=o),placeholder:"请输入收款人姓名",clearable:""},null,8,["modelValue"])]),_:1}),e(d,{label:"收款人账号",prop:"payee_account"},{default:t(()=>[e(b,{modelValue:n.value.payee_account,"onUpdate:modelValue":a[8]||(a[8]=o=>n.value.payee_account=o),placeholder:"请输入收款人账号",clearable:""},null,8,["modelValue"])]),_:1}),e(d,{label:"转账金额",prop:"amount"},{default:t(()=>[e(b,{modelValue:n.value.amount,"onUpdate:modelValue":a[9]||(a[9]=o=>n.value.amount=o),placeholder:"请输入转账金额",clearable:"",type:"number",min:0,precision:2},{prefix:t(()=>[...a[20]||(a[20]=[u("¥",-1)])]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"备注",prop:"remark"},{default:t(()=>[e(b,{modelValue:n.value.remark,"onUpdate:modelValue":a[10]||(a[10]=o=>n.value.remark=o),type:"textarea",rows:3,placeholder:"请输入备注信息（选填）",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),i("div",Xe,[e(ce,{data:r(g).data,border:"",stripe:"","max-height":"600",style:{width:"100%"}},{default:t(()=>[e(p,{prop:"transfer_no",label:"转账单号",align:"center","min-width":"200"}),e(p,{prop:"subject_name",label:"转出主体",align:"center","min-width":"200"}),e(p,{prop:"payee_name",label:"收款人姓名",align:"center","min-width":"150"}),e(p,{prop:"payee_account",label:"收款人账号",align:"center","min-width":"180"}),e(p,{prop:"amount",label:"金额",align:"center","min-width":"120"},{default:t(({row:o})=>[u(" ¥"+v(o.amount||"0.00"),1)]),_:1}),e(p,{prop:"transfer_time",label:"转账时间",align:"center","min-width":"180"}),e(p,{prop:"remark",label:"备注信息",align:"center","min-width":"200","show-overflow-tooltip":""}),e(p,{label:"创建时间",align:"center","min-width":"180"},{default:t(({row:o})=>[o.transfer_time?(_(),k("span",ea,"-")):(_(),k("span",Ze,v(o.created_at||"-"),1))]),_:1})]),_:1},8,["data"])]),i("div",aa,[i("div",ta,[e(pe,{"current-page":r(g).current_page,"onUpdate:currentPage":a[13]||(a[13]=o=>r(g).current_page=o),"page-size":r(g).page_size,"onUpdate:pageSize":a[14]||(a[14]=o=>r(g).page_size=o),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:r(g).page_total,onSizeChange:r(O),onCurrentChange:r(Q)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])],64)}}}),_a=Pe(la,[["__scopeId","data-v-9b74c1ab"]]);export{_a as default};
//# sourceMappingURL=transfer-order-COtY6C2W.js.map
