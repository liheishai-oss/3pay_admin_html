{"version":3,"file":"edit-DVBLkLKA.js","sources":["../../src/pages/agent/user/edit.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref, watch } from 'vue'\nimport { ElMessage, ElForm } from 'element-plus'\nimport { Check, Close } from '@element-plus/icons-vue'\nimport request from '@/utils/request'\n\nconst visible = ref(false)\nconst formRef = ref<InstanceType<typeof ElForm>>()\n\nconst form = ref({\n  id: 0,\n  agent_name: '',\n  username: '',\n  group_id: 3, // 代理商管理组\n  status: 1,\n  remark: ''\n})\n\nconst emit = defineEmits<{\n  (event: 'refresh'): void\n}>()\n\n// 定义验证规则\nconst rules = ref({\n  agent_name: [\n    { required: true, message: '请输入代理商名称', trigger: 'blur' }\n  ],\n  username: [\n    { required: false, message: '请输入登录账号', trigger: 'blur' }\n  ]\n})\n\n// 动态更新验证规则\nconst updateRules = () => {\n  if (form.value.id === 0) {\n    // 新建时用户名必填\n    rules.value.username[0].required = true\n  } else {\n    // 编辑时用户名不必填\n    rules.value.username[0].required = false\n  }\n}\n\n// 获取详情\nconst getDetail = async (id: number) => {\n  try {\n    const res = await request({\n      url: `/api/v1/admin/agent/detail/${id}`,\n      method: 'GET'\n    })\n    return res.data\n  } catch (error) {\n    console.error('获取详情失败:', error)\n    ElMessage.error('获取详情失败')\n  }\n}\n\n// 打开对话框\nconst open = async (data = {}) => {\n  const merged = { ...data }\n  Object.assign(form.value, merged)\n\n  if ((merged as any).id > 0) {\n    const detail = await getDetail((merged as any).id)\n    if (detail) {\n      Object.assign(form.value, detail)\n      // 编辑时从admin关联对象获取用户名\n      if (detail.admin) {\n        form.value.username = detail.admin.username\n      }\n    }\n  }\n\n  // 更新验证规则\n  updateRules()\n  visible.value = true\n}\n\n// 提交表单\nconst handleSubmit = async () => {\n  await formRef.value?.validate()\n  \n  const payload = {\n    ...form.value\n  }\n\n  try {\n    let res\n    if (payload.id === 0) {\n      // 新增\n      res = await request({\n        url: '/api/v1/admin/agent/add',\n        method: 'POST',\n        data: payload\n      })\n    } else {\n      // 编辑\n      res = await request({\n        url: '/api/v1/admin/agent/edit',\n        method: 'POST',\n        data: payload\n      })\n    }\n\n    if (res.status) {\n      ElMessage.success(res.message || '操作成功')\n      emit('refresh')\n      visible.value = false\n    }\n  } catch (error: any) {\n    ElMessage.error(error.message || '操作失败')\n  }\n}\n\n// 重置表单数据\nconst resetForm = () => {\n  form.value = {\n    id: 0,\n    agent_name: '',\n    username: '',\n    group_id: 3, // 代理商管理组\n    status: 1,\n    remark: ''\n  }\n  formRef.value?.clearValidate()\n}\n\n// 监听 visible 变化，关闭时重置表单\nwatch(visible, (newVal) => {\n  if (!newVal) {\n    resetForm()\n  }\n})\n\ndefineExpose({ open })\n</script>\n\n<template>\n  <el-dialog \n    v-model=\"visible\" \n    :title=\"form.id === 0 ? '新增代理商' : '编辑代理商'\" \n    width=\"700px\"\n    :close-on-click-modal=\"false\"\n  >\n    <el-form :model=\"form\" label-width=\"120px\" :rules=\"rules\" ref=\"formRef\">\n      <el-row :gutter=\"20\">\n        <el-col :span=\"12\">\n          <el-form-item label=\"代理商名称\" prop=\"agent_name\">\n            <el-input \n              v-model=\"form.agent_name\" \n              placeholder=\"请输入代理商名称\" \n              clearable\n            />\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"登录账号\" prop=\"username\">\n            <el-input \n              v-model=\"form.username\" \n              placeholder=\"请输入登录账号\" \n              clearable\n              :disabled=\"form.id > 0\"\n            />\n            <div class=\"form-tip\" v-if=\"form.id > 0\">账号创建后不可修改</div>\n          </el-form-item>\n        </el-col>\n      </el-row>\n\n      <el-row :gutter=\"20\" v-if=\"form.id === 0\">\n        <el-col :span=\"24\">\n          <el-alert\n            title=\"默认密码为：123456\"\n            type=\"info\"\n            :closable=\"false\"\n            show-icon>\n          </el-alert>\n        </el-col>\n      </el-row>\n\n\n      <el-form-item label=\"状态\" prop=\"status\">\n        <el-switch \n          v-model=\"form.status\" \n          :active-value=\"1\" \n          :inactive-value=\"0\"\n          active-text=\"启用\"\n          inactive-text=\"禁用\"\n        />\n      </el-form-item>\n\n      <el-form-item label=\"备注\" prop=\"remark\">\n        <el-input \n          v-model=\"form.remark\" \n          type=\"textarea\" \n          :rows=\"3\"\n          placeholder=\"请输入备注信息\" \n          maxlength=\"500\"\n          show-word-limit\n        />\n      </el-form-item>\n\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"handleSubmit\">\n          <el-icon><Check /></el-icon>\n          提交\n        </el-button>\n        <el-button @click=\"visible = false\">\n          <el-icon><Close /></el-icon>\n          取消\n        </el-button>\n      </el-form-item>\n    </el-form>\n  </el-dialog>\n</template>\n\n<style scoped>\n.form-tip {\n  font-size: 12px;\n  color: #909399;\n  margin-top: 4px;\n  line-height: 1.5;\n}\n</style>\n\n"],"names":["visible","ref","formRef","form","emit","__emit","rules","updateRules","getDetail","id","request","error","ElMessage","open","data","merged","detail","handleSubmit","_a","payload","res","resetForm","watch","newVal","__expose","_createBlock","_component_el_dialog","$event","_createVNode","_unref","ElForm","_component_el_row","_component_el_col","_component_el_form_item","_component_el_input","_cache","_createElementBlock","_hoisted_1","_component_el_alert","_component_el_switch","_component_el_button","_component_el_icon","Check","Close"],"mappings":"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"}