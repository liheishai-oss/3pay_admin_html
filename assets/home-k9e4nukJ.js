import{d as pe,g as v,a9 as fe,L as ve,c as S,a as e,e as p,w as l,T as Ee,u as i,M as Y,s as V,q as be,N as ge,O as Ce,P as De,D as Re,o as E,Q as Oe,E as Se,i as w,j as I,b as he,y as ye,ap as Pe,aq as Ve,as as we,z as Ie,at as Ne,x as ke,n as r,R as Ue,S as Te,V as xe,W as Ae,t as _,a8 as Me,a1 as Le,au as Fe,av as ze,a3 as He,C as h,_ as je}from"./index-_X_07Eu8.js";/* empty css                     *//* empty css                          *//* empty css                   *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                          */import{u as Ge}from"./table.plugin-BY9GB1u6.js";const Be={class:"table-com-search"},Ye={class:"table-header ba-scroll-style"},We={class:"table-search"},qe={style:{width:"100%","overflow-x":"auto"},class:"table-content"},$e={key:1,style:{color:"#999"}},Ke={class:"table-footer"},Qe={class:"table-pagination"},Je={key:0,class:"complaint-handle"},Xe={style:{color:"#f56c6c","font-weight":"bold"}},Ze={key:0,style:{"margin-left":"10px",color:"#999","font-size":"12px"}},ea=pe({__name:"home",setup(aa){const{isVisible:W,toggleVisibility:q,loadData:$,data:C,refreshData:y,handleSizeChange:K,handleCurrentChange:Q,searchParams:F}=Ge("/api/v1/admin/complaint/list"),u=v({subject_id:"",agent_id:"",complaint_no:"",status:"",start_time:"",end_time:""}),N=v(null),z=v([]),D=v(!1),n=v(null),k=v(null),U=v(!1),m=v({process_code:"",feedback:"",refund_amount:0}),J={process_code:[{required:!0,message:"请选择处理结果码",trigger:"change"}],feedback:[{required:!0,message:"请输入反馈内容",trigger:"blur"},{min:10,message:"反馈内容至少10个字符",trigger:"blur"}]},H=v({}),X=fe(()=>{var o;return((o=H.value)==null?void 0:o.is_agent)===!0}),Z=o=>{o?(u.value.start_time=o[0],u.value.end_time=o[1]):(u.value.start_time="",u.value.end_time="")},ee=async()=>{F.value={...u.value},await y()},ae=()=>{u.value={subject_id:"",agent_id:"",complaint_no:"",status:"",start_time:"",end_time:""},N.value=null,F.value={...u.value},y()},le=async()=>{try{const o=await V({url:"/api/v1/admin/complaint/subject-list",method:"GET"});o.status&&(z.value=o.data)}catch(o){console.error("获取主体列表失败:",o)}},te=async o=>{try{const a=await V({url:"/api/v1/admin/complaint/detail",method:"GET",params:{id:o.id}});a.status?(n.value=a.data,m.value={process_code:"",feedback:"",refund_amount:0},D.value=!0):h.error(a.message||"获取详情失败")}catch(a){console.error("获取投诉详情失败:",a),h.error(a.message||"获取详情失败")}},oe=async()=>{k.value&&await k.value.validate(async o=>{if(o){U.value=!0;try{const a=await V({url:"/api/v1/admin/complaint/handle",method:"POST",data:{id:n.value.id,process_code:m.value.process_code,feedback:m.value.feedback,refund_amount:m.value.refund_amount}});a.status?(h.success("处理成功"),D.value=!1,y()):h.error(a.message||"处理失败")}catch(a){console.error("处理投诉失败:",a),h.error(a.message||"处理失败")}finally{U.value=!1}}})},T=o=>({WAIT_PROCESS:"待处理",PROCESSING:"处理中",PROCESSED:"处理完成",OVERDUE:"超时未处理",OVERDUE_PROCESSED:"超时处理完成",PART_OVERDUE:"部分超时未处理",DROP_COMPLAIN:"用户撤诉",DROP_PROCESSED:"处理完成用户撤诉",DROP_OVERDUE_COMPLAIN:"超时后用户撤诉",DROP_OVERDUE_PROCESSED:"超时处理完成用户撤诉",CLOSED:"已关闭",MERCHANT_PROCESSING:"商家处理中",MERCHANT_FEEDBACKED:"商家已反馈",SUCCESS:"投诉完结",CANCELLED:"投诉撤销",FINISHED:"已完结",MERCHANT_REPLIED:"商家已回复",待处理:"待处理",处理中:"处理中",处理完成:"处理完成"})[o]||o,x=o=>({WAIT_PROCESS:"danger",PROCESSING:"warning",PROCESSED:"success",OVERDUE:"danger",OVERDUE_PROCESSED:"warning",PART_OVERDUE:"warning",DROP_COMPLAIN:"info",DROP_PROCESSED:"info",DROP_OVERDUE_COMPLAIN:"info",DROP_OVERDUE_PROCESSED:"info",CLOSED:"info"})[o]||"info",ne=async()=>{try{const o=await V({url:"/api/v1/admin/user/info",method:"GET"});o.status&&(H.value=o.data)}catch(o){console.error("获取用户信息失败:",o)}};return ve(()=>{ne(),le(),$()}),(o,a)=>{const s=Ve,A=Pe,f=ye,R=he,M=Ie,j=Se,se=Ne,b=be,G=ke,ue=ge,c=Ae,P=Me,re=Ce,ie=De,g=ze,de=Fe,B=Le,_e=He,me=Re;return E(),S(Y,null,[e(Ee,{name:"fade"},{default:l(()=>[Oe(p("div",Be,[e(j,{gutter:20},{default:l(()=>[e(R,{span:6},{default:l(()=>[e(f,{label:"主体"},{default:l(()=>[e(A,{modelValue:u.value.subject_id,"onUpdate:modelValue":a[0]||(a[0]=t=>u.value.subject_id=t),placeholder:"选择主体",clearable:"",filterable:""},{default:l(()=>[e(s,{label:"全部",value:""}),(E(!0),S(Y,null,we(z.value,t=>(E(),w(s,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),X.value?I("",!0):(E(),w(R,{key:0,span:6},{default:l(()=>[e(f,{label:"代理商ID"},{default:l(()=>[e(M,{modelValue:u.value.agent_id,"onUpdate:modelValue":a[1]||(a[1]=t=>u.value.agent_id=t),placeholder:"按代理商ID搜索",clearable:"",type:"number"},null,8,["modelValue"])]),_:1})]),_:1})),e(R,{span:6},{default:l(()=>[e(f,{label:"投诉单号"},{default:l(()=>[e(M,{modelValue:u.value.complaint_no,"onUpdate:modelValue":a[2]||(a[2]=t=>u.value.complaint_no=t),placeholder:"按投诉单号搜索",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(R,{span:6},{default:l(()=>[e(f,{label:"状态"},{default:l(()=>[e(A,{modelValue:u.value.status,"onUpdate:modelValue":a[3]||(a[3]=t=>u.value.status=t),placeholder:"选择状态",clearable:""},{default:l(()=>[e(s,{label:"全部",value:""}),e(s,{label:"待处理",value:"WAIT_PROCESS"}),e(s,{label:"处理中",value:"PROCESSING"}),e(s,{label:"处理完成",value:"PROCESSED"}),e(s,{label:"部分超时未处理",value:"PART_OVERDUE"}),e(s,{label:"超时未处理",value:"OVERDUE"}),e(s,{label:"超时处理完成",value:"OVERDUE_PROCESSED"}),e(s,{label:"用户撤诉",value:"DROP_COMPLAIN"}),e(s,{label:"处理完成用户撤诉",value:"DROP_PROCESSED"}),e(s,{label:"超时后用户撤诉",value:"DROP_OVERDUE_COMPLAIN"}),e(s,{label:"超时处理完成用户撤诉",value:"DROP_OVERDUE_PROCESSED"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(j,{gutter:20},{default:l(()=>[e(R,{span:12},{default:l(()=>[e(f,{label:"投诉时间"},{default:l(()=>[e(se,{modelValue:N.value,"onUpdate:modelValue":a[4]||(a[4]=t=>N.value=t),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",onChange:Z},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(G,{inline:!0,class:"demo-form-inline"},{default:l(()=>[e(f,null,{default:l(()=>[e(b,{type:"primary",onClick:ee},{default:l(()=>[...a[12]||(a[12]=[r("搜索",-1)])]),_:1}),e(b,{type:"primary",onClick:ae},{default:l(()=>[...a[13]||(a[13]=[r("重置",-1)])]),_:1})]),_:1})]),_:1})],512),[[Ue,i(W)]])]),_:1}),p("div",Ye,[e(b,{icon:i(Te),onClick:i(y),color:"#40485b"},null,8,["icon","onClick"]),p("div",We,[e(ue,{class:"ml-4"},{default:l(()=>[e(b,{icon:i(xe),onClick:i(q)},null,8,["icon","onClick"])]),_:1})])]),p("div",qe,[e(re,{data:i(C).data,border:"",stripe:"","max-height":"600",style:{width:"100%"}},{default:l(()=>[e(c,{prop:"id",label:"ID",align:"center","min-width":"80"}),e(c,{prop:"complaint_no",label:"投诉单号",align:"center","min-width":"200","show-overflow-tooltip":""}),e(c,{prop:"subject_name",label:"主体名称",align:"center","min-width":"180","show-overflow-tooltip":""}),e(c,{prop:"agent_name",label:"代理商",align:"center","min-width":"150"}),e(c,{label:"投诉金额",align:"center","min-width":"120"},{default:l(({row:t})=>[r(_(t.complaint_amount>0?`¥${t.complaint_amount}`:"-"),1)]),_:1}),e(c,{label:"已退款",align:"center","min-width":"120"},{default:l(({row:t})=>[t.refund_amount>0?(E(),w(P,{key:0,type:"success"},{default:l(()=>[r("¥"+_(t.refund_amount),1)]),_:2},1024)):(E(),S("span",$e,"-"))]),_:1}),e(c,{prop:"complainant_id",label:"投诉人ID",align:"center","min-width":"180","show-overflow-tooltip":""}),e(c,{prop:"complaint_time",label:"投诉时间",align:"center","min-width":"180"}),e(c,{label:"状态",align:"center","min-width":"150"},{default:l(({row:t})=>[e(P,{type:x(t.complaint_status)},{default:l(()=>[r(_(T(t.complaint_status)),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"created_at",label:"创建时间",align:"center","min-width":"180"}),e(c,{label:"操作",align:"center",fixed:"right","min-width":"120"},{default:l(t=>[e(b,{size:"small",type:"primary",onClick:L=>te(t.row)},{default:l(()=>[...a[14]||(a[14]=[r("处理投诉",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),p("div",Ke,[p("div",Qe,[e(ie,{"current-page":i(C).current_page,"onUpdate:currentPage":a[5]||(a[5]=t=>i(C).current_page=t),"page-size":i(C).page_size,"onUpdate:pageSize":a[6]||(a[6]=t=>i(C).page_size=t),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:i(C).page_total,onSizeChange:i(K),onCurrentChange:i(Q)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),e(me,{modelValue:D.value,"onUpdate:modelValue":a[11]||(a[11]=t=>D.value=t),title:"处理投诉",width:"90%","close-on-click-modal":!1},{footer:l(()=>[e(b,{onClick:a[10]||(a[10]=t=>D.value=!1)},{default:l(()=>[...a[17]||(a[17]=[r("取消",-1)])]),_:1}),e(b,{type:"primary",onClick:oe,loading:U.value},{default:l(()=>[...a[18]||(a[18]=[r("提交处理",-1)])]),_:1},8,["loading"])]),default:l(()=>{var t,L;return[n.value?(E(),S("div",Je,[e(B,{class:"box-card",shadow:"never",style:{"margin-bottom":"20px"}},{header:l(()=>[...a[15]||(a[15]=[p("div",{class:"card-header"},[p("span",null,"投诉基本信息")],-1)])]),default:l(()=>[e(de,{column:2,border:""},{default:l(()=>[e(g,{label:"投诉单号"},{default:l(()=>[r(_(n.value.complaint_no),1)]),_:1}),e(g,{label:"主体名称"},{default:l(()=>[r(_(n.value.subject_name),1)]),_:1}),e(g,{label:"投诉人ID"},{default:l(()=>[r(_(n.value.complainant_id),1)]),_:1}),e(g,{label:"投诉时间"},{default:l(()=>[r(_(n.value.complaint_time),1)]),_:1}),e(g,{label:"投诉金额"},{default:l(()=>{var d;return[p("span",Xe,_(((d=n.value)==null?void 0:d.complaint_amount)>0?`¥${n.value.complaint_amount}`:"-"),1)]}),_:1}),e(g,{label:"当前状态"},{default:l(()=>[e(P,{type:x(n.value.complaint_status)},{default:l(()=>[r(_(T(n.value.complaint_status)),1)]),_:1},8,["type"])]),_:1}),e(g,{label:"投诉原因",span:2},{default:l(()=>[r(_(n.value.complaint_reason),1)]),_:1})]),_:1})]),_:1}),((t=n.value)==null?void 0:t.complaint_status)==="WAIT_PROCESS"||((L=n.value)==null?void 0:L.complaint_status)==="PROCESSING"?(E(),w(B,{key:0,class:"box-card",shadow:"never"},{header:l(()=>[...a[16]||(a[16]=[p("div",{class:"card-header"},[p("span",null,"商家反馈处理")],-1)])]),default:l(()=>[e(G,{model:m.value,ref_key:"handleFormRef",ref:k,"label-width":"130px",rules:J},{default:l(()=>[e(f,{label:"当前状态"},{default:l(()=>{var d;return[e(P,{type:x((d=n.value)==null?void 0:d.complaint_status)},{default:l(()=>{var O;return[r(_(T((O=n.value)==null?void 0:O.complaint_status)),1)]}),_:1},8,["type"])]}),_:1}),e(f,{label:"处理结果码",prop:"process_code"},{default:l(()=>[e(A,{modelValue:m.value.process_code,"onUpdate:modelValue":a[7]||(a[7]=d=>m.value.process_code=d),placeholder:"请选择处理结果码",style:{width:"100%"}},{default:l(()=>[e(s,{label:"已联系到用户，协商一致，无异议",value:"CONSENSUS_WITH_CLIENT"}),e(s,{label:"已退款，用户无异议",value:"REFUND"}),e(s,{label:"不涉及退款，已针对投诉内容进行整改",value:"RECTIFICATION_NO_REFUND"}),e(s,{label:"已提交证明材料",value:"SUBMIT_PROOF_NOT_CONTACTED"}),e(s,{label:"其他渠道已退款",value:"OTHER_CHANNEL_REFUND"}),e(s,{label:"其他",value:"ORTHER"})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"反馈内容",prop:"feedback"},{default:l(()=>[e(M,{modelValue:m.value.feedback,"onUpdate:modelValue":a[8]||(a[8]=d=>m.value.feedback=d),type:"textarea",rows:5,placeholder:"请详细描述您对该投诉的处理情况和解决方案...",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(f,{label:"退款金额",prop:"refund_amount"},{default:l(()=>{var d,O;return[e(_e,{modelValue:m.value.refund_amount,"onUpdate:modelValue":a[9]||(a[9]=ce=>m.value.refund_amount=ce),min:0,max:((d=n.value)==null?void 0:d.complaint_amount)||999999.99,precision:2,step:.01,placeholder:"如有退款请填写",style:{width:"200px"}},null,8,["modelValue","max"]),((O=n.value)==null?void 0:O.complaint_amount)>0?(E(),S("span",Ze," 最大可退款金额：¥"+_(n.value.complaint_amount),1)):I("",!0)]}),_:1})]),_:1},8,["model"])]),_:1})):I("",!0)])):I("",!0)]}),_:1},8,["modelValue"])],64)}}}),_a=je(ea,[["__scopeId","data-v-febce7c6"]]);export{_a as default};
//# sourceMappingURL=home-k9e4nukJ.js.map
