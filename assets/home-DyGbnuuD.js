const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/edit-CyH9J9cA.js","assets/index-Bd9DWvNd.js","assets/index-DeES_tJc.css","assets/edit-CgyuJ0Yu.css","assets/alert-CF5VuMnX.css","assets/select-Cg3B10gN.css"])))=>i.map(i=>d[i]);
import{d as me,g as b,a9 as pe,L as _e,c as F,a as t,e as _,u as s,w as l,T as ge,M as U,s as f,q as fe,N as he,O as ve,P as ye,o as p,ao as be,Q as we,E as Ce,i as h,j as A,b as ke,y as Ee,ap as Se,as as Ve,aq as Te,z as xe,x as ze,n as r,R as Pe,S as Be,U as Re,V as $e,W as De,X as Fe,a8 as Ue,t as Ae,ar as Ie,aF as T,C as v}from"./index-Bd9DWvNd.js";/* empty css                   *//* empty css               *//* empty css                     *//* empty css                 */import{u as Le}from"./table.plugin-D73d37Sk.js";const Me={class:"table-com-search"},Ne={class:"table-header ba-scroll-style"},Oe={class:"table-search"},Ge={style:{width:"100%","overflow-x":"auto"},class:"table-content"},He={class:"table-footer"},We={class:"table-pagination"},Ze=me({__name:"home",setup(je){const I=be(()=>Ie(()=>import("./edit-CyH9J9cA.js"),__vite__mapDeps([0,1,2,3,4,5]))),w=b(null),x=(a={})=>{console.log(a),w.value?w.value.open({...a}):console.error("EditForm 组件未正确挂载！")},{handleSelectionChange:L,hasSelectedRows:M,isVisible:N,toggleVisibility:O,loadData:G,data:o,refreshData:C,handleSizeChange:H,handleCurrentChange:W,searchParams:z,deleteRows:P,toggleSwitch:j}=Le("/api/v1/admin/merchant/list"),g=async a=>{try{const e=await f({url:`/api/v1/admin/merchant/circuit-status/${a.id}`,method:"GET"});e.status&&(a.circuit_status=e.data)}catch(e){console.error("获取熔断状态失败:",e),a.circuit_status={is_circuit_open:!1,remain_seconds:0}}},q=async a=>{await H(a),o.value.data&&o.value.data.length>0&&await Promise.all(o.value.data.map(e=>g(e)))},K=async a=>{await W(a),o.value.data&&o.value.data.length>0&&await Promise.all(o.value.data.map(e=>g(e)))},u=b({agent_id:"",merchant_name:"",contact_name:"",contact_phone:"",status:""}),B=b([]),R=b({}),k=pe(()=>{var a;return((a=R.value)==null?void 0:a.is_agent)===!0}),Q=async()=>{try{const a=await f({url:"/api/v1/admin/user/info",method:"GET"});a.status&&(R.value=a.data)}catch(a){console.error("获取用户信息失败:",a)}},X=async()=>{if(!k.value)try{const a=await f({url:"/api/v1/admin/merchant/agent-list",method:"GET"});a.status&&(B.value=a.data)}catch(a){console.error("获取代理商列表失败:",a)}},J=async()=>{z.value={...u.value},await E()},Y=()=>{u.value={agent_id:"",merchant_name:"",contact_name:"",contact_phone:"",status:""},z.value={...u.value},E()},Z=async a=>{try{await T.confirm("确定要重置该商户的API密钥吗？重置后原密钥将失效！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await f({url:"/api/v1/admin/merchant/reset-api-key",method:"POST",data:{id:a.id}});e.status?T.alert(`<div style="word-break: break-all;">
          <p><strong>API Key:</strong><br/>${e.data.api_key}</p>
          <p style="margin-top: 10px;"><strong>API Secret:</strong><br/>${e.data.api_secret}</p>
        </div>`,"新的API密钥",{dangerouslyUseHTMLString:!0,confirmButtonText:"我已复制"}):v.error(e.msg||"重置失败")}catch(e){e!=="cancel"&&(console.error("重置失败:",e),v.error("重置失败"))}},ee=a=>{if(a<=0)return"0秒";const e=Math.floor(a/60),d=a%60;return e>0?`${e}分${d}秒`:`${d}秒`},ae=async a=>{try{await T.confirm("确定要解除该商户的熔断状态吗？","解除熔断",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await f({url:"/api/v1/admin/merchant/clear-circuit",method:"POST",data:{merchant_id:a.id}});e.status?(v.success(e.msg||"熔断已成功解除"),await g(a),await C()):v.error(e.msg||"解除熔断失败")}catch(e){e!=="cancel"&&(console.error("解除熔断失败:",e),v.error("解除熔断失败"))}},te=async()=>{await G(),o.value.data&&o.value.data.length>0&&await Promise.all(o.value.data.map(a=>g(a)))},E=async()=>{await C(),o.value.data&&o.value.data.length>0&&await Promise.all(o.value.data.map(a=>g(a)))};_e(async()=>{await Q(),await X(),await te()});const ne=(a,e)=>{P(a,[e.id])},le=a=>{P(a)};return(a,e)=>{const d=Te,$=Se,y=Ee,S=ke,oe=xe,se=Ce,i=fe,ie=ze,re=he,m=De,ue=Fe,D=Ue,ce=ve,de=ye;return p(),F(U,null,[t(s(I),{ref_key:"editFormRef",ref:w,onRefresh:s(C)},null,8,["onRefresh"]),t(ge,{name:"fade"},{default:l(()=>[we(_("div",Me,[t(se,{gutter:20},{default:l(()=>[k.value?A("",!0):(p(),h(S,{key:0,span:6},{default:l(()=>[t(y,{label:"代理商"},{default:l(()=>[t($,{modelValue:u.value.agent_id,"onUpdate:modelValue":e[0]||(e[0]=n=>u.value.agent_id=n),placeholder:"选择代理商",clearable:"",filterable:""},{default:l(()=>[(p(!0),F(U,null,Ve(B.value,n=>(p(),h(d,{key:n.id,label:n.agent_name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})),t(S,{span:6},{default:l(()=>[t(y,{label:"商户名称"},{default:l(()=>[t(oe,{modelValue:u.value.merchant_name,"onUpdate:modelValue":e[1]||(e[1]=n=>u.value.merchant_name=n),placeholder:"按商户名称搜索",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(S,{span:6},{default:l(()=>[t(y,{label:"状态"},{default:l(()=>[t($,{modelValue:u.value.status,"onUpdate:modelValue":e[2]||(e[2]=n=>u.value.status=n),placeholder:"选择状态",clearable:""},{default:l(()=>[t(d,{label:"全部",value:""}),t(d,{label:"启用",value:1}),t(d,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(ie,{inline:!0,class:"demo-form-inline"},{default:l(()=>[t(y,null,{default:l(()=>[t(i,{type:"primary",onClick:J},{default:l(()=>[...e[6]||(e[6]=[r("搜索",-1)])]),_:1}),t(i,{type:"primary",onClick:Y},{default:l(()=>[...e[7]||(e[7]=[r("重置",-1)])]),_:1})]),_:1})]),_:1})],512),[[Pe,s(N)]])]),_:1}),_("div",Ne,[t(i,{icon:s(Be),onClick:E,color:"#40485b"},null,8,["icon"]),t(i,{type:"primary",icon:s(Re),onClick:x},{default:l(()=>[...e[8]||(e[8]=[r("添加",-1)])]),_:1},8,["icon"]),t(i,{type:"danger",disabled:!s(M),onClick:e[3]||(e[3]=n=>le("/api/v1/admin/merchant/delete"))},{default:l(()=>[...e[9]||(e[9]=[r("删除",-1)])]),_:1},8,["disabled"]),_("div",Oe,[t(re,{class:"ml-4"},{default:l(()=>[t(i,{icon:s($e),onClick:s(O)},null,8,["icon","onClick"])]),_:1})])]),_("div",Ge,[t(ce,{data:s(o).data,border:"",stripe:"","max-height":"600",style:{width:"100%"},onSelectionChange:s(L)},{default:l(()=>[t(m,{type:"selection",width:"40"}),k.value?A("",!0):(p(),h(m,{key:0,prop:"agent.agent_name",label:"代理商",align:"center","min-width":"150"})),t(m,{prop:"merchant_name",label:"商户名称",align:"center","min-width":"200"}),t(m,{label:"状态",align:"center","min-width":"90"},{default:l(({row:n})=>[t(ue,{modelValue:n.status,"onUpdate:modelValue":c=>n.status=c,"active-value":1,"inactive-value":0,onChange:c=>s(j)("/api/v1/admin/merchant/switch",n.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(m,{label:"熔断状态",align:"center","min-width":"120"},{default:l(({row:n})=>{var c;return[(c=n.circuit_status)!=null&&c.is_circuit_open?(p(),h(D,{key:0,type:"danger",size:"small"},{default:l(()=>[r(" 熔断中 ("+Ae(ee(n.circuit_status.remain_seconds))+") ",1)]),_:2},1024)):(p(),h(D,{key:1,type:"success",size:"small"},{default:l(()=>[...e[10]||(e[10]=[r("正常",-1)])]),_:1}))]}),_:1}),t(m,{prop:"created_at",label:"创建时间",align:"center","min-width":"150"}),t(m,{label:"操作",align:"center",fixed:"right","min-width":"320"},{default:l(n=>{var c;return[t(i,{size:"small",onClick:V=>x(n.row)},{default:l(()=>[...e[11]||(e[11]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(i,{size:"small",type:"warning",onClick:V=>Z(n.row)},{default:l(()=>[...e[12]||(e[12]=[r("重置密钥",-1)])]),_:1},8,["onClick"]),t(i,{size:"small",type:"danger",disabled:!((c=n.row.circuit_status)!=null&&c.is_circuit_open),onClick:V=>ae(n.row)},{default:l(()=>[...e[13]||(e[13]=[r(" 解除熔断 ",-1)])]),_:1},8,["disabled","onClick"]),t(i,{size:"small",type:"danger",onClick:V=>ne("/api/v1/admin/merchant/delete",n.row)},{default:l(()=>[...e[14]||(e[14]=[r("删除",-1)])]),_:1},8,["onClick"])]}),_:1})]),_:1},8,["data","onSelectionChange"])]),_("div",He,[_("div",We,[t(de,{"current-page":s(o).current_page,"onUpdate:currentPage":e[4]||(e[4]=n=>s(o).current_page=n),"page-size":s(o).page_size,"onUpdate:pageSize":e[5]||(e[5]=n=>s(o).page_size=n),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:s(o).page_total,onSizeChange:q,onCurrentChange:K},null,8,["current-page","page-size","total"])])])],64)}}});export{Ze as default};
//# sourceMappingURL=home-DyGbnuuD.js.map
