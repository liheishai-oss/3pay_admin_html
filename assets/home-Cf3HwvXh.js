const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/edit-dKw9t7HS.js","assets/index-7VWzzcaF.js","assets/index-DENCnN-f.css","assets/edit-LVtr4UGo.css","assets/alert-CF5VuMnX.css","assets/select-Cg3B10gN.css"])))=>i.map(i=>d[i]);
import{d as Ce,g as _,a9 as ke,L as Se,s as v,c as z,a as t,e as c,u as i,w as l,T as Ee,M as O,q as xe,D as Te,N as Ve,O as Pe,P as $e,o as f,ao as ze,j as I,a1 as Ie,z as Ae,aF as De,n as r,Q as Ue,E as Be,i as w,b as Re,y as Fe,ap as Le,as as Me,aq as Ge,x as Oe,R as Ne,S as He,U as Ke,V as We,W as je,X as qe,a8 as Je,t as Qe,ar as Xe,aG as A,C as d,_ as Ye}from"./index-7VWzzcaF.js";/* empty css                   *//* empty css               *//* empty css                     *//* empty css                 */import{u as Ze}from"./table.plugin-8YsOnQuW.js";const ea={key:0,class:"api-docs-content"},aa={class:"card-header"},ta={class:"api-info-textarea"},la={class:"dialog-footer"},na={class:"table-com-search"},oa={class:"table-header ba-scroll-style"},sa={class:"table-search"},ia={style:{width:"100%","overflow-x":"auto"},class:"table-content"},ra={class:"table-footer"},ca={class:"table-pagination"},da=Ce({__name:"home",setup(ua){const N=ze(()=>Xe(()=>import("./edit-dKw9t7HS.js"),__vite__mapDeps([0,1,2,3,4,5]))),T=_(null),D=(a={})=>{console.log(a),T.value?T.value.open({...a}):console.error("EditForm 组件未正确挂载！")},{handleSelectionChange:H,hasSelectedRows:K,isVisible:W,toggleVisibility:j,loadData:q,data:o,refreshData:V,handleSizeChange:J,handleCurrentChange:Q,searchParams:U,deleteRows:B,toggleSwitch:X}=Ze("/api/v1/admin/merchant/list"),y=async a=>{try{const e=await v({url:`/api/v1/admin/merchant/circuit-status/${a.id}`,method:"GET"});e.status&&(a.circuit_status=e.data)}catch(e){console.error("获取熔断状态失败:",e),a.circuit_status={is_circuit_open:!1,remain_seconds:0}}},Y=async a=>{await J(a),o.value.data&&o.value.data.length>0&&await Promise.all(o.value.data.map(e=>y(e)))},Z=async a=>{await Q(a),o.value.data&&o.value.data.length>0&&await Promise.all(o.value.data.map(e=>y(e)))},u=_({agent_id:"",merchant_name:"",contact_name:"",contact_phone:"",status:""}),R=_([]),F=_({}),P=ke(()=>{var a;return((a=F.value)==null?void 0:a.is_agent)===!0}),ee=async()=>{try{const a=await v({url:"/api/v1/admin/user/info",method:"GET"});a.status&&(F.value=a.data)}catch(a){console.error("获取用户信息失败:",a)}},ae=async()=>{if(!P.value)try{const a=await v({url:"/api/v1/admin/merchant/agent-list",method:"GET"});a.status&&(R.value=a.data)}catch(a){console.error("获取代理商列表失败:",a)}},te=async()=>{U.value={...u.value},await b()},le=()=>{u.value={agent_id:"",merchant_name:"",contact_name:"",contact_phone:"",status:""},U.value={...u.value},b()},ne=async a=>{try{await A.confirm("确定要重置该商户的API密钥吗？重置后原密钥将失效！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await v({url:"/api/v1/admin/merchant/reset-api-key",method:"POST",data:{id:a.id}});e.status?(await A.alert(`<div style="word-break: break-all;">
          <p><strong>API Key:</strong><br/>${e.data.api_key}</p>
          <p style="margin-top: 10px;"><strong>API Secret:</strong><br/>${e.data.api_secret}</p>
        </div>`,"新的API密钥",{dangerouslyUseHTMLString:!0,confirmButtonText:"我已复制"}),await b()):d.error(e.msg||"重置失败")}catch(e){e!=="cancel"&&(console.error("重置失败:",e),d.error("重置失败"))}},oe=a=>{if(a<=0)return"0秒";const e=Math.floor(a/60),s=a%60;return e>0?`${e}分${s}秒`:`${s}秒`},se=async a=>{try{await A.confirm("确定要解除该商户的熔断状态吗？","解除熔断",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await v({url:"/api/v1/admin/merchant/clear-circuit",method:"POST",data:{merchant_id:a.id}});e.status?(d.success(e.msg||"熔断已成功解除"),await y(a),await V()):d.error(e.msg||"解除熔断失败")}catch(e){e!=="cancel"&&(console.error("解除熔断失败:",e),d.error("解除熔断失败"))}},ie=async()=>{await q(),o.value.data&&o.value.data.length>0&&await Promise.all(o.value.data.map(a=>y(a)))},b=async()=>{await V(),o.value.data&&o.value.data.length>0&&await Promise.all(o.value.data.map(a=>y(a)))};Se(async()=>{await ee(),await ae(),await de(),await ie()});const re=(a,e)=>{B(a,[e.id])},ce=a=>{B(a)},C=_(!1),k=_(null),h=_(""),g=_({callback_ips:"34.92.49.193,34.150.65.167",api_gateway:"https://api.baiyi-pay.com",api_docs:"https://www.baiyi-pay.com/docs.html"}),de=async()=>{try{const a=await v({url:"/api/v1/admin/merchant/api-config",method:"GET"});a.status&&a.data&&(g.value={callback_ips:a.data.callback_ips||g.value.callback_ips,api_gateway:a.data.api_gateway||g.value.api_gateway,api_docs:a.data.api_docs||g.value.api_docs})}catch(a){console.error("获取对接配置失败:",a)}},ue=async a=>{try{const e=await v({url:`/api/v1/admin/merchant/detail/${a.id}`,method:"GET"});if(e.status)a={...a,...e.data};else{d.error("获取商户详情失败");return}}catch(e){console.error("获取商户详情失败:",e),d.error("获取商户详情失败");return}k.value=a,me(),C.value=!0},me=()=>{if(!k.value)return;const a=k.value,e=`=== 百亿支付对接信息 ===

商户名称：${a.merchant_name||"未设置"}
商户Key：${a.api_key||"未生成"}
商户秘钥：${a.api_secret||"未生成"}
回调IP：${g.value.callback_ips}

API接口信息：
API网关：${g.value.api_gateway}
API文档：${g.value.api_docs}

接口说明：
1. 所有接口请求都需要进行签名验证
2. 签名算法：MD5(参数按key排序后拼接 + 商户秘钥)
3. 请求方式：POST
4. 数据格式：JSON
5. 字符编码：UTF-8

回调说明：
- 支付成功后系统会主动回调商户的notify_url
- 回调参数包含订单状态和签名信息
- 商户收到回调后需要返回"success"字符串确认（不区分大小写）
- HTTP状态码必须返回200，响应内容必须为"SUCCESS"

熔断机制：
- 连续超时5次：如果商户回调接口连续5次超时（超过10秒未响应），系统将触发熔断，暂停自动回调5分钟
- 连续非期望响应5次：如果商户回调接口连续5次返回非200状态码或响应内容不是"SUCCESS"，系统将触发熔断，暂停自动回调5分钟
- 熔断恢复：回调成功后自动恢复，或等待5分钟后自动恢复
- 建议：请确保回调接口稳定可用，响应时间控制在10秒以内，避免触发熔断机制

注意事项：
1. 请妥善保管商户Key和商户秘钥
2. 必须使用HTTPS协议进行接口调用
3. 回调地址必须是公网可访问的URL
4. 如有疑问请联系技术支持

生成时间：${new Date().toLocaleString()}`;h.value=e},pe=async()=>{try{await navigator.clipboard.writeText(h.value),d.success("完整对接信息已复制到剪贴板")}catch{const e=document.createElement("textarea");e.value=h.value,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.select();try{document.execCommand("copy"),d.success("完整对接信息已复制到剪贴板")}catch{d.error("复制失败，请手动复制")}document.body.removeChild(e)}};return(a,e)=>{const s=xe,L=Ae,_e=Ie,fe=Te,S=Ge,M=Le,E=Fe,$=Re,ge=Be,ve=Oe,ye=Ve,m=je,he=qe,G=Je,we=Pe,be=$e;return f(),z(O,null,[t(i(N),{ref_key:"editFormRef",ref:T,onRefresh:i(V)},null,8,["onRefresh"]),t(fe,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=n=>C.value=n),title:"对接资料",width:"600px","close-on-click-modal":!1},{footer:l(()=>[c("div",la,[t(s,{onClick:e[1]||(e[1]=n=>C.value=!1)},{default:l(()=>[...e[11]||(e[11]=[r("关闭",-1)])]),_:1})])]),default:l(()=>[k.value?(f(),z("div",ea,[t(_e,{class:"api-info-card",shadow:"never"},{header:l(()=>[c("div",aa,[e[10]||(e[10]=c("span",null,"对接信息",-1)),t(s,{type:"primary",size:"small",onClick:pe,icon:i(De)},{default:l(()=>[...e[9]||(e[9]=[r(" 一键复制全部 ",-1)])]),_:1},8,["icon"])])]),default:l(()=>[c("div",ta,[t(L,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=n=>h.value=n),type:"textarea",rows:12,readonly:"",placeholder:"对接信息加载中...",class:"api-info-text"},null,8,["modelValue"])])]),_:1})])):I("",!0)]),_:1},8,["modelValue"]),t(Ee,{name:"fade"},{default:l(()=>[Ue(c("div",na,[t(ge,{gutter:20},{default:l(()=>[P.value?I("",!0):(f(),w($,{key:0,span:6},{default:l(()=>[t(E,{label:"代理商"},{default:l(()=>[t(M,{modelValue:u.value.agent_id,"onUpdate:modelValue":e[3]||(e[3]=n=>u.value.agent_id=n),placeholder:"选择代理商",clearable:"",filterable:""},{default:l(()=>[(f(!0),z(O,null,Me(R.value,n=>(f(),w(S,{key:n.id,label:n.agent_name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})),t($,{span:6},{default:l(()=>[t(E,{label:"商户名称"},{default:l(()=>[t(L,{modelValue:u.value.merchant_name,"onUpdate:modelValue":e[4]||(e[4]=n=>u.value.merchant_name=n),placeholder:"按商户名称搜索",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t($,{span:6},{default:l(()=>[t(E,{label:"状态"},{default:l(()=>[t(M,{modelValue:u.value.status,"onUpdate:modelValue":e[5]||(e[5]=n=>u.value.status=n),placeholder:"选择状态",clearable:""},{default:l(()=>[t(S,{label:"全部",value:""}),t(S,{label:"启用",value:1}),t(S,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(ve,{inline:!0,class:"demo-form-inline"},{default:l(()=>[t(E,null,{default:l(()=>[t(s,{type:"primary",onClick:te},{default:l(()=>[...e[12]||(e[12]=[r("搜索",-1)])]),_:1}),t(s,{type:"primary",onClick:le},{default:l(()=>[...e[13]||(e[13]=[r("重置",-1)])]),_:1})]),_:1})]),_:1})],512),[[Ne,i(W)]])]),_:1}),c("div",oa,[t(s,{icon:i(He),onClick:b,color:"#40485b"},null,8,["icon"]),t(s,{type:"primary",icon:i(Ke),onClick:D},{default:l(()=>[...e[14]||(e[14]=[r("添加",-1)])]),_:1},8,["icon"]),t(s,{type:"danger",disabled:!i(K),onClick:e[6]||(e[6]=n=>ce("/api/v1/admin/merchant/delete"))},{default:l(()=>[...e[15]||(e[15]=[r("删除",-1)])]),_:1},8,["disabled"]),c("div",sa,[t(ye,{class:"ml-4"},{default:l(()=>[t(s,{icon:i(We),onClick:i(j)},null,8,["icon","onClick"])]),_:1})])]),c("div",ia,[t(we,{data:i(o).data,border:"",stripe:"","max-height":"600",style:{width:"100%"},onSelectionChange:i(H)},{default:l(()=>[t(m,{type:"selection",width:"40"}),P.value?I("",!0):(f(),w(m,{key:0,prop:"agent.agent_name",label:"代理商",align:"center","min-width":"150"})),t(m,{prop:"merchant_name",label:"商户名称",align:"center","min-width":"200"}),t(m,{prop:"username",label:"账号",align:"center","min-width":"150"}),t(m,{label:"状态",align:"center","min-width":"90"},{default:l(({row:n})=>[t(he,{modelValue:n.status,"onUpdate:modelValue":p=>n.status=p,"active-value":1,"inactive-value":0,onChange:p=>i(X)("/api/v1/admin/merchant/switch",n.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(m,{label:"熔断状态",align:"center","min-width":"120"},{default:l(({row:n})=>{var p;return[(p=n.circuit_status)!=null&&p.is_circuit_open?(f(),w(G,{key:0,type:"danger",size:"small"},{default:l(()=>[r(" 熔断中 ("+Qe(oe(n.circuit_status.remain_seconds))+") ",1)]),_:2},1024)):(f(),w(G,{key:1,type:"success",size:"small"},{default:l(()=>[...e[16]||(e[16]=[r("正常",-1)])]),_:1}))]}),_:1}),t(m,{prop:"created_at",label:"创建时间",align:"center","min-width":"150"}),t(m,{label:"操作",align:"center",fixed:"right","min-width":"400"},{default:l(n=>{var p;return[t(s,{size:"small",onClick:x=>D(n.row)},{default:l(()=>[...e[17]||(e[17]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(s,{size:"small",type:"info",onClick:x=>ue(n.row)},{default:l(()=>[...e[18]||(e[18]=[r("对接资料",-1)])]),_:1},8,["onClick"]),t(s,{size:"small",type:"warning",onClick:x=>ne(n.row)},{default:l(()=>[...e[19]||(e[19]=[r("重置密钥",-1)])]),_:1},8,["onClick"]),t(s,{size:"small",type:"danger",disabled:!((p=n.row.circuit_status)!=null&&p.is_circuit_open),onClick:x=>se(n.row)},{default:l(()=>[...e[20]||(e[20]=[r(" 解除熔断 ",-1)])]),_:1},8,["disabled","onClick"]),t(s,{size:"small",type:"danger",onClick:x=>re("/api/v1/admin/merchant/delete",n.row)},{default:l(()=>[...e[21]||(e[21]=[r("删除",-1)])]),_:1},8,["onClick"])]}),_:1})]),_:1},8,["data","onSelectionChange"])]),c("div",ra,[c("div",ca,[t(be,{"current-page":i(o).current_page,"onUpdate:currentPage":e[7]||(e[7]=n=>i(o).current_page=n),"page-size":i(o).page_size,"onUpdate:pageSize":e[8]||(e[8]=n=>i(o).page_size=n),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:i(o).page_total,onSizeChange:Y,onCurrentChange:Z},null,8,["current-page","page-size","total"])])])],64)}}}),ya=Ye(da,[["__scopeId","data-v-7dcede68"]]);export{ya as default};
//# sourceMappingURL=home-Cf3HwvXh.js.map
