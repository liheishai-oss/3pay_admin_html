import{d as X,g as E,h as Z,a8 as ee,K as te,c as k,e as g,j as f,a as t,u as m,w as a,q as ae,M as le,x as oe,N as ne,O as re,D as se,o as r,R as ue,U as ie,n as o,t as s,aP as de,y as _e,z as ye,ao as pe,ap as me,as as ce,V as fe,i as u,a7 as ge,at as ve,au as be,s as B,C as v,aF as P,_ as he}from"./index-eDxl0EL6.js";/* empty css                          *//* empty css                   *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                          */import{u as ke}from"./table.plugin-Cs0SED7-.js";const we={class:"royalty-page"},Ce={class:"table-header ba-scroll-style"},Ve={class:"table-search"},xe={key:0,class:"table-actions"},Ee={key:0,class:"search-form ba-scroll-style"},ze={style:{width:"100%","overflow-x":"auto"},class:"table-content"},Se={key:0},De={key:1},Be={key:0},Te={style:{"font-size":"12px",color:"#999"}},Ue={key:1},Me={class:"table-footer"},Pe={class:"table-pagination"},Re={style:{color:"#f56c6c"}},Ye={style:{background:"#f5f5f5",padding:"10px","border-radius":"4px","max-height":"300px",overflow:"auto"}},$e=X({__name:"home",setup(Ne){const{data:w,refreshData:C,handleSizeChange:R,handleCurrentChange:Y,searchParams:T}=ke("/api/v1/admin/royalty/list"),z=E(!1),c=Z({platform_order_no:"",trade_no:"",royalty_status:"",royalty_type:""}),V=E(null),b=E([]),S=E(!1),n=E(null),$=ee(()=>b.value.some(i=>i.royalty_status===3)),N=()=>{z.value=!z.value},O=async()=>{const i={...c};V.value&&(i.start_time=V.value[0],i.end_time=V.value[1]),T.value=i,await C()},j=()=>{Object.assign(c,{platform_order_no:"",trade_no:"",royalty_status:"",royalty_type:""}),V.value=null,T.value={},C()},F=i=>{b.value=i},H=async i=>{try{const e=await B({url:`/api/v1/admin/royalty/detail/${i.id}`,method:"GET"});e.status&&(n.value=e.data,S.value=!0)}catch(e){console.error("获取详情失败:",e),v.error("获取详情失败")}},I=async i=>{try{await P.confirm(`确定要重试分账吗？
订单号：${i.platform_order_no}`,"重试分账",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await B({url:`/api/v1/admin/royalty/retry/${i.id}`,method:"POST"});e.status?(v.success("重试成功"),await C()):v.error(e.msg||"重试失败")}catch(e){e!=="cancel"&&(console.error("重试失败:",e),v.error(e.message||"重试失败"))}},G=async()=>{if(b.value.length===0){v.warning("请选择要重试的分账记录");return}const i=b.value.filter(e=>e.royalty_status===3);if(i.length===0){v.warning("所选记录中没有失败的分账记录");return}try{await P.confirm(`确定要批量重试 ${i.length} 条失败的分账记录吗？`,"批量重试",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=i.map(D=>D.id),p=await B({url:"/api/v1/admin/royalty/batch-retry",method:"POST",data:{ids:e}});p.status?(v.success(`批量重试完成：成功 ${p.data.success_count} 条，失败 ${p.data.failed_count} 条`),await C(),b.value=[]):v.error(p.msg||"批量重试失败")}catch(e){e!=="cancel"&&(console.error("批量重试失败:",e),v.error(e.message||"批量重试失败"))}};return te(()=>{C()}),(i,e)=>{const p=ae,D=le,U=ye,x=_e,h=me,M=pe,q=ce,J=oe,y=fe,_=ge,K=ne,A=re,d=be,L=ve,Q=se;return r(),k("div",we,[g("div",Ce,[t(p,{icon:m(ue),onClick:m(C),color:"#40485b"},null,8,["icon","onClick"]),g("div",Ve,[t(D,{class:"ml-4"},{default:a(()=>[t(p,{icon:m(ie),onClick:N},null,8,["icon"])]),_:1})]),b.value.length>0?(r(),k("div",xe,[t(p,{type:"warning",icon:m(de),onClick:G,disabled:!$.value},{default:a(()=>[o(" 批量重试（"+s(b.value.length)+"） ",1)]),_:1},8,["icon","disabled"])])):f("",!0)]),z.value?(r(),k("div",Ee,[t(J,{inline:!0,model:c,class:"demo-form-inline"},{default:a(()=>[t(x,{label:"平台订单号"},{default:a(()=>[t(U,{modelValue:c.platform_order_no,"onUpdate:modelValue":e[0]||(e[0]=l=>c.platform_order_no=l),placeholder:"请输入平台订单号",clearable:""},null,8,["modelValue"])]),_:1}),t(x,{label:"交易号"},{default:a(()=>[t(U,{modelValue:c.trade_no,"onUpdate:modelValue":e[1]||(e[1]=l=>c.trade_no=l),placeholder:"请输入支付宝交易号",clearable:""},null,8,["modelValue"])]),_:1}),t(x,{label:"分账状态"},{default:a(()=>[t(M,{modelValue:c.royalty_status,"onUpdate:modelValue":e[2]||(e[2]=l=>c.royalty_status=l),placeholder:"请选择",clearable:""},{default:a(()=>[t(h,{label:"待分账",value:"0"}),t(h,{label:"分账中",value:"1"}),t(h,{label:"分账成功",value:"2"}),t(h,{label:"分账失败",value:"3"})]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"分账类型"},{default:a(()=>[t(M,{modelValue:c.royalty_type,"onUpdate:modelValue":e[3]||(e[3]=l=>c.royalty_type=l),placeholder:"请选择",clearable:""},{default:a(()=>[t(h,{label:"不分账",value:"none"}),t(h,{label:"单笔分账",value:"single"}),t(h,{label:"商家分账",value:"merchant"})]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"时间范围"},{default:a(()=>[t(q,{modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=l=>V.value=l),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(x,null,{default:a(()=>[t(p,{type:"primary",onClick:O},{default:a(()=>[...e[8]||(e[8]=[o("搜索",-1)])]),_:1}),t(p,{onClick:j},{default:a(()=>[...e[9]||(e[9]=[o("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])):f("",!0),g("div",ze,[t(K,{data:m(w).data,border:"",stripe:"","max-height":"600",style:{width:"100%"},onSelectionChange:F},{default:a(()=>[t(y,{type:"selection",width:"40"}),t(y,{prop:"platform_order_no",label:"平台订单号",align:"center","min-width":"200"}),t(y,{prop:"trade_no",label:"交易号",align:"center","min-width":"200"}),t(y,{prop:"order.agent.agent_name",label:"代理商",align:"center","min-width":"120"}),t(y,{prop:"order.merchant.merchant_name",label:"商户",align:"center","min-width":"150"}),t(y,{label:"分账类型",align:"center","min-width":"100"},{default:a(({row:l})=>[l.royalty_type==="none"?(r(),u(_,{key:0,type:"info"},{default:a(()=>[...e[10]||(e[10]=[o("不分账",-1)])]),_:1})):l.royalty_type==="single"?(r(),u(_,{key:1,type:"success"},{default:a(()=>[...e[11]||(e[11]=[o("单笔分账",-1)])]),_:1})):l.royalty_type==="merchant"?(r(),u(_,{key:2,type:"warning"},{default:a(()=>[...e[12]||(e[12]=[o("商家分账",-1)])]),_:1})):f("",!0)]),_:1}),t(y,{label:"分账金额",align:"center","min-width":"120"},{default:a(({row:l})=>[l.royalty_amount>0?(r(),k("span",Se,"¥"+s(l.royalty_amount),1)):(r(),k("span",De,"-"))]),_:1}),t(y,{label:"主体收款",align:"center","min-width":"120"},{default:a(({row:l})=>[o(" ¥"+s(l.subject_amount),1)]),_:1}),t(y,{label:"收款人",align:"center","min-width":"150"},{default:a(({row:l})=>[l.payee_name?(r(),k("div",Be,[g("div",null,s(l.payee_name),1),g("div",Te,s(l.payee_user_id||l.payee_account),1)])):(r(),k("span",Ue,"-"))]),_:1}),t(y,{label:"分账状态",align:"center","min-width":"100"},{default:a(({row:l})=>[l.royalty_status===0?(r(),u(_,{key:0,type:"info"},{default:a(()=>[...e[13]||(e[13]=[o("待分账",-1)])]),_:1})):l.royalty_status===1?(r(),u(_,{key:1,type:"warning"},{default:a(()=>[...e[14]||(e[14]=[o("分账中",-1)])]),_:1})):l.royalty_status===2?(r(),u(_,{key:2,type:"success"},{default:a(()=>[...e[15]||(e[15]=[o("分账成功",-1)])]),_:1})):l.royalty_status===3?(r(),u(_,{key:3,type:"danger"},{default:a(()=>[...e[16]||(e[16]=[o("分账失败",-1)])]),_:1})):f("",!0)]),_:1}),t(y,{prop:"royalty_time",label:"分账时间",align:"center","min-width":"160"}),t(y,{prop:"created_at",label:"创建时间",align:"center","min-width":"160"}),t(y,{label:"操作",align:"center",fixed:"right","min-width":"150"},{default:a(({row:l})=>[t(p,{size:"small",onClick:W=>H(l)},{default:a(()=>[...e[17]||(e[17]=[o("详情",-1)])]),_:1},8,["onClick"]),l.royalty_status===3?(r(),u(p,{key:0,size:"small",type:"warning",onClick:W=>I(l)},{default:a(()=>[...e[18]||(e[18]=[o(" 重试 ",-1)])]),_:1},8,["onClick"])):f("",!0)]),_:1})]),_:1},8,["data"])]),g("div",Me,[g("div",Pe,[t(A,{"current-page":m(w).current_page,"onUpdate:currentPage":e[5]||(e[5]=l=>m(w).current_page=l),"page-size":m(w).page_size,"onUpdate:pageSize":e[6]||(e[6]=l=>m(w).page_size=l),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:m(w).page_total,onSizeChange:m(R),onCurrentChange:m(Y)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),t(Q,{modelValue:S.value,"onUpdate:modelValue":e[7]||(e[7]=l=>S.value=l),title:"分账详情",width:"800px"},{default:a(()=>[n.value?(r(),u(L,{key:0,column:2,border:""},{default:a(()=>[t(d,{label:"平台订单号"},{default:a(()=>[o(s(n.value.platform_order_no),1)]),_:1}),t(d,{label:"交易号"},{default:a(()=>[o(s(n.value.trade_no||"-"),1)]),_:1}),t(d,{label:"订单金额"},{default:a(()=>{var l;return[o("¥"+s(((l=n.value.order)==null?void 0:l.order_amount)||"-"),1)]}),_:1}),t(d,{label:"分账类型"},{default:a(()=>[n.value.royalty_type==="none"?(r(),u(_,{key:0,type:"info"},{default:a(()=>[...e[19]||(e[19]=[o("不分账",-1)])]),_:1})):n.value.royalty_type==="single"?(r(),u(_,{key:1,type:"success"},{default:a(()=>[...e[20]||(e[20]=[o("单笔分账",-1)])]),_:1})):n.value.royalty_type==="merchant"?(r(),u(_,{key:2,type:"warning"},{default:a(()=>[...e[21]||(e[21]=[o("商家分账",-1)])]),_:1})):f("",!0)]),_:1}),t(d,{label:"分账比例"},{default:a(()=>[o(s(n.value.royalty_rate)+"%",1)]),_:1}),t(d,{label:"分账金额"},{default:a(()=>[o("¥"+s(n.value.royalty_amount||0),1)]),_:1}),t(d,{label:"主体收款"},{default:a(()=>[o("¥"+s(n.value.subject_amount),1)]),_:1}),t(d,{label:"分账状态"},{default:a(()=>[n.value.royalty_status===0?(r(),u(_,{key:0,type:"info"},{default:a(()=>[...e[22]||(e[22]=[o("待分账",-1)])]),_:1})):n.value.royalty_status===1?(r(),u(_,{key:1,type:"warning"},{default:a(()=>[...e[23]||(e[23]=[o("分账中",-1)])]),_:1})):n.value.royalty_status===2?(r(),u(_,{key:2,type:"success"},{default:a(()=>[...e[24]||(e[24]=[o("分账成功",-1)])]),_:1})):n.value.royalty_status===3?(r(),u(_,{key:3,type:"danger"},{default:a(()=>[...e[25]||(e[25]=[o("分账失败",-1)])]),_:1})):f("",!0)]),_:1}),t(d,{label:"分账时间"},{default:a(()=>[o(s(n.value.royalty_time||"-"),1)]),_:1}),t(d,{label:"收款人姓名"},{default:a(()=>[o(s(n.value.payee_name||"-"),1)]),_:1}),t(d,{label:"收款人账号"},{default:a(()=>[o(s(n.value.payee_account||n.value.payee_user_id||"-"),1)]),_:1}),t(d,{label:"分账单号"},{default:a(()=>[o(s(n.value.alipay_royalty_no||"-"),1)]),_:1}),t(d,{label:"创建时间"},{default:a(()=>[o(s(n.value.created_at),1)]),_:1}),t(d,{label:"更新时间"},{default:a(()=>[o(s(n.value.updated_at),1)]),_:1}),n.value.royalty_error?(r(),u(d,{key:0,label:"失败原因",span:2},{default:a(()=>[g("span",Re,s(n.value.royalty_error),1)]),_:1})):f("",!0),n.value.alipay_result_parsed?(r(),u(d,{key:1,label:"支付宝返回结果",span:2},{default:a(()=>[g("pre",Ye,"            "+s(JSON.stringify(n.value.alipay_result_parsed,null,2))+`
          `,1)]),_:1})):f("",!0)]),_:1})):f("",!0)]),_:1},8,["modelValue"])])}}}),Ke=he($e,[["__scopeId","data-v-44fde7c6"]]);export{Ke as default};
//# sourceMappingURL=home-DFCNttSi.js.map
