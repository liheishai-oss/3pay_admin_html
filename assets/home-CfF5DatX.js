import{_ as J,g,a8 as X,ai as he,c as V,o as i,a as e,w as a,e as f,P as Y,z as ee,k as je,u as s,U as te,i as _,N as ae,V as le,W as ne,aG as ke,a7 as oe,n as u,t as se,a0 as Ce,s as R,C as x,d as we,K as Ve,T as Se,L as Q,D as Ie,q as Pe,M as Ee,O as Te,j as B,E as xe,b as Be,y as ze,ao as De,ar as H,ap as Ue,x as $e,Q as Re,R as Fe,S as Ae,Z as Le}from"./index-CFTblcIy.js";/* empty css                   *//* empty css               *//* empty css                     *//* empty css                 */import{u as Ne}from"./table.plugin-D8tqfcxX.js";import Ge from"./edit-BoOVFSMH.js";/* empty css                *//* empty css                 */const Me={class:"subject-payment-type-binding"},Oe={class:"card-header"},Qe={class:"header-info"},qe={class:"search-section"},Ke={__name:"SubjectPaymentTypeBinding",props:{subjectId:{type:[Number,String],required:!0}},setup(q,{expose:y}){const c=q,p=g(!1),k=g([]),C=g(""),F=X(()=>{if(!C.value)return k.value;const o=C.value.toLowerCase();return k.value.filter(d=>d.product_name.toLowerCase().includes(o))}),w=async()=>{if(!c.subjectId){console.log("SubjectPaymentTypeBinding: subjectId为空，跳过加载");return}console.log("SubjectPaymentTypeBinding: 开始加载支付类型列表",{subjectId:c.subjectId});try{p.value=!0;const o=await R.get("/api/v1/admin/subject-payment-type/list",{params:{subject_id:c.subjectId}});console.log("SubjectPaymentTypeBinding: API响应",o),o.code===200?(k.value=o.data.payment_types||[],console.log("SubjectPaymentTypeBinding: 加载成功",{count:k.value.length})):(console.error("SubjectPaymentTypeBinding: API返回错误",o),x.error(o.message||"加载支付类型列表失败"))}catch(o){console.error("SubjectPaymentTypeBinding: 请求异常",o),x.error("加载支付类型列表失败")}finally{p.value=!1}};he(()=>c.subjectId,o=>{console.log("SubjectPaymentTypeBinding: subjectId变化",{newId:o,oldId:c.subjectId}),o&&o>0&&w()},{immediate:!0});const A=()=>{},L=async o=>{console.log("切换支付类型状态",{paymentTypeId:o.id,productName:o.product_name,currentEnabled:o.is_enabled,subjectId:c.subjectId});try{p.value=!0;const d=await R.post("/api/v1/admin/subject-payment-type/toggle",{subject_id:c.subjectId,payment_type_id:o.id});console.log("切换API响应",d),d.code===200?(console.log("操作成功，重新加载数据"),await w(),x.success(d.message||`${d.data.action}成功`)):(console.error("API返回错误，重新加载数据",d),await w(),x.error(d.message||"操作失败"))}catch(d){console.error("切换支付类型状态失败:",d),await w(),x.error("操作失败")}finally{p.value=!1}};return y({loadSubjectPaymentTypes:w}),(o,d)=>{const h=oe,S=je,N=ee,z=le,D=ne,U=ae,G=Ce,r=ke;return i(),V("div",Me,[e(G,{class:"box-card"},{header:a(()=>[f("div",Oe,[d[1]||(d[1]=f("span",null,"支付类型支持管理",-1)),f("div",Qe,[e(h,{type:"info",size:"small"},{default:a(()=>[u(" 共 "+se(k.value.length)+" 种支付类型 ",1)]),_:1})])])]),default:a(()=>[f("div",qe,[e(N,{modelValue:C.value,"onUpdate:modelValue":d[0]||(d[0]=j=>C.value=j),placeholder:"搜索支付类型名称",clearable:"",onInput:A,style:{width:"300px","margin-bottom":"20px"}},{prefix:a(()=>[e(S,null,{default:a(()=>[e(s(te))]),_:1})]),_:1},8,["modelValue"])]),Y((i(),_(U,{data:F.value,"empty-text":"暂无支付类型","row-key":"id"},{default:a(()=>[e(z,{prop:"product_name",label:"支付名称","min-width":"200"}),e(z,{label:"支持状态",width:"100",align:"center"},{default:a(({row:j})=>[e(D,{modelValue:j.is_enabled,"onUpdate:modelValue":E=>j.is_enabled=E,disabled:p.value,onChange:E=>L(j)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1})]),_:1},8,["data"])),[[r,p.value]])]),_:1})])}}},We=J(Ke,[["__scopeId","data-v-9a0e8fc3"]]),Ze={class:"table-com-search"},He={class:"table-header ba-scroll-style"},Je={class:"table-search"},Xe={style:{width:"100%","overflow-x":"auto"},class:"table-content"},Ye={key:0,class:"payment-types-tags"},et={key:1,style:{color:"#909399"}},tt={key:0,style:{color:"#909399"}},at={class:"table-footer"},lt={class:"table-pagination"},nt=we({__name:"home",setup(q){const y=g(null),c=g(!1),p=g(null),k=g(null),C=(n={})=>{console.log(n),Le(()=>{y.value&&y.value.open?y.value.open({...n}):(console.error("EditForm 组件未正确挂载！",y.value),setTimeout(()=>{y.value&&y.value.open?y.value.open({...n}):console.error("EditForm 组件重试后仍然未正确挂载！")},100))})},F=n=>{console.log("打开支付类型绑定对话框",{row:n,subjectId:n==null?void 0:n.id}),p.value=n,c.value=!0},{handleSelectionChange:w,hasSelectedRows:A,isVisible:L,toggleVisibility:o,loadData:d,data:h,refreshData:S,handleSizeChange:N,handleCurrentChange:z,searchParams:D,deleteRows:U,toggleSwitch:G}=Ne("/api/v1/admin/subject/list"),r=g({agent_id:"",company_name:"",alipay_app_id:"",status:""}),j=g([]),E=g({}),M=X(()=>{var n;return((n=E.value)==null?void 0:n.is_agent)===!0}),ie=async()=>{try{const n=await R({url:"/api/v1/admin/user/info",method:"GET"});n.status&&(E.value=n.data)}catch(n){console.error("获取用户信息失败:",n)}},de=async()=>{if(!M.value)try{const n=await R({url:"/api/v1/admin/subject/agent-list",method:"GET"});n.status&&(j.value=n.data)}catch(n){console.error("获取代理商列表失败:",n)}},ue=async()=>{D.value={...r.value},await S()},re=()=>{r.value={agent_id:"",company_name:"",alipay_app_id:"",status:""},D.value={...r.value},S()};Ve(async()=>{await ie(),await de(),d()});const ce=(n,t)=>{U(n,[t.id])},pe=n=>{U(n)},me=n=>{const t={支付宝:"success",微信支付:"primary",银联支付:"warning",QQ钱包:"info",京东支付:"danger"};for(const[O,I]of Object.entries(t))if(n.includes(O))return I;return"info"};return(n,t)=>{var Z;const O=Ie,I=Ue,K=De,T=ze,$=Be,W=ee,_e=xe,b=Pe,ye=$e,ge=Ee,m=le,P=oe,fe=ne,be=ae,ve=Te;return i(),V(Q,null,[e(Ge,{ref_key:"editFormRef",ref:y,onRefresh:s(S)},null,8,["onRefresh"]),e(O,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=l=>c.value=l),title:`${((Z=p.value)==null?void 0:Z.company_name)||""} - 支付类型绑定管理`,width:"80%","close-on-click-modal":!1},{default:a(()=>[c.value&&p.value&&p.value.id?(i(),_(We,{key:0,"subject-id":p.value.id,ref_key:"paymentTypeBindingRef",ref:k},null,8,["subject-id"])):B("",!0)]),_:1},8,["modelValue","title"]),e(Se,{name:"fade"},{default:a(()=>[Y(f("div",Ze,[e(_e,{gutter:20},{default:a(()=>[M.value?B("",!0):(i(),_($,{key:0,span:6},{default:a(()=>[e(T,{label:"代理商"},{default:a(()=>[e(K,{modelValue:r.value.agent_id,"onUpdate:modelValue":t[1]||(t[1]=l=>r.value.agent_id=l),placeholder:"选择代理商",clearable:"",filterable:""},{default:a(()=>[(i(!0),V(Q,null,H(j.value,l=>(i(),_(I,{key:l.id,label:l.agent_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})),e($,{span:6},{default:a(()=>[e(T,{label:"企业名称"},{default:a(()=>[e(W,{modelValue:r.value.company_name,"onUpdate:modelValue":t[2]||(t[2]=l=>r.value.company_name=l),placeholder:"按企业名称搜索",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e($,{span:6},{default:a(()=>[e(T,{label:"APPID"},{default:a(()=>[e(W,{modelValue:r.value.alipay_app_id,"onUpdate:modelValue":t[3]||(t[3]=l=>r.value.alipay_app_id=l),placeholder:"按APPID搜索",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e($,{span:6},{default:a(()=>[e(T,{label:"状态"},{default:a(()=>[e(K,{modelValue:r.value.status,"onUpdate:modelValue":t[4]||(t[4]=l=>r.value.status=l),placeholder:"选择状态",clearable:""},{default:a(()=>[e(I,{label:"全部",value:""}),e(I,{label:"启用",value:1}),e(I,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ye,{inline:!0,class:"demo-form-inline"},{default:a(()=>[e(T,null,{default:a(()=>[e(b,{type:"primary",onClick:ue},{default:a(()=>[...t[8]||(t[8]=[u("搜索",-1)])]),_:1}),e(b,{type:"primary",onClick:re},{default:a(()=>[...t[9]||(t[9]=[u("重置",-1)])]),_:1})]),_:1})]),_:1})],512),[[Re,s(L)]])]),_:1}),f("div",He,[e(b,{icon:s(Fe),onClick:s(S),color:"#40485b"},null,8,["icon","onClick"]),e(b,{type:"primary",icon:s(Ae),onClick:C},{default:a(()=>[...t[10]||(t[10]=[u("添加",-1)])]),_:1},8,["icon"]),e(b,{type:"danger",disabled:!s(A),onClick:t[5]||(t[5]=l=>pe("/api/v1/admin/subject/delete"))},{default:a(()=>[...t[11]||(t[11]=[u("删除",-1)])]),_:1},8,["disabled"]),f("div",Je,[e(ge,{class:"ml-4"},{default:a(()=>[e(b,{icon:s(te),onClick:s(o)},null,8,["icon","onClick"])]),_:1})])]),f("div",Xe,[e(be,{data:s(h).data,border:"",stripe:"","max-height":"600",style:{width:"100%"},onSelectionChange:s(w)},{default:a(()=>[e(m,{type:"selection",width:"40"}),M.value?B("",!0):(i(),_(m,{key:0,prop:"agent.agent_name",label:"代理商",align:"center","min-width":"150"})),e(m,{label:"支付类型",align:"center","min-width":"200"},{default:a(({row:l})=>[l.payment_types&&l.payment_types.length>0?(i(),V("div",Ye,[(i(!0),V(Q,null,H(l.payment_types,v=>(i(),_(P,{key:v.id,type:me(v.product_name),size:"small",class:"payment-type-tag"},{default:a(()=>[u(se(v.product_name),1)]),_:2},1032,["type"]))),128))])):(i(),V("span",et,"未设置"))]),_:1}),e(m,{prop:"company_name",label:"企业名称",align:"center","min-width":"200"}),e(m,{label:"分账方式",align:"center","min-width":"120"},{default:a(({row:l})=>[l.royalty_type==="none"?(i(),_(P,{key:0,type:"info"},{default:a(()=>[...t[12]||(t[12]=[u("不分账",-1)])]),_:1})):l.royalty_type==="single"?(i(),_(P,{key:1,type:"success"},{default:a(()=>[...t[13]||(t[13]=[u("单笔",-1)])]),_:1})):l.royalty_type==="merchant"?(i(),_(P,{key:2,type:"warning"},{default:a(()=>[...t[14]||(t[14]=[u("商家",-1)])]),_:1})):B("",!0)]),_:1}),e(m,{label:"分账模式",align:"center","min-width":"120"},{default:a(({row:l})=>[l.royalty_type==="none"?(i(),V("span",tt,"-")):l.royalty_mode==="normal"?(i(),_(P,{key:1,size:"small"},{default:a(()=>[...t[15]||(t[15]=[u("普通",-1)])]),_:1})):l.royalty_mode==="master_sub"?(i(),_(P,{key:2,type:"success",size:"small"},{default:a(()=>[...t[16]||(t[16]=[u("主子",-1)])]),_:1})):B("",!0)]),_:1}),e(m,{prop:"alipay_app_id",label:"支付宝APPID",align:"center","min-width":"180"}),e(m,{prop:"alipay_pid",label:"合作伙伴ID",align:"center","min-width":"150"}),e(m,{label:"状态",align:"center","min-width":"90"},{default:a(({row:l})=>[e(fe,{modelValue:l.status,"onUpdate:modelValue":v=>l.status=v,"active-value":1,"inactive-value":0,onChange:v=>s(G)("/api/v1/admin/subject/switch",l.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(m,{prop:"created_at",label:"创建时间",align:"center","min-width":"150"}),e(m,{label:"操作",align:"center",fixed:"right","min-width":"280"},{default:a(l=>[e(b,{size:"small",onClick:v=>C(l.row)},{default:a(()=>[...t[17]||(t[17]=[u("编辑",-1)])]),_:1},8,["onClick"]),e(b,{size:"small",type:"primary",onClick:v=>F(l.row)},{default:a(()=>[...t[18]||(t[18]=[u("绑定支付类型",-1)])]),_:1},8,["onClick"]),e(b,{size:"small",type:"danger",onClick:v=>ce("/api/v1/admin/subject/delete",l.row)},{default:a(()=>[...t[19]||(t[19]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])]),f("div",at,[f("div",lt,[e(ve,{"current-page":s(h).current_page,"onUpdate:currentPage":t[6]||(t[6]=l=>s(h).current_page=l),"page-size":s(h).page_size,"onUpdate:pageSize":t[7]||(t[7]=l=>s(h).page_size=l),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:s(h).page_total,onSizeChange:s(N),onCurrentChange:s(z)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])],64)}}}),_t=J(nt,[["__scopeId","data-v-679f3704"]]);export{_t as default};
//# sourceMappingURL=home-CfF5DatX.js.map
