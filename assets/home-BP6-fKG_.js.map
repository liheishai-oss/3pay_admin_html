{"version":3,"mappings":"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","names":["EditForm","defineAsyncComponent","__vitePreload","editFormRef","ref","openEditFrom","row","handleSelectionChange","hasSelectedRows","showSearch","toggleSearch","loadData","data","refreshData","handleSizeChange","handleCurrentChange","searchParams","deleteRows","toggleSwitch","useTableDataPlugin","searchForm","agentList","paymentTypeList","userInfo","isAgent","computed","_a","getUserInfo","res","request","error","getAgentList","getPaymentTypeList","handleSearch","handleReset","onMounted","handleDelete","api","handleBatchDelete","_createVNode","_unref","_Transition","_withDirectives","_createElementVNode","_hoisted_1","_component_el_row","_createBlock","_component_el_col","_component_el_form_item","_component_el_select","_cache","$event","_createElementBlock","_Fragment","_renderList","agent","_component_el_option","_component_el_input","type","_component_el_form","_component_el_button","_hoisted_2","Refresh","Plus","_hoisted_3","_component_el_button_group","Search","_hoisted_4","_component_el_table","_component_el_table_column","_withCtx","_component_el_switch","scope","_hoisted_5","_hoisted_6","_component_el_pagination"],"ignoreList":[],"sources":["../../src/pages/product/home.vue"],"sourcesContent":["<template>\n  <!-- 编辑表单对话框 -->\n  <EditForm ref=\"editFormRef\" @refresh=\"refreshData\"/>\n  \n  <!-- 搜索菜单部分的过渡效果 -->\n  <transition name=\"fade\">\n    <div class=\"table-com-search\" v-show=\"showSearch\">\n      <el-row :gutter=\"20\">\n        <el-col :span=\"6\" v-if=\"!isAgent\">\n          <el-form-item label=\"代理商\">\n            <el-select v-model=\"searchForm.agent_id\" placeholder=\"选择代理商\" clearable filterable>\n              <el-option\n                v-for=\"agent in agentList\"\n                :key=\"agent.id\"\n                :label=\"agent.agent_name\"\n                :value=\"agent.id\"\n              />\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"6\">\n          <el-form-item label=\"产品名称\">\n            <el-input \n              v-model=\"searchForm.product_name\" \n              placeholder=\"按产品名称搜索\" \n              clearable \n            />\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"6\">\n          <el-form-item label=\"产品编号\">\n            <el-input \n              v-model=\"searchForm.product_code\" \n              placeholder=\"按产品编号搜索\" \n              clearable \n            />\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"6\">\n          <el-form-item label=\"支付类型\">\n            <el-select v-model=\"searchForm.payment_type_id\" placeholder=\"选择支付类型\" clearable filterable>\n              <el-option\n                v-for=\"type in paymentTypeList\"\n                :key=\"type.id\"\n                :label=\"type.product_name\"\n                :value=\"type.id\"\n              />\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"6\">\n          <el-form-item label=\"状态\">\n            <el-select v-model=\"searchForm.status\" placeholder=\"选择状态\" clearable>\n              <el-option label=\"全部\" :value=\"''\" />\n              <el-option label=\"启用\" :value=\"1\" />\n              <el-option label=\"禁用\" :value=\"0\" />\n            </el-select>\n          </el-form-item>\n        </el-col>\n      </el-row>\n\n      <!-- 搜索按钮和重置按钮 -->\n      <el-form :inline=\"true\" class=\"demo-form-inline\">\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"handleSearch\">搜索</el-button>\n          <el-button type=\"primary\" @click=\"handleReset\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n  </transition>\n\n  <!-- 表头 -->\n  <div class=\"table-header ba-scroll-style\">\n    <!-- 刷新、添加、删除按钮 -->\n    <el-button :icon=\"Refresh\" @click=\"refreshData\" color=\"#40485b\"/>\n    <el-button type=\"primary\" :icon=\"Plus\" @click=\"openEditFrom\">添加</el-button>\n    <el-button type=\"danger\" :disabled=\"!hasSelectedRows\" @click=\"handleBatchDelete('/api/v1/admin/product/delete')\">删除</el-button>\n\n    <!-- 搜索按钮 -->\n    <div class=\"table-search\">\n      <el-button-group class=\"ml-4\">\n        <el-button :icon=\"Search\" @click=\"toggleSearch\" />\n      </el-button-group>\n    </div>\n  </div>\n\n  <!-- 表格内容 -->\n  <div style=\"width: 100%; overflow-x: auto;\" class=\"table-content\">\n    <el-table\n        :data=\"data.data\"\n        border\n        stripe\n        max-height=\"600\"\n        style=\"width: 100%;\" \n        @selection-change=\"handleSelectionChange\">\n      <!-- 表格列定义 -->\n      <el-table-column type=\"selection\" width=\"40\"/>\n      <el-table-column prop=\"agent.agent_name\" label=\"代理商\" align=\"center\" min-width=\"150\" v-if=\"!isAgent\"/>\n      <el-table-column prop=\"product_name\" label=\"产品名称\" align=\"center\" min-width=\"200\"/>\n      <el-table-column prop=\"product_code\" label=\"产品编号\" align=\"center\" min-width=\"100\"/>\n      <el-table-column prop=\"payment_type.product_name\" label=\"支付类型\" align=\"center\" min-width=\"150\"/>\n\n      <!-- 状态列 -->\n      <el-table-column label=\"状态\" align=\"center\" min-width=\"90\">\n        <template #default=\"{ row }\">\n          <el-switch \n            v-model=\"row.status\" \n            :active-value=\"1\" \n            :inactive-value=\"0\" \n            @change=\"toggleSwitch('/api/v1/admin/product/switch', row.id)\"\n          />\n        </template>\n      </el-table-column>\n\n      <el-table-column prop=\"created_at\" label=\"创建时间\" align=\"center\" min-width=\"150\"/>\n\n      <!-- 操作列 -->\n      <el-table-column label=\"操作\" align=\"center\" fixed=\"right\" min-width=\"200\">\n        <template #default=\"scope\">\n          <el-button size=\"small\" @click=\"openEditFrom(scope.row)\">编辑</el-button>\n          <el-button size=\"small\" type=\"danger\" @click=\"handleDelete('/api/v1/admin/product/delete', scope.row)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n  </div>\n\n  <!-- 表格分页 -->\n  <div class=\"table-footer\">\n    <div class=\"table-pagination\">\n      <el-pagination\n          v-model:current-page=\"data.current_page\"\n          v-model:page-size=\"data.page_size\"\n          :page-sizes=\"[10, 50, 100, 200]\"\n          :background=\"true\"\n          prev-text=\"上一页\"\n          next-text=\"下一页\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          :total=\"data.page_total\"\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n      />\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { Plus, Refresh, Search } from '@element-plus/icons-vue';\nimport { ref, onMounted, defineAsyncComponent, computed } from 'vue';\nimport request from '@/utils/request';\n\n// 引入自定义插件和 API\nimport { useTableDataPlugin } from \"@/utils/plugins/table.plugin.ts\";\n\n// 导入编辑\nconst EditForm = defineAsyncComponent(() => import('./edit.vue'));\n// 导入编辑页面\nconst editFormRef = ref(null);\nconst openEditFrom = (row = {}) => {\n  console.log(row);\n  if (editFormRef.value) {\n    editFormRef.value.open({ ...row }); // 传递 `row` 作为参数\n  } else {\n    console.error(\"EditForm 组件未正确挂载！\");\n  }\n};\n\n// 使用表格插件来管理表格的状态、数据等\nconst {\n  handleSelectionChange,\n  hasSelectedRows,\n  isVisible: showSearch,\n  toggleVisibility: toggleSearch,\n  loadData,\n  data,\n  refreshData,\n  handleSizeChange,\n  handleCurrentChange,\n  searchParams,\n  deleteRows,\n  toggleSwitch,\n  resetSearchParams\n} = useTableDataPlugin(\"/api/v1/admin/product/list\");\n\n// 搜索表单数据\nconst searchForm = ref({\n  agent_id: '',\n  product_name: '',\n  product_code: '',\n  payment_type_id: '',\n  status: ''\n});\n\n// 代理商列表\nconst agentList = ref([]);\n\n// 支付类型列表\nconst paymentTypeList = ref([]);\n\n// 获取用户信息判断是否是代理商\nconst userInfo = ref<any>({});\nconst isAgent = computed(() => {\n  return userInfo.value?.is_agent === true;\n});\n\n// 获取用户信息\nconst getUserInfo = async () => {\n  try {\n    const res = await request({\n      url: '/api/v1/admin/user/info',\n      method: 'GET'\n    });\n    if (res.status) {\n      userInfo.value = res.data;\n    }\n  } catch (error) {\n    console.error('获取用户信息失败:', error);\n  }\n};\n\n// 获取代理商列表（仅管理员需要）\nconst getAgentList = async () => {\n  if (isAgent.value) return;\n  \n  try {\n    const res = await request({\n      url: '/api/v1/admin/product/agent-list',\n      method: 'GET'\n    });\n    if (res.status) {\n      agentList.value = res.data;\n    }\n  } catch (error) {\n    console.error('获取代理商列表失败:', error);\n  }\n};\n\n// 获取支付类型列表\nconst getPaymentTypeList = async () => {\n  try {\n    const res = await request({\n      url: '/api/v1/admin/product/payment-type-list',\n      method: 'GET'\n    });\n    if (res.status) {\n      paymentTypeList.value = res.data;\n    }\n  } catch (error) {\n    console.error('获取支付类型列表失败:', error);\n  }\n};\n\n// 处理搜索\nconst handleSearch = async () => {\n  // 将搜索表单数据同步到searchParams\n  searchParams.value = { ...searchForm.value };\n  await refreshData();\n};\n\n// 处理重置\nconst handleReset = () => {\n  searchForm.value = {\n    agent_id: '',\n    product_name: '',\n    product_code: '',\n    payment_type_id: '',\n    status: ''\n  };\n  searchParams.value = { ...searchForm.value };\n  refreshData();\n};\n\n// 在组件挂载时加载数据\nonMounted(async () => {\n  await getUserInfo();\n  await getAgentList();\n  await getPaymentTypeList();\n  loadData();\n});\n\n// 删除方法：单条删除\nconst handleDelete = (api: string, row: any) => {\n  deleteRows(api, [row.id]);  // 传递一个 id 数组来删除单条记录\n};\n\n// 批量删除\nconst handleBatchDelete = (api: string) => {\n  deleteRows(api);\n};\n\n</script>\n\n"],"file":"assets/home-BP6-fKG_.js"}